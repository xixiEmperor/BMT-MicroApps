# 二维码功能实现说明

## 问题解决

您之前遇到的"二维码加载失败"问题已经解决。原因是代码中使用了一个占位符的 base64 图片，而不是真正的二维码。

## 解决方案

### 1. 安装二维码生成库

```bash
pnpm add qrcode
```

### 2. 修改支付页面代码

在 `src/views/shop/PaymentView.vue` 中：

- 导入了 `qrcode` 库
- 创建了 `generateQRCode` 函数来生成真正的二维码
- 修改了 `handleCreatePayment` 函数，使用真实的支付链接生成二维码
- 修改了 `startTestCountdown` 函数，生成测试二维码

### 3. 二维码生成逻辑

```javascript
// 生成二维码
const generateQRCode = async (text) => {
  try {
    const qrCodeDataURL = await QRCode.toDataURL(text, {
      width: 200,
      margin: 2,
      color: {
        dark: '#000000',
        light: '#FFFFFF'
      }
    })
    return qrCodeDataURL
  } catch (error) {
    console.error('生成二维码失败:', error)
    return null
  }
}
```

### 4. 支付流程中的二维码生成

在创建支付时：

1. 如果后端返回了 `codeUrl` 或 `qrCodeUrl`，使用这个真实的支付链接生成二维码
2. 如果没有返回支付链接，使用订单信息生成一个包含订单号和金额的二维码
3. 生成的二维码是 base64 格式的图片，可以直接在 `<img>` 标签中显示

## 测试功能

### 1. 二维码测试页面

访问 `/qr-test` 路径可以看到一个简单的二维码测试页面，您可以：

- 输入任意文本
- 点击"生成二维码"按钮
- 查看生成的二维码图片

### 2. 支付页面测试

在支付页面中：

- 点击"测试倒计时"按钮可以生成一个测试二维码
- 二维码下方会显示调试信息，包括：
  - 二维码类型（Base64图片或普通URL）
  - 二维码数据长度
  - 二维码内容前缀

## 实际使用

当您的后端支付接口返回真实的支付链接时，系统会自动：

1. 获取支付链接（`codeUrl` 或 `qrCodeUrl`）
2. 使用这个链接生成二维码
3. 显示二维码供用户扫描支付

## 二维码配置选项

您可以在 `generateQRCode` 函数中调整二维码的样式：

```javascript
const qrCodeDataURL = await QRCode.toDataURL(text, {
  width: 200,        // 二维码宽度
  margin: 2,         // 边距
  color: {
    dark: '#000000', // 前景色（黑色）
    light: '#FFFFFF' // 背景色（白色）
  }
})
```

## 注意事项

1. 二维码生成是异步操作，需要使用 `await`
2. 生成的二维码是 base64 格式的图片数据
3. 如果生成失败，会返回 `null`，代码会使用备用的占位符图片
4. 二维码的内容可以是任何文本，包括URL、订单信息等

现在您的二维码功能应该可以正常工作了！ 
import{d as a,a as s}from"./index-BuScbc3L.js";/* empty css                 */import{_ as e}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                        *//* empty css               *//* empty css                         */import{r as t,q as l,N as i,B as c,ax as r,K as n,M as u,y as o,u as d,A as p,V as v,aj as m,a6 as y,a7 as f,O as k,ah as g,E as h,Q as P,z as C,aP as _,aQ as A,aR as D,Y as N,L as w,J as I}from"./element-plus-D8DMz00a.js";import{O as b,b as j,g as x,P as E,q as T,d as L}from"./pay-D_1k_pGE.js";/* empty css                       *//* empty css                 *//* empty css                   */const S={class:"order-detail-container"},O={key:0,class:"loading-container"},U={key:1,class:"order-detail"},q={class:"order-status-section"},z={class:"status-icon"},B={class:"status-info"},F={key:0},H={key:1},R={key:2},J={class:"order-info-section"},M={class:"info-grid"},Q={class:"info-item"},V={class:"value"},W={class:"info-item"},Y={class:"value"},K={key:0,class:"info-item"},$={class:"value"},G={class:"info-item"},X={key:1,class:"info-item"},Z={class:"value"},aa={class:"info-item pickup-code-item"},sa={key:0,class:"pickup-code"},ea={key:1,class:"pickup-code-pending"},ta={class:"products-section"},la={class:"product-list"},ia={class:"product-details"},ca={class:"product-name"},ra={key:0,class:"product-specs"},na={class:"product-price"},ua={class:"product-quantity"},oa={class:"product-subtotal"},da={key:0,class:"payment-section"},pa={class:"info-grid"},va={class:"info-item"},ma={class:"value"},ya={key:0,class:"info-item"},fa={class:"value"},ka={class:"info-item"},ga={class:"amount-section"},ha={class:"amount-details"},Pa={class:"amount-item"},Ca={class:"amount-item total"},_a={class:"total-price"},Aa={class:"action-section"},Da={key:2,class:"error-container"},Na=e({__name:"OrderDetailView",setup(e){const Na=s(),wa=a(),Ia=t(null),ba=t(null),ja=t(!1),fetchOrderDetail=async()=>{try{ja.value=!0;const a=wa.params.orderNo;if(!a)return h.error("订单号不存在"),void Na.push("/orders");const s=await x(a);0===s.data.code?(Ia.value=s.data.data,Ia.value.status===b.PAID&&await fetchPaymentDetail(a)):h.error(s.message||"获取订单详情失败")}catch(a){h.error("获取订单详情失败")}finally{ja.value=!1}},fetchPaymentDetail=async a=>{try{const s=await T(a);0===s.data.code&&(ba.value=s.data.data)}catch(s){}},payOrder=()=>{const a={orderNo:Ia.value.orderNo,amount:Ia.value.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(a)),Na.push("/payment")},cancelOrder$1=()=>{I.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await L(Ia.value.orderNo);0===a.data.code?(h.success("订单取消成功"),await fetchOrderDetail()):h.error(a.message||"取消订单失败")}catch(a){h.error("取消订单失败")}}).catch(()=>{})},confirmReceipt=()=>{I.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(()=>{h.success("确认收货成功"),fetchOrderDetail()}).catch(()=>{})},goBack=()=>{Na.go(-1)},getStatusType=a=>{switch(a){case b.UNPAID:return"warning";case b.PAID:return"success";case b.CANCELLED:return"danger";default:return"info"}},getStatusText=a=>{switch(a){case b.UNPAID:return"待支付";case b.PAID:return"已支付";case b.CANCELLED:return"已取消";default:return"未知状态"}},getPaymentMethodText=a=>{switch(a){case E.ALIPAY:return"支付宝";case E.WECHAT:return"微信支付";default:return"未知"}},formatTime=a=>{if(!a)return"";return new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})};return l(()=>{fetchOrderDetail()}),(a,s)=>{const e=r,t=P,l=m,h=w,I=k,x=g;return C(),i("div",S,[ja.value?(C(),i("div",O,[c(e,{rows:8,animated:""})])):Ia.value?(C(),i("div",U,[n("div",q,[n("div",z,[Ia.value.status===d(b).PAID?(C(),o(t,{key:0,class:"success-icon",size:"60"},{default:p(()=>[c(d(_))]),_:1})):Ia.value.status===d(b).CANCELLED?(C(),o(t,{key:1,class:"error-icon",size:"60"},{default:p(()=>[c(d(A))]),_:1})):(C(),o(t,{key:2,class:"warning-icon",size:"60"},{default:p(()=>[c(d(D))]),_:1}))]),n("div",B,[n("h2",null,v(getStatusText(Ia.value.status)),1),Ia.value.status===d(b).PAID?(C(),i("p",F,"您的订单已支付成功")):Ia.value.status===d(b).CANCELLED?(C(),i("p",H,"订单已取消")):(C(),i("p",R,"请尽快完成支付"))])]),n("div",J,[s[6]||(s[6]=n("h3",null,"订单信息",-1)),n("div",M,[n("div",Q,[s[0]||(s[0]=n("span",{class:"label"},"订单号：",-1)),n("span",V,v(Ia.value.orderNo),1)]),n("div",W,[s[1]||(s[1]=n("span",{class:"label"},"下单时间：",-1)),n("span",Y,v(formatTime(Ia.value.createTime)),1)]),Ia.value.payTime?(C(),i("div",K,[s[2]||(s[2]=n("span",{class:"label"},"支付时间：",-1)),n("span",$,v(formatTime(Ia.value.payTime)),1)])):u("",!0),n("div",G,[s[3]||(s[3]=n("span",{class:"label"},"订单状态：",-1)),c(l,{type:getStatusType(Ia.value.status)},{default:p(()=>[N(v(getStatusText(Ia.value.status)),1)]),_:1},8,["type"])]),Ia.value.remarks?(C(),i("div",X,[s[4]||(s[4]=n("span",{class:"label"},"订单备注：",-1)),n("span",Z,v(Ia.value.remarks),1)])):u("",!0),n("div",aa,[s[5]||(s[5]=n("span",{class:"label"},"取件码：",-1)),Ia.value.status===d(b).PAID?(C(),i("span",sa,v(Ia.value.pickupCode||"WHUT2024"),1)):(C(),i("span",ea," 支付成功后显示取件码 "))])])]),n("div",ta,[s[7]||(s[7]=n("h3",null,"商品信息",-1)),n("div",la,[(C(!0),i(y,null,f(Ia.value.orderItems,(a,s)=>(C(),i("div",{key:s,class:"product-item"},[c(h,{src:a.productImage,class:"product-image",fit:"cover"},null,8,["src"]),n("div",ia,[n("div",ca,v(a.productName),1),a.specs?(C(),i("div",ra," 规格："+v(Object.entries(a.specs).map(([a,s])=>`${s}`).join("、")),1)):u("",!0),n("div",na,"¥"+v(a.productPrice.toFixed(2)),1)]),n("div",ua,"x"+v(a.quantity),1),n("div",oa," ¥"+v((a.productPrice*a.quantity).toFixed(2)),1)]))),128))])]),ba.value?(C(),i("div",da,[s[11]||(s[11]=n("h3",null,"支付信息",-1)),n("div",pa,[n("div",va,[s[8]||(s[8]=n("span",{class:"label"},"支付方式：",-1)),n("span",ma,v(getPaymentMethodText(ba.value.payPlatform)),1)]),ba.value.payTime?(C(),i("div",ya,[s[9]||(s[9]=n("span",{class:"label"},"支付时间：",-1)),n("span",fa,v(formatTime(ba.value.payTime)),1)])):u("",!0),n("div",ka,[s[10]||(s[10]=n("span",{class:"label"},"支付状态：",-1)),c(l,{type:ba.value.status===d(j).SUCCESS?"success":"warning"},{default:p(()=>[N(v(ba.value.status===d(j).SUCCESS?"已支付":"未支付"),1)]),_:1},8,["type"])])])])):u("",!0),n("div",ga,[s[14]||(s[14]=n("h3",null,"金额明细",-1)),n("div",ha,[n("div",Pa,[s[12]||(s[12]=n("span",null,"商品总价：",-1)),n("span",null,"¥"+v(Ia.value.totalPrice.toFixed(2)),1)]),n("div",Ca,[s[13]||(s[13]=n("span",null,"实付金额：",-1)),n("span",_a,"¥"+v(Ia.value.totalPrice.toFixed(2)),1)])])]),n("div",Aa,[c(I,{onClick:goBack},{default:p(()=>[...s[15]||(s[15]=[N("返回",-1)])]),_:1}),Ia.value.status===d(b).UNPAID?(C(),o(I,{key:0,type:"primary",onClick:payOrder},{default:p(()=>[...s[16]||(s[16]=[N(" 立即支付 ",-1)])]),_:1})):u("",!0),Ia.value.status===d(b).UNPAID?(C(),o(I,{key:1,type:"danger",onClick:cancelOrder$1},{default:p(()=>[...s[17]||(s[17]=[N(" 取消订单 ",-1)])]),_:1})):u("",!0),Ia.value.status===d(b).PAID?(C(),o(I,{key:2,type:"success",onClick:confirmReceipt},{default:p(()=>[...s[18]||(s[18]=[N(" 确认收货 ",-1)])]),_:1})):u("",!0)])])):(C(),i("div",Da,[c(x,{description:"订单不存在或已被删除"},{default:p(()=>[c(I,{type:"primary",onClick:goBack},{default:p(()=>[...s[19]||(s[19]=[N("返回",-1)])]),_:1})]),_:1})]))])}}},[["__scopeId","data-v-69822995"]]);export{Na as default};

import{d as e,a}from"./index-BuScbc3L.js";/* empty css                   *//* empty css                    *//* empty css               *//* empty css                 */import{_ as s}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                         *//* empty css                        */import{c as l,d as t,e as i}from"./shop-cKho_Rxx.js";import{u as c}from"./cart-Dkt6AmB0.js";/* empty css                 */import{r as u,a as o,d as n,w as r,q as d,N as p,M as v,z as m,a6 as f,a7 as y,K as h,V as k,a5 as b,B as g,av as I,E as _,a3 as j,ag as S,y as w,A,aB as x,ay as C,aC as N,aD as q,aE as P,Y as z,az as K,al as V,am as F,L as O,u as B,O as E,au as L,aF as M}from"./element-plus-D8DMz00a.js";const T={key:0,class:"spec-selector"},D={class:"spec-title"},H={class:"spec-values"},J=["onClick"],U={key:0,class:"spec-info"},Y={class:"price-info"},$={class:"price"},G={key:0,class:"adjustment"},Q={class:"stock-info"},R={key:1,class:"spec-hint"},W=s({__name:"SpecificationSelector",props:{productId:{type:[String,Number],required:!0},basePrice:{type:Number,required:!0},hasSpecification:{type:Boolean,default:!1},specifications:{type:Array,default:()=>[]}},emits:["specification-selected","specification-change"],setup(e,{emit:a}){const s=e,i=a,c=u([]),j=o({}),S=u(null),w=u(!1),A=n(()=>{if(!S.value)return s.basePrice.toFixed(2);return(s.basePrice+S.value.priceAdjustment).toFixed(2)}),isSpecValueDisabled=(e,a)=>!s.specifications.some(s=>s.specifications[e]===a&&s.stock>0),findMatchingSpecification=()=>{const e=Object.keys(j),a=[];for(const s of c.value)a.push(s.specKey);if(e.length!==a.length)return S.value=null,void i("specification-change",null);const l=s.specifications.find(e=>a.every(a=>e.specifications[a]===j[a]));l?(S.value=l,i("specification-selected",l)):fetchSpecificationBySelection()},fetchSpecificationBySelection=async()=>{w.value=!0;try{const e=await t(s.productId,j);0===e.data.code?S.value=e.data.data:_.warning("获取规格信息失败，请重新选择")}catch(e){_.error(e.msg)}finally{w.value=!1}},loadSpecOptions=()=>{s.hasSpecification&&s.productId&&(w.value=!0,l(s.productId).then(e=>{0===e.data.code&&(c.value=e.data.data)}).catch(e=>{_.error(e.msg)}).finally(()=>{w.value=!1}))};return r(()=>s.productId,()=>{s.productId&&s.hasSpecification&&loadSpecOptions()},{immediate:!0}),r(()=>s.hasSpecification,e=>{e&&s.productId?loadSpecOptions():(c.value={},Object.keys(j).forEach(e=>delete j[e]),S.value=null)},{immediate:!0}),r(()=>j,()=>{j&&fetchSpecificationBySelection()},{deep:!0}),d(()=>{s.productId&&s.hasSpecification&&loadSpecOptions()}),(a,s)=>{const l=I;return e.hasSpecification?(m(),p("div",T,[(m(!0),p(f,null,y(c.value,e=>{return m(),p("div",{key:e.id,class:"spec-group"},[h("div",D,k((a=e.specKey,{color:"颜色",size:"尺码",material:"材质",style:"款式"}[a]||a))+":",1),h("div",H,[(m(!0),p(f,null,y(e.specValues,a=>(m(),p("span",{key:a,class:b(["spec-value",j[e.specKey]===a?"selected":"",isSpecValueDisabled(e.specKey,a)?"disabled":""]),onClick:s=>{return!isSpecValueDisabled(e.specKey,a)&&(l=e.specKey,t=a,j[l]=t,void findMatchingSpecification());var l,t}},k(a),11,J))),128))])]);var a}),128)),S.value?(m(),p("div",U,[h("div",Y,[s[0]||(s[0]=h("span",{class:"label"},"现价:",-1)),h("span",$,"¥"+k(A.value),1),0!==S.value.priceAdjustment?(m(),p("span",G," ("+k(S.value.priceAdjustment>0?"+":"")+k(S.value.priceAdjustment)+") ",1)):v("",!0)]),h("div",Q,[s[1]||(s[1]=h("span",{class:"label"},"库存:",-1)),h("span",{class:b(["stock",{"low-stock":S.value.stock<10}])},k(S.value.stock>0?S.value.stock:"无货"),3)])])):v("",!0),!S.value&&Object.keys(j).length>0?(m(),p("div",R,[g(l,{title:"请选择完整的规格组合",type:"warning",closable:!1,"show-icon":""})])):v("",!0)])):v("",!0)}}},[["__scopeId","data-v-828efb6c"]]),X={class:"product-detail"},Z={key:0},ee={class:"product-gallery"},ae={key:1,class:"thumbnail-list"},se=["onClick"],le={class:"product-info"},te={class:"product-name"},ie={class:"product-subtitle"},ce={class:"product-meta"},ue={class:"price-row"},oe={class:"price"},ne={class:"stock-row"},re={class:"sales-row"},de={class:"sales"},pe={key:0,class:"spec-selection"},ve={class:"quantity-selection"},me={class:"quantity-control"},fe={class:"total-price-section"},ye={class:"total-price"},he={class:"action-buttons"},ke={class:"product-detail-content"},be=["innerHTML"],ge=s({__name:"ProductDetail",setup(s){const l=e(),t=a(),o=c(),r=u(!0),I=u(null),T=u([]),D=u("detail"),H=u(null),J=u(!1),U=u(1),Y=n(()=>{if(!I.value)return 0;let e=I.value.price;return 1===I.value.hasSpecification&&H.value&&(e=Number(e)+Number(H.value.priceAdjustment)),(e*U.value).toFixed(2)}),processImages=()=>{if(I.value&&(T.value=[],I.value.mainImage&&T.value.push(I.value.mainImage),I.value.subImages)){let e=I.value.subImages;"string"==typeof e?e=e.split(",").map(e=>e.trim()):Array.isArray(e)&&(e=[...e]),T.value.push(...e)}},handleSpecificationSelected=e=>{H.value=e,J.value=e&&e.stock>0,U.value=1},handleSpecificationChange=()=>{J.value=!1},increaseQuantity=()=>{const e=1===I.value.hasSpecification&&H.value?H.value.stock:I.value.stock;U.value<e?U.value++:_.warning("已达到最大库存数量")},decreaseQuantity=()=>{U.value>1&&U.value--},addToCartHandler=async()=>{if(!J.value)return void _.warning("请先选择有效的商品规格");const e={productId:I.value.id,productName:I.value.name,productImage:I.value.mainImage,productPrice:I.value.price,quantity:U.value,stock:1===I.value.hasSpecification&&H.value?H.value.stock:I.value.stock,selected:!0};1===I.value.hasSpecification&&H.value?(e.specificationId=H.value.id,e.specs=H.value.specifications,e.priceAdjustment=H.value.priceAdjustment):e.priceAdjustment=0;await o.addToCart(e)&&_.success("已添加到购物车")},buyNow=async()=>{if(!J.value)return void _.warning("请先选择有效的商品规格");const e={productId:I.value.id,productName:I.value.name,productImage:I.value.mainImage,productPrice:I.value.price,quantity:U.value,stock:1===I.value.hasSpecification&&H.value?H.value.stock:I.value.stock,selected:!0};1===I.value.hasSpecification&&H.value?(e.specificationId=H.value.id,e.specs=H.value.specifications,e.priceAdjustment=H.value.priceAdjustment):e.priceAdjustment=0;const a=e.productPrice+(e.priceAdjustment||0),s=a*e.quantity;e.actualPrice=a;const l={products:[e],totalAmount:s,isBuyNow:!0};localStorage.setItem("checkout_order",JSON.stringify(l)),t.push("/checkout")},goBack=()=>{t.push("/shop")};return d(()=>{const e=l.params.id;e?(async e=>{r.value=!0;try{const a=await i(e);0===a.data.code&&(I.value=a.data.data,0===I.value.hasSpecification&&I.value.stock&&(J.value=!0),processImages())}catch(a){_.error("获取商品详情失败")}finally{r.value=!1}})(e):r.value=!1}),(e,a)=>{const s=P,t=x,i=O,c=F,u=V,o=K,n=E,d=L,_=C,$=M,G=N,Q=q,R=S;return j((m(),p("div",X,[I.value?(m(),p("div",Z,[g(t,{separator:"/"},{default:A(()=>[g(s,{to:{path:"/"}},{default:A(()=>[...a[2]||(a[2]=[z("首页",-1)])]),_:1}),g(s,{to:{path:"/shop",query:{categoryId:I.value.categoryId}}},{default:A(()=>[z(k(I.value.categoryName),1)]),_:1},8,["to"]),g(s,null,{default:A(()=>[z(k(I.value.name),1)]),_:1})]),_:1}),g(_,{gutter:30,class:"product-info-container"},{default:A(()=>[g(o,{span:12},{default:A(()=>[h("div",ee,[T.value.length>0?(m(),w(u,{key:0,interval:4e3,type:"card",height:"400px",ref:"carousel"},{default:A(()=>[(m(!0),p(f,null,y(T.value,(e,a)=>(m(),w(c,{key:a},{default:A(()=>[g(i,{src:e,fit:"contain",class:"carousel-image"},null,8,["src"])]),_:2},1024))),128))]),_:1},512)):v("",!0),T.value.length>1?(m(),p("div",ae,[(m(!0),p(f,null,y(T.value,(a,s)=>(m(),p("div",{key:s,class:"thumbnail-item",onClick:a=>e.$refs.carousel.setActiveItem(s)},[g(i,{src:a,fit:"cover"},null,8,["src"])],8,se))),128))])):v("",!0)])]),_:1}),g(o,{span:12},{default:A(()=>[h("div",le,[h("h1",te,k(I.value.name),1),h("p",ie,k(I.value.subtitle),1),h("div",ce,[h("div",ue,[a[3]||(a[3]=h("span",{class:"label"},"原价:",-1)),h("span",oe,"¥"+k(I.value.price.toFixed(2)),1)]),h("div",ne,[a[4]||(a[4]=h("span",{class:"label"},"库存:",-1)),h("span",{class:b(["stock",{"low-stock":I.value.stock<10}])},k(I.value.stock>0?I.value.stock:"无货"),3)]),h("div",re,[a[5]||(a[5]=h("span",{class:"label"},"销量:",-1)),h("span",de,k(I.value.sales),1)])]),1===I.value.hasSpecification?(m(),p("div",pe,[g(W,{productId:Number(B(l).params.id),basePrice:I.value.price,hasSpecification:1===I.value.hasSpecification,specifications:I.value.specifications,onSpecificationSelected:handleSpecificationSelected,onSpecificationChange:handleSpecificationChange},null,8,["productId","basePrice","hasSpecification","specifications"])])):v("",!0),h("div",ve,[a[8]||(a[8]=h("span",{class:"label"},"数量:",-1)),h("div",me,[g(n,{type:"primary",circle:"",size:"small",onClick:decreaseQuantity,disabled:U.value<=1},{default:A(()=>[...a[6]||(a[6]=[z("-",-1)])]),_:1},8,["disabled"]),g(d,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),min:1,max:1===I.value.hasSpecification&&H.value?H.value.stock:I.value.stock,size:"small",style:{width:"120px"},disabled:!J.value},null,8,["modelValue","max","disabled"]),g(n,{type:"primary",circle:"",size:"small",onClick:increaseQuantity,disabled:!J.value},{default:A(()=>[...a[7]||(a[7]=[z("+",-1)])]),_:1},8,["disabled"])])]),h("div",fe,[a[9]||(a[9]=h("span",{class:"label"},"总价:",-1)),h("span",ye,"¥"+k(Y.value),1)]),h("div",he,[g(n,{type:"primary",size:"large",disabled:!J.value,onClick:addToCartHandler},{default:A(()=>[...a[10]||(a[10]=[z(" 加入购物车 ",-1)])]),_:1},8,["disabled"]),g(n,{type:"danger",size:"large",disabled:!J.value,onClick:buyNow},{default:A(()=>[...a[11]||(a[11]=[z(" 立即购买 ",-1)])]),_:1},8,["disabled"])])])]),_:1})]),_:1}),h("div",ke,[g(G,{modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value=e)},{default:A(()=>[g($,{label:"商品详情",name:"detail"},{default:A(()=>[h("div",{class:"detail-content",innerHTML:I.value.detail},null,8,be)]),_:1})]),_:1},8,["modelValue"])])])):v("",!0),r.value||I.value?v("",!0):(m(),w(Q,{key:1,icon:"error",title:"商品加载失败","sub-title":"未找到商品信息或者商品已下架"},{extra:A(()=>[g(n,{type:"primary",onClick:goBack},{default:A(()=>[...a[12]||(a[12]=[z("返回商城",-1)])]),_:1})]),_:1}))])),[[R,r.value]])}}},[["__scopeId","data-v-a652f22b"]]);export{ge as default};

import{al as V,a as $,u as b,E as C,Y as H,r as A,L as M,l as D,J as S,h as z,P as O,Q as j,M as L,N as U,T}from"./index-C7uw_EaC.js";import{_ as N}from"./_plugin-vue_export-helper-DedD7E0N.js";function B(e){return new Promise(r=>setTimeout(r,e))}function x(e={}){const{retries:r=3,baseMs:i=1e3,capMs:u=3e4,strategy:y="exponential",jitter:l=!0,shouldRetry:s}=e,f=o=>{let c;y==="fixed"?c=i:y==="linear"?c=i*(o+1):c=i*Math.pow(2,o);const t=Math.min(c,u);return l?Math.floor(Math.random()*t):t},n=(o,c)=>c<r;return async function(c){const t=r+1;let h;for(let a=0;a<t;a++)try{return await c()}catch(p){h=p;const d=(s??n)(p,a),g=a>=r;if(!d||g)throw p;const m=f(a);await B(m)}throw h}}async function K(e,r={}){return x(r)(e)}var E=null,P=[],q=!0,R=new Map;function _(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(_).join(",")}]`:`{${Object.entries(e).sort(([i],[u])=>i<u?-1:i>u?1:0).map(([i,u])=>`${JSON.stringify(i)}:${_(u)}`).join(",")}}`}function J(e,r,i,u){const y=i!=null&&i.params?_(i.params):"",l=u!==void 0?_(u):"";return`${e.toUpperCase()} ${r}?${y} body:${l}`}async function F(e){let r=e;for(const i of P)i.onRequest&&(r=await i.onRequest(r));return r}async function G(e){let r=e;for(const i of P)i.onResponse&&(r=await i.onResponse(r));return r&&"data"in r?r.data:r}async function Q(e){for(const r of P)r.onError&&await r.onError(e);throw e}function W(e){const{baseURL:r,plugins:i=[],retry:u={retries:1},requestDedup:y=!0,timeout:l=1e4}=e;E=V.create({baseURL:r,timeout:l}),E.interceptors.request.use(n=>(n.__startTime=Date.now(),n)),E.interceptors.response.use(n=>{const o=n.config.__startTime;return n.duration=typeof o=="number"?Date.now()-o:0,n},n=>{if(n&&n.config){const o=n.config.__startTime;n.response&&(n.response.duration=typeof o=="number"?Date.now()-o:0)}return Promise.reject(n)}),P=i,q=y;const s=async(n,o,c,t)=>{if(!E)throw new Error("Axios instance not initialized");const h={...t??{},method:n,url:o,data:c},a=await F(h),p=async()=>{try{const m=await E.request(a);return await G(m)}catch(m){let v=m;try{await Q(v)}catch{}throw v}},d=()=>K(p,{...u??{},...(t==null?void 0:t.retryConfig)??{}});if(((t==null?void 0:t.enableDedup)??!0)&&q&&a.method&&a.url){const m=J(a.method,a.url,a,a.data);if(R.has(m))return R.get(m);const v=d().finally(()=>R.delete(m));return R.set(m,v),v}return d()},f={get:(n,o)=>s("GET",n,void 0,o),delete:(n,o)=>s("DELETE",n,void 0,o),head:(n,o)=>s("HEAD",n,void 0,o),options:(n,o)=>s("OPTIONS",n,void 0,o),post:(n,o,c)=>s("POST",n,o,c),put:(n,o,c)=>s("PUT",n,o,c),patch:(n,o,c)=>s("PATCH",n,o,c)};return w.get=f.get,w.post=f.post,w.put=f.put,w.delete=f.delete,w.patch=f.patch,w.head=f.head,w.options=f.options,f}var w={get:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},post:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},put:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},delete:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},patch:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},head:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},options:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")}};function Y(e={}){const{getToken:r=()=>null,refreshToken:i,onTokenExpired:u,tokenHeader:y="Authorization",tokenPrefix:l="Bearer "}=e;return{name:"auth",async onRequest(s){const f=await r();return f&&(s.headers=s.headers??{},s.headers[y]=`${l}${f}`),s},async onError(s){if(s&&s.status===401)try{await(u==null?void 0:u())}catch{}throw s}}}const I=$();let k=!1;W({baseURL:"http://localhost:8080",timeout:1e4,plugins:[Y({getToken:()=>localStorage.getItem("token"),onTokenExpired:()=>{if(k)return;k=!0,b().userinfo.token?(C.warning("登录已过期，请重新登录"),b().logout()):C.warning("请先登录");const r=I.currentRoute.value.fullPath;r!=="/login"&&I.push({path:"/login",query:{redirect:r}}),setTimeout(()=>{k=!1},1e3)}})]});const at=e=>H({url:"/api/auth/send-code",method:"post",data:e}),ot=e=>H({url:"/api/auth/register",method:"post",data:e}),st=e=>w.post("/api/auth/login",e),it=e=>H({url:"/api/auth/reset-password",method:"post",data:e}),X={class:"verification-code-input"},Z={class:"code-inputs"},tt=["onUpdate:modelValue","onInput","onKeydown"],et={__name:"VerificationCodeInput",props:{modelValue:{type:String,default:""},length:{type:Number,default:6}},emits:["update:modelValue"],setup(e,{expose:r,emit:i}){const u=e,y=i,l=A(Array(u.length).fill("")),s=A([]),f=(t,h)=>{t&&(s.value[h]=t)};M(()=>u.modelValue,t=>{t!==l.value.join("")&&(l.value=t.split("").concat(Array(u.length).fill("")).slice(0,u.length))},{immediate:!0}),M(l,t=>{const h=t.join("");y("update:modelValue",h)},{deep:!0});const n=(t,h)=>{const a=h.replace(/\D/g,"");l.value[t]=a,a&&t<u.length-1&&T(()=>{var p;(p=s.value[t+1])==null||p.focus()})},o=(t,h)=>{h.key==="Backspace"&&!l.value[t]&&t>0?T(()=>{var a;(a=s.value[t-1])==null||a.focus()}):h.key==="ArrowLeft"&&t>0?T(()=>{var a;(a=s.value[t-1])==null||a.focus()}):h.key==="ArrowRight"&&t<u.length-1&&T(()=>{var a;(a=s.value[t+1])==null||a.focus()})},c=t=>{t.preventDefault();const a=t.clipboardData.getData("text").replace(/\D/g,"").split("").slice(0,u.length);a.forEach((d,g)=>{g<u.length&&(l.value[g]=d)});const p=Math.min(a.length-1,u.length-1);T(()=>{var d;(d=s.value[p])==null||d.focus()})};return r({focus:()=>{var t;(t=s.value[0])==null||t.focus()},clear:()=>{var t;l.value=Array(u.length).fill(""),(t=s.value[0])==null||t.focus()}}),(t,h)=>(S(),D("div",X,[z("div",Z,[(S(!0),D(O,null,j(l.value,(a,p)=>L((S(),D("input",{key:p,"onUpdate:modelValue":d=>l.value[p]=d,ref_for:!0,ref:d=>f(d,p),maxlength:"1",class:"code-digit",onInput:d=>n(p,d.target.value),onKeydown:d=>o(p,d),onPaste:c,type:"text",inputmode:"numeric",pattern:"[0-9]*"},null,40,tt)),[[U,l.value[p]]])),128))])]))}},ut=N(et,[["__scopeId","data-v-d1422850"]]);export{ut as V,at as a,ot as b,st as c,it as d};

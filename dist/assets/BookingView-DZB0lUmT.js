import{Y as e,r as a,K as t,o as l,Z as s,_ as i,l as n,h as o,M as r,k as u,g as c,w as d,$ as v,a0 as m,a1 as p,f as g,P as f,Q as y,a2 as b,a3 as h,a4 as k,A as _,x as w,a5 as V,E as D,a6 as S,J as x,a7 as T,O as C,m as $,a8 as j,d as N,L as z,a9 as H,aa as Y,a as O,j as P,ab as U,p as M,ac as R,q as I,ad as E,ae as A,af as q,ag as F,ah as B,ai as L,aj as Z,ak as G,U as J}from"./index-BMm2wflY.js";import{c as K}from"./venueOrder-KIm4tj_0.js";/* empty css                   *//* empty css               *//* empty css                *//* empty css                         *//* empty css               *//* empty css                  *//* empty css                     */import{_ as Q}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                             *//* empty css                 *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                         */import{f as W}from"./format-D0hGXpTN.js";/* empty css                     *//* empty css                 */const X={class:"notice-list-page"},ee={class:"filter-container"},ae={class:"notice-carousel-container"},te={class:"notice-header"},le={class:"notice-title"},se={class:"notice-meta"},ie={class:"notice-time"},ne={class:"notice-content"},oe={class:"notice-footer"},re={key:1,class:"empty-state"},ue={key:0,class:"notice-grid"},ce={class:"notice-grid-container"},de=["onClick"],ve={class:"grid-item-header"},me={class:"grid-item-title"},pe={class:"grid-item-time"},ge={key:1,class:"pagination-container"},fe={class:"notice-detail"},ye={class:"detail-meta"},be={class:"detail-time"},he={class:"detail-content"},ke=Q({__name:"NoticeList",setup(N){const z=a(null),H=a(!1),Y=a(1),O=a(5),P=a(0),U=a([]),M=a(!1),R=t({id:"",title:"",content:"",type:1,publishTime:""}),getTypeTag=e=>({1:"",2:"warning"}[e]||""),getTypeText=e=>({1:"普通通知",2:"重要通知"}[e]||"未知"),formatTime=e=>W(e,"YYYY-MM-DD HH:mm"),truncateContent=(e,a=100)=>e?e.length>a?e.substring(0,a)+"...":e:"",fetchNoticeList=async()=>{try{H.value=!0;const a=await function(a={}){return e({url:"/api/reservation/notice",method:"get",params:{pageNum:a.pageNum||1,pageSize:a.pageSize||10,type:a.type||null}})}({pageNum:Y.value,pageSize:O.value,type:z.value});0===a.data.code?(U.value=a.data.data.list,P.value=a.data.data.total):D.error(a.data.msg||"获取通知列表失败")}catch(a){D.error("获取通知列表失败")}finally{H.value=!1}},handleFilterChange=()=>{Y.value=1,fetchNoticeList()},handleCurrentChange=e=>{Y.value=e,fetchNoticeList()},handlePageSizeChange=e=>{O.value=e,Y.value=1,fetchNoticeList()},handleNoticeClick=async a=>{try{const l=await(t=a.id,e({url:`/api/reservation/notice/${t}`,method:"get"}));if(0===l.data.code){const e=l.data.data;Object.assign(R,e),M.value=!0}else D.error(l.data.msg||"获取通知详情失败")}catch(l){D.error("获取通知详情失败")}var t};return l(()=>{s().subscribe("venue_notice",e=>{i({title:"通知公告",message:e.payload,type:"info"})}),fetchNoticeList()}),(e,a)=>{const t=v,l=m,s=k,i=$,D=T,N=S,I=b,E=h,A=V,q=p;return x(),n("div",X,[a[4]||(a[4]=o("h2",{class:"page-title"},"通知公告",-1)),o("div",ee,[c(l,{modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),placeholder:"选择通知类型",clearable:"",onChange:handleFilterChange},{default:d(()=>[c(t,{label:"全部通知",value:null}),c(t,{label:"普通通知",value:1}),c(t,{label:"重要通知",value:2})]),_:1},8,["modelValue"])]),r((x(),n("div",ae,[U.value.length>0?(x(),g(N,{key:0,height:"300px",autoplay:!0,interval:5e3,"indicator-position":"outside",arrow:"hover",type:"card"},{default:d(()=>[(x(!0),n(f,null,y(U.value,e=>(x(),g(D,{key:e.id,onClick:a=>handleNoticeClick(e)},{default:d(()=>[o("div",{class:C(["notice-card",{important:2===e.type}])},[o("div",te,[o("h3",le,w(e.title),1),o("div",se,[c(s,{type:getTypeTag(e.type),size:"small"},{default:d(()=>[_(w(getTypeText(e.type)),1)]),_:2},1032,["type"]),o("span",ie,w(formatTime(e.publishTime)),1)])]),o("div",ne,w(truncateContent(e.content,200)),1),o("div",oe,[c(i,{type:"primary",size:"small",onClick:j(a=>handleNoticeClick(e),["stop"])},{default:d(()=>[...a[2]||(a[2]=[_(" 查看详情 ",-1)])]),_:1},8,["onClick"])])],2)]),_:2},1032,["onClick"]))),128))]),_:1})):u("",!0),H.value||0!==U.value.length?u("",!0):(x(),n("div",re,[c(I,{description:"暂无通知"})]))])),[[q,H.value]]),U.value.length>0?(x(),n("div",ue,[a[3]||(a[3]=o("h3",{class:"grid-title"},"所有通知",-1)),o("div",ce,[(x(!0),n(f,null,y(U.value,e=>(x(),n("div",{key:`grid-${e.id}`,class:C(["notice-grid-item",{important:2===e.type}]),onClick:a=>handleNoticeClick(e)},[o("div",ve,[o("span",me,w(e.title),1),c(s,{type:getTypeTag(e.type),size:"small"},{default:d(()=>[_(w(getTypeText(e.type)),1)]),_:2},1032,["type"])]),o("div",pe,w(formatTime(e.publishTime)),1)],10,de))),128))])])):u("",!0),P.value>0?(x(),n("div",ge,[c(E,{background:"","hide-on-single-page":!1,layout:"total, sizes, prev, pager, next",total:P.value,"page-size":O.value,"page-sizes":[5,8,10],"current-page":Y.value,onCurrentChange:handleCurrentChange,onSizeChange:handlePageSizeChange},null,8,["total","page-size","current-page"])])):u("",!0),c(A,{modelValue:M.value,"onUpdate:modelValue":a[1]||(a[1]=e=>M.value=e),title:R.title,width:"60%"},{default:d(()=>[o("div",fe,[o("div",ye,[c(s,{type:getTypeTag(R.type)},{default:d(()=>[_(w(getTypeText(R.type)),1)]),_:1},8,["type"]),o("span",be,"发布时间："+w(formatTime(R.publishTime)),1)]),o("div",he,w(R.content),1)])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-b58188c4"]]);const _e={class:"matrix-container"},we={class:"date-selector"},Ve={class:"date-info"},De={key:0,class:"workday-info"},Se={key:1,class:"weekend-info"},xe={class:"legend"},Te={class:"legend-text"},Ce={class:"matrix-table"},$e={class:"status-matrix"},je={class:"venue-name"},Ne=["onClick","title"],ze={class:"dialog-footer"},He=Q({__name:"VenueStatusMatrix",props:{visible:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:l}){const s=t,i=N({get:()=>s.visible});z(()=>s.visible,e=>{e&&fetchMatrixData()},{immediate:!0});const u=l,closeDialog=()=>{u("close")},v=a(!1),m=a({}),b=a(new Date),h=a([]),k=a([]),S={1:"#67c23a",2:"#909399",3:"#f56c6c",4:"#e6a23c"},T={1:"空闲中",2:"使用中",3:"已预约",4:"不开放"},fetchMatrixData=async()=>{if(s.visible){v.value=!0;try{const l=`${(t=b.value).getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,s=await(a={date:l},e({url:"/api/venue/status-matrix",method:"get",params:a}));0===s.data.code&&(m.value=s.data.data.statusMatrix||{},k.value=s.data.data.venues||[],h.value=s.data.data.timeSlots||[])}catch(l){D.error("获取场地状态矩阵失败")}finally{v.value=!1}var a,t}},isWeekday=e=>{const a=e.getDay();return a>=1&&a<=5},disabledDate=e=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date(a);t.setDate(t.getDate()+1);const l=new Date(e);return l.setHours(0,0,0,0),!(l.getTime()===a.getTime()||l.getTime()===t.getTime())},getCellStatus=(e,a)=>{const t=m.value[e];return t&&t[a]?t[a].status:1},getCellStyle=(e,a)=>{const t=getCellStatus(e,a);return{backgroundColor:S[t],color:"#fff",textAlign:"center",padding:"8px 4px",fontSize:"12px",cursor:"pointer",transition:"all 0.3s"}},handleDateChange=()=>{fetchMatrixData()};return(e,a)=>{const t=H,l=$,s=V,u=p;return x(),g(s,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),title:"场地使用情况表",width:"90%","close-on-click-modal":!1,onClose:closeDialog,class:"venue-matrix-dialog"},{footer:d(()=>[o("div",ze,[c(l,{onClick:closeDialog},{default:d(()=>[...a[4]||(a[4]=[_("关闭",-1)])]),_:1}),c(l,{type:"primary",onClick:fetchMatrixData},{default:d(()=>[...a[5]||(a[5]=[_("刷新数据",-1)])]),_:1})])]),default:d(()=>[o("div",_e,[o("div",we,[c(t,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),type:"date",placeholder:"选择查询日期",format:"YYYY年MM月DD日",onChange:handleDateChange,"disabled-date":disabledDate},null,8,["modelValue"]),o("div",Ve,[isWeekday(b.value)?(x(),n("span",De," 工作日：白天场地用于校内上课，仅晚上18:00-21:00开放预约 ")):(x(),n("span",Se," 周末：全天开放预约，时间为8:00-21:00 "))])]),o("div",xe,[(x(),n(f,null,y(S,(e,a)=>o("div",{class:"legend-item",key:a},[o("div",{class:"legend-color",style:Y({backgroundColor:e})},null,4),o("span",Te,w(T[a]),1)])),64))]),r((x(),n("div",Ce,[o("table",$e,[o("thead",null,[o("tr",null,[a[2]||(a[2]=o("th",{class:"venue-header"},"场地/时间",-1)),(x(!0),n(f,null,y(h.value,e=>(x(),n("th",{key:e,class:"time-header"},w(e),1))),128))])]),o("tbody",null,[(x(!0),n(f,null,y(k.value,e=>(x(),n("tr",{key:e.id},[o("td",je,w(e.name),1),(x(!0),n(f,null,y(h.value,a=>(x(),n("td",{key:a,class:"status-cell",style:Y(getCellStyle(e.id,a)),onClick:t=>((e,a)=>{const t=m.value[e.id];if(!t||!t[a])return;const l=t[a],s=l.status;let i="";i=1!==s?`${e.name} ${a} - ${T[s]} - ${l.reason}`:`${e.name} ${a} - ${T[s]}`,1===s?D.success(i):2===s?D.warning(i):3===s?D.error(i):4===s&&D.warning(i)})(e,a),title:`${e.name} ${a} - ${T[getCellStatus(e.id,a)]}`},w(T[getCellStatus(e.id,a)]),13,Ne))),128))]))),128))])])])),[[u,v.value]]),a[3]||(a[3]=o("div",{class:"matrix-info"},[o("p",null,[o("strong",null,"使用说明：")]),o("ul",null,[o("li",null,"点击单元格可查看详细信息"),o("li",null,"绿色表示可预约，红色表示已预约，橙色表示维护中，灰色表示不开放"),o("li",null,"工作日白天时间段场地用于校内上课，不对外开放"),o("li",null,"周末全天开放预约")])],-1))])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-64f68edf"]]),Ye={class:"create-order-form"},Oe={class:"form-header"},Pe={class:"form-title"},Ue={class:"form-section venue-section"},Me={class:"section-header"},Re={key:0,class:"venue-card"},Ie={class:"venue-info"},Ee={class:"venue-name"},Ae={class:"venue-description"},qe={class:"venue-price"},Fe={class:"price-value"},Be={class:"form-section time-section"},Le={class:"section-header"},Ze={class:"time-display-grid"},Ge={class:"time-display-item"},Je={class:"time-value"},Ke={class:"time-display-item"},Qe={class:"time-value"},We={class:"time-display-item"},Xe={class:"time-value"},ea={key:0,class:"booking-summary"},aa={class:"summary-item"},ta={class:"summary-value"},la={class:"summary-item total-price"},sa={class:"summary-value price"},ia={class:"price-note"},na={class:"form-section contact-section"},oa={class:"section-header"},ra={class:"contact-form-grid"},ua={class:"form-section notice-section"},ca={class:"section-header"},da={class:"notice-content"},va={class:"form-actions"},ma=Q({__name:"CreateOrderForm",props:{selectedVenue:{type:Object,default:()=>({})},reservationDate:{type:String,default:""},startTime:{type:String,default:""},endTime:{type:String,default:""}},emits:["cancel"],setup(e,{emit:t}){const l=O(),s=e,i=t,r=a(null),v=a(!1),m=a({venueId:"",contactName:"",contactPhone:"",remark:""}),p={venueId:[{required:!0,message:"请选择场地",trigger:"change"}],contactName:[{required:!0,message:"请输入联系人姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度在2-20个字符",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5a-zA-Z\s]+$/,message:"姓名只能包含中文、英文和空格",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],remark:[{max:200,message:"备注不能超过200个字符",trigger:"blur"}]},g=N(()=>{if(!s.startTime||!s.endTime)return 0;const[e]=s.startTime.split(":").map(Number),[a]=s.endTime.split(":").map(Number);return a-e}),f=N(()=>{var e;const a=(null==(e=s.selectedVenue)?void 0:e.price)||30;return Math.ceil(g.value)*a});z(()=>s.selectedVenue,e=>{(null==e?void 0:e.id)&&(m.value.venueId=e.id)},{immediate:!0});const handleSubmit=async()=>{if(!r.value)return!1;try{await r.value.validate();const a={venueId:s.selectedVenue.id,reservationDate:s.reservationDate,startTime:s.startTime,endTime:s.endTime,remark:m.value.contactName+" "+m.value.contactPhone+" "+m.value.remark};v.value=!0;try{D.info("正在创建订单...");const e=await K(a);if(0!==e.data.code)return D.error(e.data.message||"创建订单失败"),!1;l.push({path:"/payment",query:{orderNo:e.data.data.orderNo},state:{orderDetail:{id:e.data.data.id,venueName:s.selectedVenue.name,venueId:s.selectedVenue.id,reservationDate:a.reservationDate,startTime:a.startTime,endTime:a.endTime,duration:g.value,contactName:m.value.contactName,contactPhone:m.value.contactPhone,remark:e.data.data.remark,payTypeDesc:e.data.data.payTypeDesc,pricePerHour:e.data.data.pricePerHour||30,totalAmount:e.data.data.totalAmount}}})}catch(e){return D.error("创建订单失败，请重试"),!1}finally{v.value=!1}}catch(e){return!1}},handleCancel=()=>{i("cancel")};return(e,a)=>{const t=M,l=q,i=A,y=F,b=$,h=B;return x(),n("div",Ye,[o("div",Oe,[o("h3",Pe,[c(t,null,{default:d(()=>[c(P(U))]),_:1}),a[3]||(a[3]=_(" 创建预约订单 ",-1))]),a[4]||(a[4]=o("p",{class:"form-subtitle"},"请填写完整的预约信息，确保信息准确无误",-1))]),c(h,{ref_key:"formRef",ref:r,model:m.value,rules:p,"label-width":"100px",class:"order-form",size:"large"},{default:d(()=>{var e,r;return[o("div",Ue,[o("div",Me,[c(t,{class:"section-icon"},{default:d(()=>[c(P(R))]),_:1}),a[5]||(a[5]=o("h4",{class:"section-title"},"场地信息",-1))]),(null==(e=s.selectedVenue)?void 0:e.id)?(x(),n("div",Re,[o("div",Ie,[o("h5",Ee,w(s.selectedVenue.name),1),o("p",Ae,w(s.selectedVenue.description||"标准羽毛球场地，配备专业羽毛球网和照明设备"),1),o("div",qe,[a[6]||(a[6]=o("span",{class:"price-label"},"价格：",-1)),o("span",Fe,w(s.selectedVenue.price||30)+"元/小时",1)])])])):u("",!0)]),o("div",Be,[o("div",Le,[c(t,{class:"section-icon"},{default:d(()=>[c(P(I))]),_:1}),a[7]||(a[7]=o("h4",{class:"section-title"},"预约时间",-1))]),o("div",Ze,[o("div",Ge,[a[8]||(a[8]=o("span",{class:"time-label"},"预约日期",-1)),o("div",Je,w(s.reservationDate||"未选择"),1)]),o("div",Ke,[a[9]||(a[9]=o("span",{class:"time-label"},"开始时间",-1)),o("div",Qe,w(s.startTime||"未选择"),1)]),o("div",We,[a[10]||(a[10]=o("span",{class:"time-label"},"结束时间",-1)),o("div",Xe,w(s.endTime||"未选择"),1)])]),g.value>0?(x(),n("div",ea,[o("div",aa,[c(t,null,{default:d(()=>[c(P(E))]),_:1}),a[11]||(a[11]=o("span",{class:"summary-label"},"预约时长：",-1)),o("span",ta,w(g.value)+"小时",1)]),o("div",la,[c(t,null,{default:d(()=>[c(P(U))]),_:1}),a[12]||(a[12]=o("span",{class:"summary-label"},"预计费用：",-1)),o("span",sa,"¥"+w(f.value),1)]),o("div",ia," （按"+w((null==(r=s.selectedVenue)?void 0:r.price)||30)+"元/小时计算，不足1小时按1小时计费） ",1)])):u("",!0)]),o("div",na,[o("div",oa,[c(t,{class:"section-icon"},{default:d(()=>[c(P(U))]),_:1}),a[13]||(a[13]=o("h4",{class:"section-title"},"联系人信息",-1))]),o("div",ra,[c(i,{label:"联系人姓名",prop:"contactName"},{default:d(()=>[c(l,{modelValue:m.value.contactName,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value.contactName=e),placeholder:"请输入联系人姓名",disabled:v.value,clearable:"",size:"large"},{prefix:d(()=>[c(t,null,{default:d(()=>[c(P(U))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),c(i,{label:"联系电话",prop:"contactPhone"},{default:d(()=>[c(l,{modelValue:m.value.contactPhone,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.contactPhone=e),placeholder:"请输入手机号码",disabled:v.value,clearable:"",size:"large",maxlength:"11"},{prefix:d(()=>[c(t,null,{default:d(()=>[c(P(U))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),c(i,{label:"备注信息",prop:"remark"},{default:d(()=>[c(l,{modelValue:m.value.remark,"onUpdate:modelValue":a[2]||(a[2]=e=>m.value.remark=e),type:"textarea",placeholder:"请输入备注信息（选填）",disabled:v.value,rows:3,maxlength:"200","show-word-limit":"",resize:"none"},null,8,["modelValue","disabled"])]),_:1})]),o("div",ua,[o("div",ca,[c(t,{class:"section-icon"},{default:d(()=>[c(P(U))]),_:1}),a[14]||(a[14]=o("h4",{class:"section-title"},"预约须知",-1))]),o("div",da,[c(y,{title:"重要提醒",type:"warning",closable:!1,"show-icon":""},{default:d(()=>[...a[15]||(a[15]=[o("ul",{class:"notice-list"},[o("li",null,"请确保预约信息准确无误，提交后不可修改"),o("li",null,"如需取消预约，请至少提前半小时联系管理员"),o("li",null,"请爱护场地设施，如有损坏需要赔偿"),o("li",null,"场地内禁止吸烟，请保持环境整洁")],-1)])]),_:1})])]),o("div",va,[c(b,{size:"large",disabled:v.value,onClick:handleCancel},{default:d(()=>[...a[16]||(a[16]=[_(" 取消 ",-1)])]),_:1},8,["disabled"]),c(b,{type:"primary",size:"large",loading:v.value,onClick:handleSubmit},{default:d(()=>[_(w(v.value?"创建中...":"确认预约"),1)]),_:1},8,["loading"])])]}),_:1},8,["model"])])}}},[["__scopeId","data-v-3d5b6ff2"]]),pa={class:"booking-container"},ga={class:"booking-tools"},fa={class:"date-time-selector"},ya={class:"selector-group"},ba={class:"matrix-button-container"},ha={class:"date-status"},ka={class:"status-text"},_a={key:0,class:"selector-group time-selector"},wa={class:"time-picker-container"},Va={class:"time-picker"},Da={class:"time-picker"},Sa={class:"courts-container"},xa={key:0,class:"loading-container"},Ta={class:"court-info"},Ca={class:"court-name"},$a={class:"court-status"},ja={class:"court-description"},Na={class:"court-price"},za=Q({__name:"BookingView",setup(t){const isWeekday=e=>{const a=e.getDay();return a>=1&&a<=5},isWeekend=e=>{const a=e.getDay();return 0===a||6===a},isBookingTimeValid=(e,a)=>{const t=new Date,l=new Date;l.setHours(0,0,0,0);const s=new Date(l);s.setDate(s.getDate()+1);const i=new Date(e);if(i.setHours(0,0,0,0),i.getTime()===l.getTime()){const[e,l]=a.split(":").map(Number),s=new Date;return s.setHours(e,l,0,0),t.getTime()<s.getTime()}if(i.getTime()===s.getTime()){return t.getHours()>=18}return!1},getTimeRestrictionText=e=>{const a=new Date,t=new Date;t.setHours(0,0,0,0);const l=new Date(t);l.setDate(l.getDate()+1);const s=new Date(e);return s.setHours(0,0,0,0),s.getTime()===l.getTime()&&a.getHours()<18?"不在可预约时间（明天场地需今天18:00后预约）":null},getTimeOptionsForDate=e=>{const a=(e=>isWeekday(e)?["18:00-21:00"]:isWeekend(e)?["8:00-21:00"]:[])(e);if(0===a.length)return{startOptions:[],endOptions:[]};const t=[],l=[],s=a[0],[i,n]=s.split("-"),[o,r]=i.split(":").map(Number),[u,c]=n.split(":").map(Number);let d=o,v=r,m=u-1,p=c;for(p<v&&(m-=1,p+=60);d<m||d===m&&v<=p;){const a=`${d.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`;isBookingTimeValid(e,a)&&t.push(a),d+=1}let g=o+1,f=r;for(;g<u||g===u&&f<=c;){const e=`${g.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`;l.push(e),g+=1}return{startOptions:[...new Set(t)].sort(),endOptions:[...new Set(l)].sort()}},s=N(()=>getTimeOptionsForDate(r.value).startOptions||[]),i=N(()=>{const e=getTimeOptionsForDate(r.value);if(!p.value||0===e.endOptions.length)return[];const[a,t]=p.value.split(":").map(Number),l=`${(a+3).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`;return e.endOptions.filter(e=>e<=l&&e>p.value)}),r=a(new Date),p=a("18:00"),b=a("19:00");isWeekday(r.value)?(p.value="18:00",b.value="21:00"):(p.value="8:00",b.value="21:00");const handleDateChange=async e=>{s.value.length>0?(p.value=s.value[0],i.value.length>0&&(b.value=i.value[0])):(p.value="",b.value=""),p.value&&b.value&&p.value<b.value&&await checkVenueAvailability(e,p.value,b.value)},getDateStatusText=e=>{let a="";isWeekday(e)?a="工作日（仅晚上18:00-21:00开放）":isWeekend(e)&&(a="周末（全天开放8:00-21:00）");const t=getTimeRestrictionText(e);return t&&(a+=` - ${t}`),a},h=a([]),k=a(!1),fetchVenueList=async()=>{k.value=!0;try{const a=await e({url:"/api/venue/list",method:"get"});0===a.data.code?h.value=a.data.data.map(e=>({id:e.id,name:e.name,description:e.description,price:e.pricePerHour||20,status:e.status,bookable:!1,availabilityReason:"请选择时间段",location:e.location})):D.error(a.message||"获取场地列表失败")}catch(a){D.error("获取场地列表失败，请稍后重试")}finally{k.value=!1}},checkVenueAvailability=async(a,t,l)=>{try{const i=getTimeRestrictionText(a);if(i||!isBookingTimeValid(a,t))return void h.value.forEach(e=>{e.bookable=!1,e.availabilityReason=i||"不在可预约时间"});const n=(e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`)(a),o=await(s={date:n,startTime:t,endTime:l},e({url:"/api/venue/availability",method:"get",params:s}));if(0===o.data.code){const{availableVenues:e,unavailableVenues:a}=o.data.data;h.value.forEach(e=>{e.bookable=!1,e.availabilityReason="未知状态"}),e&&e.length>0&&e.forEach(e=>{const a=h.value.find(a=>a.id===e.id);a&&(a.bookable=!0,a.availabilityReason="可预约",void 0!==e.pricePerHour&&(a.price=e.pricePerHour))}),a&&a.length>0&&a.forEach(e=>{const a=h.value.find(a=>a.id===e.id);a&&(a.bookable=!1,a.availabilityReason=e.reason||"不可预约")})}}catch(i){h.value.forEach(e=>{e.bookable=!1,e.availabilityReason="检查失败"})}var s};l(async()=>{await fetchVenueList(),await handleDateChange(r.value),await handleStartTimeChange(p.value)});const S=a(!1),T=a(null),j=a(null),closeBookingDialog=()=>{S.value=!1,T.value=null},cancelBooking=()=>{closeBookingDialog()},z=a(!1),closeMatrixDialog=()=>{z.value=!1},openMatrixDialog=()=>{z.value=!0},isCourtBookable=e=>!!e.bookable&&(!(!p.value||!b.value)&&isBookingTimeValid(r.value,p.value)),getStatusClass=e=>e.bookable?"status-available":e.availabilityReason&&"请选择时间段"!==e.availabilityReason?"status-booked":"status-closed",getStatusText=e=>e.bookable?"可预约":e.availabilityReason||"状态未知",handleBookingSuccess=async()=>{closeBookingDialog(),D.success("预约成功！"),p.value&&b.value&&await checkVenueAvailability(r.value,p.value,b.value)},handleStartTimeChange=async e=>{if(0===s.value.length)return;e>=b.value&&(b.value=i.value[0]);b.value.split(":").map(Number)[0]-e.split(":").map(Number)[0]>3&&(b.value=i.value[i.value.length-1]),b.value&&await checkVenueAvailability(r.value,e,b.value)},handleEndTimeChange=async e=>{if(e<=p.value)if(isWeekday(r.value)){const a=i.value.indexOf(e);p.value=s.value[a]}else p.value="18:00";p.value&&await checkVenueAvailability(r.value,p.value,e)};return(e,a)=>{var t;const l=H,D=$,N=v,Y=m,O=L,U=J,M=G,R=Z,E=V;return x(),n("div",pa,[a[12]||(a[12]=o("div",{class:"page-header"},[o("h2",null,"场地预约")],-1)),c(ke),o("div",ga,[o("div",fa,[o("div",ya,[a[5]||(a[5]=o("p",null,"选择日期：",-1)),c(l,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),type:"date",placeholder:"选择预约日期","disabled-date":e=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date(a);return t.setDate(t.getDate()+1),!(e.toDateString()===a.toDateString()||e.toDateString()===t.toDateString())},format:"YYYY年MM月DD日",onChange:handleDateChange},null,8,["modelValue","disabled-date"])]),o("div",ba,[c(D,{type:"primary",icon:P(I),onClick:openMatrixDialog,class:"matrix-button-enhanced",size:"large"},{default:d(()=>[...a[6]||(a[6]=[o("span",{class:"button-text"},"查看场地使用情况表",-1),o("span",{class:"button-subtitle"},"实时查看所有场地状态",-1)])]),_:1},8,["icon"])]),o("div",ha,[o("span",ka,w(getDateStatusText(r.value)),1)]),s.value.length>0?(x(),n("div",_a,[a[8]||(a[8]=o("p",null,"时间段：",-1)),o("div",wa,[o("div",Va,[c(Y,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),placeholder:"开始时间",onChange:handleStartTimeChange,class:"time-select"},{default:d(()=>[(x(!0),n(f,null,y(s.value,e=>(x(),g(N,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a[7]||(a[7]=o("span",{class:"time-separator"},"至",-1)),o("div",Da,[c(Y,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=e=>b.value=e),placeholder:"结束时间",onChange:handleEndTimeChange,class:"time-select"},{default:d(()=>[(x(!0),n(f,null,y(i.value,e=>(x(),g(N,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])])):u("",!0)]),a[9]||(a[9]=o("div",{class:"booking-rules"},[o("p",null,[o("strong",null,"预约规则：")]),o("ul",null,[o("li",null,"工作日（周一至周五）：白天场地用于校内上课，仅晚上18:00-21:00开放预约"),o("li",null,"周末（周六、周日）：全天开放预约，时间为8:00-21:00"),o("li",null,"预约时长为1-3小时，每小时20元，时间选择步长为1小时"),o("li",null,"一人一天只能预约一次，如果当天已预约则无法再次预约"),o("li",null,"只能预约今天和明天的场地"),o("li",null,"今天场地：只要在开始时间之前都可以预约（如果有剩余）"),o("li",null,"明天场地：今天18:00之后才能开始预约")])],-1))]),o("div",Sa,[a[11]||(a[11]=o("h3",null,"场地状态",-1)),k.value?(x(),n("div",xa,[c(O,{rows:3,animated:""}),a[10]||(a[10]=o("p",{class:"loading-text"},"正在加载场地信息...",-1))])):(x(),g(R,{key:1,gutter:20},{default:d(()=>[(x(!0),n(f,null,y(h.value,e=>(x(),g(M,{xs:24,sm:12,md:8,key:e.id},{default:d(()=>[c(U,{class:C(["court-card",getStatusClass(e)])},{default:d(()=>[o("div",Ta,[o("div",Ca,w(e.name),1),o("div",$a,w(getStatusText(e)),1),o("div",ja,w(e.description),1),o("div",Na,"¥"+w(e.price)+"/小时",1),c(D,{type:"primary",disabled:!isCourtBookable(e),onClick:a=>(e=>{T.value=e,S.value=!0})(e),class:"book-button"},{default:d(()=>[_(w(isCourtBookable(e)?"立即预约":"暂不可预约"),1)]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}))]),c(E,{modelValue:S.value,"onUpdate:modelValue":a[3]||(a[3]=e=>S.value=e),title:`预约 ${null==(t=T.value)?void 0:t.name}`,width:"600px",onClose:closeBookingDialog},{default:d(()=>[T.value?(x(),g(ma,{key:0,ref_key:"createOrderFormRef",ref:j,court:T.value,date:r.value,"start-time":p.value,"end-time":b.value,onSuccess:handleBookingSuccess,onCancel:cancelBooking},null,8,["court","date","start-time","end-time"])):u("",!0)]),_:1},8,["modelValue","title"]),c(E,{modelValue:z.value,"onUpdate:modelValue":a[4]||(a[4]=e=>z.value=e),title:"场地使用情况表",width:"90%",onClose:closeMatrixDialog},{default:d(()=>[z.value?(x(),g(He,{key:0,"current-date":r.value,"start-time":p.value,"end-time":b.value},null,8,["current-date","start-time","end-time"])):u("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-7de6964d"]]);export{za as default};

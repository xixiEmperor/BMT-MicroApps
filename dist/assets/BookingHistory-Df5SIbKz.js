import{r as a,L as e,o as l,l as t,h as s,g as o,M as i,w as n,ae as r,a0 as d,$ as c,ah as u,a1 as p,f as m,k as b,au as y,a4 as f,A as _,x as k,m as g,a3 as w,aP as h,aQ as v,a5 as j,E as x,a as C,c as T,at as z,J as V,a2 as $}from"./index-RXELqIC3.js";/* empty css                   */import{g as B,O as D,a as A,b as N,d as H,e as M}from"./venueOrder-yV6P3NDp.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";import{_ as P}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                 *//* empty css                     *//* empty css                       */const E={class:"booking-history"},I={class:"container"},L={class:"filter-section"},O={class:"table-container"},U={key:2,class:"pagination"},q={key:0,class:"booking-detail"},J={class:"dialog-footer"},Q=P({l:"BookingHistory",setup(P){const Q=C(),S=a(!1),F=a({status:""});e(()=>F.value.status,a=>{Z(a)});const G=a(1),K=a(10),R=a(0),W=a([]),X=a(!1),Y=a(null),Z=async a=>{try{S.value=!0;const e=await B(a);0===e.data.code?(W.value=e.data.data.list||[],R.value=e.data.data.total):x.error(e.message||"获取订单列表失败")}catch(e){x.error("获取订单列表失败，请稍后重试")}finally{S.value=!1}},aa=a=>{G.value=a},ea=a=>{if(!a)return!0;const e=new Date;e.setHours(0,0,0,0);const l=new Date(a.date);return l.setHours(0,0,0,0),l<e},la=a=>!!a&&("reserved"===a.status||1===a.status),ta=a=>a&&("cancelled"===a.status||4===a.status)?"已取消":"取消预订",sa=a=>A[a]||a,oa=a=>D[a]||"",ia=async a=>{try{await T.confirm(`确定要取消 ${a.reservationDate} ${a.timeSlot} ${a.venueName} 的预订吗？取消后无法恢复。`,"取消预订",{confirmButtonText:"确定",cancelButtonText:"返回",type:"warning"}),S.value=!0;const e=await H(a.id,{reason:"用户主动取消"});0===e.data.code?(x.success(e.data.data),await Z()):x.error(e.message||"取消预订失败")}catch(e){"cancel"===e?x.info("已取消操作"):x.error("取消预订失败，请稍后重试")}finally{S.value=!1}},na=async()=>{Y.value&&(await ia(Y.value),X.value=!1)},ra=async a=>{try{await T.confirm("确定要申请退款吗？退款申请提交后需要管理员审核,并需要到线下退款。","申请退款",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),S.value=!0;const e=await M(a.id,{reason:"用户申请退款"});0===e.data.code?(x.success("退款申请已提交，等待管理员审核"),await Z()):x.error(e.message||"申请退款失败")}catch(e){"cancel"===e?x.info("已取消操作"):x.error("申请退款失败，请稍后重试")}finally{S.value=!1}};return l(()=>{Z()}),(a,e)=>{const l=c,C=d,T=r,B=u,D=$,A=y,H=f,M=g,P=z,Z=w,da=v,ca=h,ua=j,pa=p;return V(),t("div",E,[s("div",I,[e[7]||(e[7]=s("h2",{class:"page-title"},"我的预订记录",-1)),s("div",L,[o(B,{inline:!0,model:F.value},{default:n(()=>[o(T,{label:"预订状态"},{default:n(()=>[o(C,{modelValue:F.value.status,"onUpdate:modelValue":e[0]||(e[0]=a=>F.value.status=a),placeholder:"预订状态",clearable:"",style:{width:"120px"}},{default:n(()=>[o(l,{label:"全部",value:""}),o(l,{label:"待支付",value:"1"}),o(l,{label:"已支付",value:"2"}),o(l,{label:"已完成",value:"3"}),o(l,{label:"已取消",value:"4"}),o(l,{label:"已退款",value:"5"}),o(l,{label:"退款中",value:"6"})]),t:1},8,["modelValue"])]),t:1})]),t:1},8,["model"])]),i((V(),t("div",O,[0!==W.value.length||S.value?(V(),m(P,{key:1,data:W.value,style:{width:"100%"},border:""},{default:n(()=>[o(A,{prop:"id",label:"预订号",width:"80"}),o(A,{prop:"venueName",label:"场地名称",width:"120"}),o(A,{prop:"reservationDate",label:"预订日期",width:"120"}),o(A,{prop:"timeSlot",label:"时间段",width:"120"}),o(A,{prop:"totalAmount",label:"金额(元)",width:"100"}),o(A,{prop:"status",label:"状态",width:"120"},{default:n(a=>[o(H,{type:oa(a.row.status)},{default:n(()=>[_(k(sa(a.row.status)),1)]),t:2},1032,["type"])]),t:1}),o(A,{prop:"createTime",label:"预订时间",width:"160"}),o(A,{label:"操作",fixed:"right",width:"300"},{default:n(a=>[o(M,{type:"primary",size:"small",onClick:e=>(async a=>{try{S.value=!0;const e=await N(a.id);0===e.data.code?(Y.value=e.data.data,Y.value.contactName=e.data.data.remark.split(" ")[0],Y.value.contactPhone=e.data.data.remark.split(" ")[1],X.value=!0):x.error(e.message||"获取订单详情失败")}catch(e){x.error("获取订单详情失败，请稍后重试")}finally{S.value=!1}})(a.row)},{default:n(()=>[...e[4]||(e[4]=[_(" 查看详情 ",-1)])]),t:1},8,["onClick"]),1===a.row.status?(V(),m(M,{key:0,type:"success",size:"small",onClick:e=>(async a=>{const e=a.remark,[l,t,s]=e.split(" ");Q.push({path:"/payment",query:{orderNo:a.orderNo},state:{booking:{id:a.id,venueName:a.venueName,venueId:a.venueId,reservationDate:a.reservationDate,startTime:a.startTime,endTime:a.endTime,duration:a.duration,contactName:l,contactPhone:t,remarkMessage:s,pricePerHour:a.pricePerHour,totalAmount:a.totalAmount,createTime:a.createTime}}})})(a.row)},{default:n(()=>[...e[5]||(e[5]=[_(" 立即支付 ",-1)])]),t:1},8,["onClick"])):b("",!0),1===a.row.status?(V(),m(M,{key:1,type:"danger",size:"small",onClick:e=>ia(a.row),disabled:ea(a.row)||!la(a.row)},{default:n(()=>[_(k(ta(a.row)),1)]),t:2},1032,["onClick","disabled"])):b("",!0),2===a.row.status?(V(),m(M,{key:2,type:"warning",size:"small",onClick:e=>ra(a.row),disabled:2!==a.row.status},{default:n(()=>[...e[6]||(e[6]=[_(" 申请退款 ",-1)])]),t:1},8,["onClick","disabled"])):b("",!0)]),t:1})]),t:1},8,["data"])):(V(),m(D,{key:0,description:"暂无预订记录"})),W.value.length>0?(V(),t("div",U,[o(Z,{background:"",layout:"prev, pager, next, total",total:R.value,"page-size":K.value,"current-page":G.value,onCurrentChange:aa},null,8,["total","page-size","current-page"])])):b("",!0)])),[[pa,S.value]])]),o(ua,{title:"预订详情",modelValue:X.value,"onUpdate:modelValue":e[3]||(e[3]=a=>X.value=a),width:"500px",center:""},{footer:n(()=>[s("span",J,[o(M,{onClick:e[1]||(e[1]=a=>X.value=!1)},{default:n(()=>[...e[8]||(e[8]=[_("关闭",-1)])]),t:1}),Y.value&&la(Y.value)?(V(),m(M,{key:0,type:"danger",onClick:na,disabled:ea(Y.value)||!la(Y.value)},{default:n(()=>[_(k(ta(Y.value)),1)]),t:1},8,["disabled"])):b("",!0),!Y.value||1!==Y.value.status&&"reserved"!==Y.value.status?b("",!0):(V(),m(M,{key:1,type:"warning",onClick:e[2]||(e[2]=a=>ra(Y.value))},{default:n(()=>[...e[9]||(e[9]=[_(" 申请退款 ",-1)])]),t:1}))])]),default:n(()=>[Y.value?(V(),t("div",q,[o(ca,{column:1,border:!0},{default:n(()=>[o(da,{label:"预订编号"},{default:n(()=>[_(k(Y.value.id),1)]),t:1}),Y.value.orderNo?(V(),m(da,{key:0,label:"订单号"},{default:n(()=>[_(k(Y.value.orderNo),1)]),t:1})):b("",!0),o(da,{label:"场地名称"},{default:n(()=>[_(k(Y.value.courtName||Y.value.venueName),1)]),t:1}),o(da,{label:"预订日期"},{default:n(()=>[_(k(Y.value.date||Y.value.reservationDate),1)]),t:1}),o(da,{label:"预订时段"},{default:n(()=>[_(k(Y.value.timeSlot||`${Y.value.startTime}-${Y.value.endTime}`),1)]),t:1}),o(da,{label:"预订价格"},{default:n(()=>[_(k(Y.value.price||Y.value.totalAmount)+" 元",1)]),t:1}),o(da,{label:"预订状态"},{default:n(()=>[o(H,{type:oa(Y.value.status)},{default:n(()=>[_(k(sa(Y.value.status)),1)]),t:1},8,["type"])]),t:1}),o(da,{label:"预订人"},{default:n(()=>[_(k(Y.value.contactName),1)]),t:1}),o(da,{label:"联系电话"},{default:n(()=>[_(k(Y.value.contactPhone),1)]),t:1}),o(da,{label:"预订时间"},{default:n(()=>[_(k(Y.value.createTime||Y.value.createdAt),1)]),t:1}),Y.value.remark||Y.value.note?(V(),m(da,{key:1,label:"备注"},{default:n(()=>[_(k(Y.value.remark.split(" ")[2]),1)]),t:1})):b("",!0)]),t:1})])):b("",!0)]),t:1},8,["modelValue"])])}}},[["__scopeId","data-v-edab4659"]]);export{Q as default};

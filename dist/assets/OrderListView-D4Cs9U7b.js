import{az as e,r as a,E as t,d as s,o as r,l as n,h as i,k as l,g as o,w as c,ap as d,j as u,ai as p,a2 as m,P as y,Q as f,a3 as g,a as v,J as k,as as h,m as j,A as C,x as _,a4 as w,i as b,f as z,c as O}from"./index-RXELqIC3.js";/* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                 */import{_ as x}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                         *//* empty css                    */import{f as N,d as D,O as E}from"./pay-CUktMawW.js";/* empty css                       *//* empty css                   */const S=e("order",()=>{const e=a([]),s=a(!1),r=a(0),n=a(null);return{orderList:e,loading:s,fetchOrderList:async function(a=1,n=5,i=null){if(!s.value){s.value=!0;try{const t=await N({pageNum:a,pageSize:n,status:i});if(0!==t.data.code)throw new Error(t.data.message||"获取订单列表失败");e.value=t.data.data.list||[],r.value=t.data.data.total||0}catch(l){t.error("获取订单列表失败")}finally{s.value=!1}}},cancelOrder:async function(a){try{const s=await D(a);if(0===s.data.code){const r=e.value.findIndex(e=>e.orderNo===a);return-1!==r&&(e.value[r].status=E.CANCELLED),t.success(s.data.msg||"订单取消成功"),!0}return t.error(s.data.msg||"取消订单失败"),!1}catch(s){return t.error("取消订单失败"),!1}},getOrderByNo:function(a){return e.value.find(e=>e.orderNo===a)},total:r,status:n}},{persist:!0}),T={class:"order-list-container"},A={class:"order-header"},B={class:"order-tabs"},L={key:0,class:"loading-container"},P={key:1,class:"empty-container"},U={key:2,class:"order-list"},V={class:"order-header-info"},I={class:"order-info"},q={class:"order-no"},J={class:"order-time"},R={class:"order-status"},$={class:"order-content"},H={class:"order-products"},K=["onClick"],Q={class:"product-details"},F={class:"product-name"},G={key:0,class:"product-specs"},M={class:"product-price"},W={class:"product-quantity"},X={class:"order-footer"},Y={class:"order-amount"},Z={class:"total-price"},ee={class:"order-actions"},ae={key:3,class:"pagination-container"},te=x({t:"OrderListView",setup(e){const x=v(),N=S(),D=a("all"),te=a(1),se=a(5),{loading:re,cancelOrder:ne,refreshOrders:ie}=N,le=s(()=>N.total),oe=e=>{D.value=e,te.value=1,N.fetchOrderList(te.value,se.value,E[e])},ce=e=>{se.value=e,te.value=1,N.fetchOrderList(te.value,se.value,E[D.value])},de=e=>{te.value=e,N.fetchOrderList(te.value,se.value,E[D.value])},ue=e=>{x.push(`/order-detail/${e}`)},pe=()=>{x.push("/shop")},me=e=>{switch(e){case E.UNPAID:return"warning";case E.PAID:return"success";case E.CANCELLED:return"danger";default:return"info"}},ye=e=>{switch(e){case E.UNPAID:return"待支付";case E.PAID:return"已支付";case E.CANCELLED:return"已取消";case E.COMPLETED:return"已完成";default:return"未知状态"}},fe=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},ge=e=>{if(!e||null===e)return!1;if("object"==typeof e){const a=Object.entries(e);return a.length>0&&a.some(([,e])=>null!=e&&""!==e)}return!1};return r(()=>{N.fetchOrderList()}),(e,a)=>{const s=h,r=d,v=p,S=j,ve=m,ke=w,he=b,je=g;return k(),n("div",T,[i("div",A,[a[3]||(a[3]=i("h2",null,"我的订单",-1)),i("div",B,[o(r,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),onTabChange:oe},{default:c(()=>[o(s,{label:"全部订单",name:"all"}),o(s,{label:"待支付",name:"UNPAID"}),o(s,{label:"已支付",name:"PAID"}),o(s,{label:"已取消",name:"CANCELLED"})]),i:1},8,["modelValue"])])]),u(re)?(k(),n("div",L,[o(v,{rows:3,animated:""})])):0===u(N).orderList.length?(k(),n("div",P,[o(ve,{description:"暂无订单数据"},{default:c(()=>[o(S,{type:"primary",onClick:pe},{default:c(()=>[...a[4]||(a[4]=[C("去购物",-1)])]),i:1})]),i:1})])):(k(),n("div",U,[(k(!0),n(y,null,f(u(N).orderList,e=>(k(),n("div",{key:e.orderNo,class:"order-item"},[i("div",V,[i("div",I,[i("span",q,"订单号："+_(e.orderNo),1),i("span",J,_(fe(e.createTime)),1)]),i("div",R,[o(ke,{type:me(e.status)},{default:c(()=>[C(_(ye(e.status)),1)]),i:2},1032,["type"])])]),i("div",$,[i("div",H,[(k(!0),n(y,null,f(e.orderItemList,(a,t)=>(k(),n("div",{key:t,class:"product-item",onClick:a=>ue(e.orderNo)},[o(he,{src:a.productImage,class:"product-image",fit:"cover"},null,8,["src"]),i("div",Q,[i("div",F,_(a.productName),1),ge(a.specs)?(k(),n("div",G," 规格："+_(Object.entries(a.specs).map(([,e])=>`${e}`).join("、")),1)):l("",!0),i("div",M,"¥"+_((a.currentUnitPrice+a.priceAdjustment).toFixed(2)),1)]),i("div",W,"x"+_(a.quantity),1)],8,K))),128))]),i("div",X,[i("div",Y,[i("span",null,"共"+_(e.orderItemList.reduce((e,a)=>e+a.quantity,0))+"件商品，合计：",1),i("span",Z,"¥"+_(e.totalPrice.toFixed(2)),1)]),i("div",ee,[o(S,{size:"small",onClick:a=>ue(e.orderNo)},{default:c(()=>[...a[5]||(a[5]=[C(" 查看详情 ",-1)])]),i:1},8,["onClick"]),e.status===u(E).UNPAID?(k(),z(S,{key:0,type:"primary",size:"small",onClick:a=>(e=>{const a={orderNo:e.orderNo,amount:e.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(a)),x.push("/payment")})(e)},{default:c(()=>[...a[6]||(a[6]=[C(" 立即支付 ",-1)])]),i:1},8,["onClick"])):l("",!0),e.status===u(E).UNPAID?(k(),z(S,{key:1,type:"danger",size:"small",onClick:a=>{return t=e.orderNo,void O.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await ne(t)}).catch(()=>{});var t}},{default:c(()=>[...a[7]||(a[7]=[C(" 取消订单 ",-1)])]),i:1},8,["onClick"])):l("",!0),e.status===u(E).PAID?(k(),z(S,{key:2,type:"success",size:"small",onClick:a=>(e.orderNo,void O.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(async()=>{try{t.success("确认收货成功"),await ie()}catch(e){t.error("确认收货失败")}}).catch(()=>{}))},{default:c(()=>[...a[8]||(a[8]=[C(" 确认收货 ",-1)])]),i:1},8,["onClick"])):l("",!0)])])])]))),128))])),le.value>0?(k(),n("div",ae,[o(je,{"current-page":te.value,"onUpdate:currentPage":a[1]||(a[1]=e=>te.value=e),"page-size":se.value,"onUpdate:pageSize":a[2]||(a[2]=e=>se.value=e),"page-sizes":[5,10,15,20],total:le.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ce,onCurrentChange:de},null,8,["current-page","page-size","total"])])):l("",!0)])}}},[["__scopeId","data-v-c13f4ba5"]]);export{te as default};

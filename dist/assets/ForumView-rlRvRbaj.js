import{u as a,a as e}from"./index-BuScbc3L.js";/* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                    */import{_ as l}from"./_plugin-vue_export-helper-CTKw_zaB.js";import{g as t}from"./forum-CaX-pHs2.js";import{u as s}from"./forum-BBMbsy3N.js";import{f as o}from"./format-D0hGXpTN.js";import{j as i,r as p,q as u,w as n,N as r,K as m,B as d,A as c,O as v,au as w,aC as f,u as h,aG as b,ai as T,z as g,Y as y,a6 as _,a7 as j,y as V,aF as C,aH as k,M as z,Q as x,aT as D,V as R,E as U}from"./element-plus-D8DMz00a.js";const A={class:"forum-container"},F={class:"forum-actions"},G={class:"forum-content"},K={class:"topics-container"},O=["onClick"],P={class:"topic-author"},S={class:"topic-stats"},q={class:"topic-last-reply"},B={class:"pagination-container"},E=l(i({__name:"ForumView",setup(l){const i=e(),E=a(),H=s(),I=p([{name:"all",label:"全部帖子"},{name:"team",label:"打球组队"},{name:"notice",label:"赛事讨论"},{name:"help",label:"求助问答"},{name:"exp",label:"经验交流"}]),L=p("all"),M=p("");let N=null;const Q=p(1),Y=p(5),$=p(0),getForumListData=async()=>{const a=await t({page:Q.value,pageSize:Y.value,keyword:M.value,category:L.value});if(0===a.data.code){const e=a.data.data.list.map(a=>({...a,publishTime:o(a.publishTime),lastReply:o(a.lastReply)}));e.sort((a,e)=>a.isTop&&!e.isTop?-1:!a.isTop&&e.isTop?1:a.isTop&&e.isTop?new Date(e.topTime||e.publishTime).getTime()-new Date(a.topTime||a.publishTime).getTime():new Date(e.publishTime).getTime()-new Date(a.publishTime).getTime()),H.setPosts(e),$.value=a.data.data.total}};u(async()=>{await getForumListData()});const navigateToPublish=()=>{if(!E.token)return U.warning("请先登录后再发布文章"),void i.push("/login");i.push("/publish-post")},handleSearch=()=>{N&&clearTimeout(N),N=setTimeout(()=>{Q.value=1,getForumListData()},500)},handlePageChange=a=>{Q.value=a,getForumListData()},handleSizeChange=a=>{Y.value=a,Q.value=1,getForumListData()};n(L,()=>{Q.value=1,getForumListData()}),n(M,()=>{handleSearch()});const tableRowClassName=({row:a})=>a.isTop?"top-row":"";return(a,e)=>{const l=v,t=w,s=C,o=f,p=x,u=k,n=b,U=T;return g(),r("div",A,[e[5]||(e[5]=m("h2",null,"羽你同行论坛",-1)),m("div",F,[d(l,{type:"primary",onClick:navigateToPublish},{default:c(()=>[...e[3]||(e[3]=[y("发布新帖",-1)])]),_:1}),d(t,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=a=>M.value=a),placeholder:"搜索论坛内容",class:"search-input"},{append:c(()=>[d(l,{onClick:handleSearch},{default:c(()=>[...e[4]||(e[4]=[y("搜索",-1)])]),_:1})]),_:1},8,["modelValue"])]),m("div",G,[d(o,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=a=>L.value=a),class:"demo-tabs"},{default:c(()=>[(g(!0),r(_,null,j(I.value,a=>(g(),V(s,{key:a.name,label:a.label,name:a.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),m("div",K,[d(n,{data:h(H).posts,style:{width:"100%"},"row-class-name":tableRowClassName},{default:c(()=>[d(u,{prop:"title",label:"主题","min-width":"300"},{default:c(a=>[m("div",{class:"topic-title",onClick:e=>{return l=a.row.id,void i.push(`/post/${l}`);var l}},[a.row.isTop?(g(),V(p,{key:0,class:"top-icon"},{default:c(()=>[d(h(D))]),_:1})):z("",!0),y(" "+R(a.row.title),1)],8,O)]),_:1}),d(u,{prop:"author",label:"作者",width:"120"},{default:c(a=>[m("div",P,R(a.row.author),1)]),_:1}),d(u,{prop:"replies",label:"回复/查看",width:"120"},{default:c(a=>[m("div",S,[m("div",null,R(a.row.replyCount||0)+" 回复",1),m("div",null,R(a.row.views)+" 查看",1)])]),_:1}),d(u,{prop:"lastReply",label:"最后回复",width:"120"},{default:c(a=>[m("div",q,R(a.row.lastReply),1)]),_:1})]),_:1},8,["data"])]),m("div",B,[d(U,{modelValue:Q.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Q.value=a),"page-size":Y.value,total:$.value,"page-sizes":[5,8,10,15],layout:"total, sizes, prev, pager, next",onSizeChange:handleSizeChange,onCurrentChange:handlePageChange},null,8,["modelValue","page-size","total"])])])])}}}),[["__scopeId","data-v-a7125a8d"]]);export{E as default};

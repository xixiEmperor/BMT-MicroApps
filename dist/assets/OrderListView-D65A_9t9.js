import{e,a}from"./index-BuScbc3L.js";/* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                 */import{_ as t}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                         *//* empty css                    */import{f as r,d as s,O as o}from"./pay-D_1k_pGE.js";import{r as l,E as i,d as n,q as c,N as u,K as d,M as p,B as m,A as v,aC as f,u as y,ax as g,ah as h,a6 as C,a7 as N,ai as j,z as k,aF as L,O,Y as D,V as _,aj as A,L as I,y as P,J as b}from"./element-plus-D8DMz00a.js";/* empty css                       *//* empty css                   */const w=e("order",()=>{const e=l([]),a=l(!1),t=l(0),n=l(null);return{orderList:e,loading:a,fetchOrderList:async function(s=1,o=5,l=null){if(!a.value){a.value=!0;try{const a=await r({pageNum:s,pageSize:o,status:l});if(0!==a.data.code)throw new Error(a.data.message||"获取订单列表失败");e.value=a.data.data.list||[],t.value=a.data.data.total||0}catch(n){i.error("获取订单列表失败")}finally{a.value=!1}}},cancelOrder:async function(a){try{const t=await s(a);if(0===t.data.code){const r=e.value.findIndex(e=>e.orderNo===a);return-1!==r&&(e.value[r].status=o.CANCELLED),i.success(t.data.msg||"订单取消成功"),!0}return i.error(t.data.msg||"取消订单失败"),!1}catch(t){return i.error("取消订单失败"),!1}},getOrderByNo:function(a){return e.value.find(e=>e.orderNo===a)},total:t,status:n}},{persist:!0}),x={class:"order-list-container"},z={class:"order-header"},E={class:"order-tabs"},U={key:0,class:"loading-container"},T={key:1,class:"empty-container"},S={key:2,class:"order-list"},B={class:"order-header-info"},q={class:"order-info"},V={class:"order-no"},F={class:"order-time"},M={class:"order-status"},J={class:"order-content"},K={class:"order-products"},R=["onClick"],$={class:"product-details"},H={class:"product-name"},Y={key:0,class:"product-specs"},G={class:"product-price"},Q={class:"product-quantity"},W={class:"order-footer"},X={class:"order-amount"},Z={class:"total-price"},ee={class:"order-actions"},ae={key:3,class:"pagination-container"},te=t({__name:"OrderListView",setup(e){const t=a(),r=w(),s=l("all"),te=l(1),re=l(5),{loading:se,cancelOrder:oe,refreshOrders:le}=r,ie=n(()=>r.total),handleTabChange=e=>{s.value=e,te.value=1,r.fetchOrderList(te.value,re.value,o[e])},handleSizeChange=e=>{re.value=e,te.value=1,r.fetchOrderList(te.value,re.value,o[s.value])},handleCurrentChange=e=>{te.value=e,r.fetchOrderList(te.value,re.value,o[s.value])},viewOrderDetail=e=>{t.push(`/order-detail/${e}`)},goShopping=()=>{t.push("/shop")},getStatusType=e=>{switch(e){case o.UNPAID:return"warning";case o.PAID:return"success";case o.CANCELLED:return"danger";default:return"info"}},getStatusText=e=>{switch(e){case o.UNPAID:return"待支付";case o.PAID:return"已支付";case o.CANCELLED:return"已取消";case o.COMPLETED:return"已完成";default:return"未知状态"}},formatTime=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},hasValidSpecs=e=>{if(!e||null===e)return!1;if("object"==typeof e){const a=Object.entries(e);return a.length>0&&a.some(([,e])=>null!=e&&""!==e)}return!1};return c(()=>{r.fetchOrderList()}),(e,a)=>{const l=L,n=f,c=g,w=O,ne=h,ce=A,ue=I,de=j;return k(),u("div",x,[d("div",z,[a[3]||(a[3]=d("h2",null,"我的订单",-1)),d("div",E,[m(n,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),onTabChange:handleTabChange},{default:v(()=>[m(l,{label:"全部订单",name:"all"}),m(l,{label:"待支付",name:"UNPAID"}),m(l,{label:"已支付",name:"PAID"}),m(l,{label:"已取消",name:"CANCELLED"})]),_:1},8,["modelValue"])])]),y(se)?(k(),u("div",U,[m(c,{rows:3,animated:""})])):0===y(r).orderList.length?(k(),u("div",T,[m(ne,{description:"暂无订单数据"},{default:v(()=>[m(w,{type:"primary",onClick:goShopping},{default:v(()=>[...a[4]||(a[4]=[D("去购物",-1)])]),_:1})]),_:1})])):(k(),u("div",S,[(k(!0),u(C,null,N(y(r).orderList,e=>(k(),u("div",{key:e.orderNo,class:"order-item"},[d("div",B,[d("div",q,[d("span",V,"订单号："+_(e.orderNo),1),d("span",F,_(formatTime(e.createTime)),1)]),d("div",M,[m(ce,{type:getStatusType(e.status)},{default:v(()=>[D(_(getStatusText(e.status)),1)]),_:2},1032,["type"])])]),d("div",J,[d("div",K,[(k(!0),u(C,null,N(e.orderItemList,(a,t)=>(k(),u("div",{key:t,class:"product-item",onClick:a=>viewOrderDetail(e.orderNo)},[m(ue,{src:a.productImage,class:"product-image",fit:"cover"},null,8,["src"]),d("div",$,[d("div",H,_(a.productName),1),hasValidSpecs(a.specs)?(k(),u("div",Y," 规格："+_(Object.entries(a.specs).map(([,e])=>`${e}`).join("、")),1)):p("",!0),d("div",G,"¥"+_((a.currentUnitPrice+a.priceAdjustment).toFixed(2)),1)]),d("div",Q,"x"+_(a.quantity),1)],8,R))),128))]),d("div",W,[d("div",X,[d("span",null,"共"+_(e.orderItemList.reduce((e,a)=>e+a.quantity,0))+"件商品，合计：",1),d("span",Z,"¥"+_(e.totalPrice.toFixed(2)),1)]),d("div",ee,[m(w,{size:"small",onClick:a=>viewOrderDetail(e.orderNo)},{default:v(()=>[...a[5]||(a[5]=[D(" 查看详情 ",-1)])]),_:1},8,["onClick"]),e.status===y(o).UNPAID?(k(),P(w,{key:0,type:"primary",size:"small",onClick:a=>(e=>{const a={orderNo:e.orderNo,amount:e.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(a)),t.push("/payment")})(e)},{default:v(()=>[...a[6]||(a[6]=[D(" 立即支付 ",-1)])]),_:1},8,["onClick"])):p("",!0),e.status===y(o).UNPAID?(k(),P(w,{key:1,type:"danger",size:"small",onClick:a=>{return t=e.orderNo,void b.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await oe(t)}).catch(()=>{});var t}},{default:v(()=>[...a[7]||(a[7]=[D(" 取消订单 ",-1)])]),_:1},8,["onClick"])):p("",!0),e.status===y(o).PAID?(k(),P(w,{key:2,type:"success",size:"small",onClick:a=>(e.orderNo,void b.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(async()=>{try{i.success("确认收货成功"),await le()}catch(e){i.error("确认收货失败")}}).catch(()=>{}))},{default:v(()=>[...a[8]||(a[8]=[D(" 确认收货 ",-1)])]),_:1},8,["onClick"])):p("",!0)])])])]))),128))])),ie.value>0?(k(),u("div",ae,[m(de,{"current-page":te.value,"onUpdate:currentPage":a[1]||(a[1]=e=>te.value=e),"page-size":re.value,"onUpdate:pageSize":a[2]||(a[2]=e=>re.value=e),"page-sizes":[5,10,15,20],total:ie.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:handleSizeChange,onCurrentChange:handleCurrentChange},null,8,["current-page","page-size","total"])])):p("",!0)])}}},[["__scopeId","data-v-c13f4ba5"]]);export{te as default};

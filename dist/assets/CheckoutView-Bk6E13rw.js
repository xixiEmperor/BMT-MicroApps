import{a as e}from"./index-BuScbc3L.js";/* empty css                 *//* empty css                        */import{_ as a}from"./_plugin-vue_export-helper-CTKw_zaB.js";import{c as t,a as s,B as c}from"./pay-D_1k_pGE.js";import{u as o}from"./cart-Dkt6AmB0.js";import{r as l,q as u,E as r,N as i,M as d,K as p,B as n,A as v,O as m,L as y,V as h,a6 as f,a7 as k,au as g,z as j,Y as x}from"./element-plus-D8DMz00a.js";const _={key:0,class:"checkout-container"},w={class:"checkout-header"},A={class:"checkout-section"},q={key:0,class:"product-info"},I={class:"product-details"},b={class:"product-name"},O={key:0,class:"product-specs"},F={class:"product-price"},N={class:"product-quantity"},S={class:"product-subtotal"},V={class:"price"},B={key:1},C={class:"product-details"},L={class:"product-name"},M={key:0,class:"product-specs"},P={class:"product-price"},z={class:"product-quantity"},J={class:"product-subtotal"},T={class:"price"},$={class:"checkout-section"},E={class:"checkout-section order-amount"},K={class:"amount-item"},U={class:"amount-item total"},Y={class:"price"},D={class:"checkout-footer"},G={class:"total-payment"},H={class:"price"},Q=a({__name:"CheckoutView",setup(a){const Q=e(),R=o(),W=l(null),X=l(""),Z=l(!1),backToCart=()=>{Q.push("/cart")},submitOrder=async()=>{try{let a;if(Z.value=!0,W.value.isBuyNow){const e={productId:W.value.products[0].productId,quantity:W.value.products[0].quantity,specs:W.value.products[0].specs||{}};a=await t(e)}else a=await s();if(0===a.data.code){const t={orderNo:a.data.data,amount:W.value.totalAmount,businessType:c.MALL,remarks:X.value};if(localStorage.setItem("payment_info",JSON.stringify(t)),W.value.products)try{await R.removeOrderedItems(W.value)}catch(e){}localStorage.removeItem("checkout_order"),r.success("订单创建成功，即将跳转到支付页面"),setTimeout(()=>{Q.push("/payment")},1e3)}else r.error(a.message||"创建订单失败")}catch(e){r.error("创建订单失败，请重试")}finally{Z.value=!1}};return u(()=>{const e=localStorage.getItem("checkout_order");if(e)try{W.value=JSON.parse(e)}catch(a){r.error("获取订单信息失败"),Q.push("/cart")}else r.warning("没有待结算的订单"),Q.push("/cart")}),(e,a)=>{const t=m,s=y,c=g;return W.value?(j(),i("div",_,[p("div",w,[a[2]||(a[2]=p("h2",null,"订单确认",-1)),n(t,{type:"text",onClick:backToCart},{default:v(()=>[...a[1]||(a[1]=[x("返回购物车",-1)])]),_:1})]),p("div",A,[a[5]||(a[5]=p("h3",null,"商品信息",-1)),W.value.product?(j(),i("div",q,[n(s,{src:W.value.product.productImage,class:"product-image",fit:"cover"},null,8,["src"]),p("div",I,[p("div",b,h(W.value.product.productName),1),Object.keys(W.value.product.specs||{}).length>0?(j(),i("div",O," 规格："+h(Object.entries(W.value.product.specs).map(([e,a])=>`${a}`).join("、")),1)):d("",!0),p("div",F,"¥"+h((W.value.product.productPrice+W.value.product.priceAdjustment).toFixed(2)),1),p("div",N,"x "+h(W.value.quantity),1)]),p("div",S,[a[3]||(a[3]=p("span",null,"小计：",-1)),p("span",V,"¥"+h(W.value.totalAmount.toFixed(2)),1)])])):d("",!0),W.value.products?(j(),i("div",B,[(j(!0),i(f,null,k(W.value.products,(e,t)=>(j(),i("div",{key:t,class:"product-info"},[n(s,{src:e.productImage,class:"product-image",fit:"cover"},null,8,["src"]),p("div",C,[p("div",L,h(e.productName),1),Object.keys(e.specs||{}).length>0?(j(),i("div",M," 规格："+h(Object.entries(e.specs).map(([e,a])=>`${a}`).join("、")),1)):d("",!0),p("div",P,"¥"+h((e.productPrice+e.priceAdjustment).toFixed(2)),1),p("div",z,"x "+h(e.quantity),1)]),p("div",J,[a[4]||(a[4]=p("span",null,"小计：",-1)),p("span",T,"¥"+h(((e.productPrice+e.priceAdjustment)*e.quantity).toFixed(2)),1)])]))),128))])):d("",!0)]),p("div",$,[a[6]||(a[6]=p("h3",null,"订单备注",-1)),n(c,{type:"textarea",rows:3,placeholder:"可以告诉我们您的特殊要求（选填）",modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),p("div",E,[p("div",K,[a[7]||(a[7]=p("span",null,"商品总价：",-1)),p("span",null,"¥"+h(W.value.totalAmount.toFixed(2)),1)]),p("div",U,[a[8]||(a[8]=p("span",null,"应付总额：",-1)),p("span",Y,"¥"+h(W.value.totalAmount.toFixed(2)),1)])]),p("div",D,[p("div",G,[a[9]||(a[9]=p("span",null,"应付总额：",-1)),p("span",H,"¥"+h(W.value.totalAmount.toFixed(2)),1)]),n(t,{type:"primary",size:"large",onClick:submitOrder,loading:Z.value},{default:v(()=>[x(h(Z.value?"创建订单中...":"提交订单"),1)]),_:1},8,["loading"])])])):d("",!0)}}},[["__scopeId","data-v-5f7ebdac"]]);export{Q as default};

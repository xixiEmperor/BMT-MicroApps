import{Y as e,r as a,K as t,o as l,Z as s,_ as i,l as n,h as o,M as r,k as c,g as d,w as u,$ as m,a0 as p,a1 as v,f,P as g,Q as y,a2 as b,a3 as h,a4 as k,A as _,x as w,a5 as V,E as x,a6 as C,J as $,a7 as D,O as j,m as z,a8 as N,d as S,L as U,a9 as Y,aa as O,a as T,j as I,ab as M,p as P,ac as q,q as A,ad as H,ae as B,af as F,ag as R,ah as E,ai as L,aj as Z,ak as G,U as J}from"./index-RXELqIC3.js";import{c as K}from"./venueOrder-yV6P3NDp.js";/* empty css                   *//* empty css               *//* empty css                *//* empty css                         *//* empty css               *//* empty css                  *//* empty css                     */import{_ as Q}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                             *//* empty css                 *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                         */import{f as W}from"./format-Be2yr7zd.js";/* empty css                     *//* empty css                 */const X={class:"notice-list-page"},ee={class:"filter-container"},ae={class:"notice-carousel-container"},te={class:"notice-header"},le={class:"notice-title"},se={class:"notice-meta"},ie={class:"notice-time"},ne={class:"notice-content"},oe={class:"notice-footer"},re={key:1,class:"empty-state"},ce={key:0,class:"notice-grid"},de={class:"notice-grid-container"},ue=["onClick"],me={class:"grid-item-header"},pe={class:"grid-item-title"},ve={class:"grid-item-time"},fe={key:1,class:"pagination-container"},ge={class:"notice-detail"},ye={class:"detail-meta"},be={class:"detail-time"},he={class:"detail-content"},ke=Q({t:"NoticeList",setup(S){const U=a(null),Y=a(!1),O=a(1),T=a(5),I=a(0),M=a([]),P=a(!1),q=t({id:"",title:"",content:"",type:1,publishTime:""}),A=e=>({1:"",2:"warning"}[e]||""),H=e=>({1:"普通通知",2:"重要通知"}[e]||"未知"),B=e=>W(e,"YYYY-MM-DD HH:mm"),F=(e,a=100)=>e?e.length>a?e.substring(0,a)+"...":e:"",R=async()=>{try{Y.value=!0;const a=await function(a={}){return e({url:"/api/reservation/notice",method:"get",params:{pageNum:a.pageNum||1,pageSize:a.pageSize||10,type:a.type||null}})}({pageNum:O.value,pageSize:T.value,type:U.value});0===a.data.code?(M.value=a.data.data.list,I.value=a.data.data.total):x.error(a.data.msg||"获取通知列表失败")}catch(a){x.error("获取通知列表失败")}finally{Y.value=!1}},E=()=>{O.value=1,R()},L=e=>{O.value=e,R()},Z=e=>{T.value=e,O.value=1,R()},G=async a=>{try{const l=await(t=a.id,e({url:`/api/reservation/notice/${t}`,method:"get"}));if(0===l.data.code){const e=l.data.data;Object.assign(q,e),P.value=!0}else x.error(l.data.msg||"获取通知详情失败")}catch(l){x.error("获取通知详情失败")}var t};return l(()=>{s().subscribe("venue_notice",e=>{i({title:"通知公告",message:e.payload,type:"info"})}),R()}),(e,a)=>{const t=m,l=p,s=k,i=z,x=D,S=C,R=b,J=h,K=V,Q=v;return $(),n("div",X,[a[4]||(a[4]=o("h2",{class:"page-title"},"通知公告",-1)),o("div",ee,[d(l,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),placeholder:"选择通知类型",clearable:"",onChange:E},{default:u(()=>[d(t,{label:"全部通知",value:null}),d(t,{label:"普通通知",value:1}),d(t,{label:"重要通知",value:2})]),l:1},8,["modelValue"])]),r(($(),n("div",ae,[M.value.length>0?($(),f(S,{key:0,height:"300px",autoplay:!0,interval:5e3,"indicator-position":"outside",arrow:"hover",type:"card"},{default:u(()=>[($(!0),n(g,null,y(M.value,e=>($(),f(x,{key:e.id,onClick:a=>G(e)},{default:u(()=>[o("div",{class:j(["notice-card",{important:2===e.type}])},[o("div",te,[o("h3",le,w(e.title),1),o("div",se,[d(s,{type:A(e.type),size:"small"},{default:u(()=>[_(w(H(e.type)),1)]),l:2},1032,["type"]),o("span",ie,w(B(e.publishTime)),1)])]),o("div",ne,w(F(e.content,200)),1),o("div",oe,[d(i,{type:"primary",size:"small",onClick:N(a=>G(e),["stop"])},{default:u(()=>[...a[2]||(a[2]=[_(" 查看详情 ",-1)])]),l:1},8,["onClick"])])],2)]),l:2},1032,["onClick"]))),128))]),l:1})):c("",!0),Y.value||0!==M.value.length?c("",!0):($(),n("div",re,[d(R,{description:"暂无通知"})]))])),[[Q,Y.value]]),M.value.length>0?($(),n("div",ce,[a[3]||(a[3]=o("h3",{class:"grid-title"},"所有通知",-1)),o("div",de,[($(!0),n(g,null,y(M.value,e=>($(),n("div",{key:`grid-${e.id}`,class:j(["notice-grid-item",{important:2===e.type}]),onClick:a=>G(e)},[o("div",me,[o("span",pe,w(e.title),1),d(s,{type:A(e.type),size:"small"},{default:u(()=>[_(w(H(e.type)),1)]),l:2},1032,["type"])]),o("div",ve,w(B(e.publishTime)),1)],10,ue))),128))])])):c("",!0),I.value>0?($(),n("div",fe,[d(J,{background:"","hide-on-single-page":!1,layout:"total, sizes, prev, pager, next",total:I.value,"page-size":T.value,"page-sizes":[5,8,10],"current-page":O.value,onCurrentChange:L,onSizeChange:Z},null,8,["total","page-size","current-page"])])):c("",!0),d(K,{modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),title:q.title,width:"60%"},{default:u(()=>[o("div",ge,[o("div",ye,[d(s,{type:A(q.type)},{default:u(()=>[_(w(H(q.type)),1)]),l:1},8,["type"]),o("span",be,"发布时间："+w(B(q.publishTime)),1)]),o("div",he,w(q.content),1)])]),l:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-b58188c4"]]);const _e={class:"matrix-container"},we={class:"date-selector"},Ve={class:"date-info"},xe={key:0,class:"workday-info"},Ce={key:1,class:"weekend-info"},$e={class:"legend"},De={class:"legend-text"},je={class:"matrix-table"},ze={class:"status-matrix"},Ne={class:"venue-name"},Se=["onClick","title"],Ue={class:"dialog-footer"},Ye=Q({t:"VenueStatusMatrix",props:{visible:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:l}){const s=t,i=S({get:()=>s.visible});U(()=>s.visible,e=>{e&&N()},{immediate:!0});const c=l,m=()=>{c("close")},p=a(!1),b=a({}),h=a(new Date),k=a([]),C=a([]),D={1:"#67c23a",2:"#909399",3:"#f56c6c",4:"#e6a23c"},j={1:"空闲中",2:"使用中",3:"已预约",4:"不开放"},N=async()=>{if(s.visible){p.value=!0;try{const l=`${(t=h.value).getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,s=await(a={date:l},e({url:"/api/venue/status-matrix",method:"get",params:a}));0===s.data.code&&(b.value=s.data.data.statusMatrix||{},C.value=s.data.data.venues||[],k.value=s.data.data.timeSlots||[])}catch(l){x.error("获取场地状态矩阵失败")}finally{p.value=!1}var a,t}},T=e=>{const a=e.getDay();return a>=1&&a<=5},I=e=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date(a);t.setDate(t.getDate()+1);const l=new Date(e);return l.setHours(0,0,0,0),!(l.getTime()===a.getTime()||l.getTime()===t.getTime())},M=(e,a)=>{const t=b.value[e];return t&&t[a]?t[a].status:1},P=(e,a)=>{const t=M(e,a);return{backgroundColor:D[t],color:"#fff",textAlign:"center",padding:"8px 4px",fontSize:"12px",cursor:"pointer",transition:"all 0.3s"}},q=()=>{N()};return(e,a)=>{const t=Y,l=z,s=V,c=v;return $(),f(s,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),title:"场地使用情况表",width:"90%","close-on-click-modal":!1,onClose:m,class:"venue-matrix-dialog"},{footer:u(()=>[o("div",Ue,[d(l,{onClick:m},{default:u(()=>[...a[4]||(a[4]=[_("关闭",-1)])]),l:1}),d(l,{type:"primary",onClick:N},{default:u(()=>[...a[5]||(a[5]=[_("刷新数据",-1)])]),l:1})])]),default:u(()=>[o("div",_e,[o("div",we,[d(t,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value=e),type:"date",placeholder:"选择查询日期",format:"YYYY年MM月DD日",onChange:q,"disabled-date":I},null,8,["modelValue"]),o("div",Ve,[T(h.value)?($(),n("span",xe," 工作日：白天场地用于校内上课，仅晚上18:00-21:00开放预约 ")):($(),n("span",Ce," 周末：全天开放预约，时间为8:00-21:00 "))])]),o("div",$e,[($(),n(g,null,y(D,(e,a)=>o("div",{class:"legend-item",key:a},[o("div",{class:"legend-color",style:O({backgroundColor:e})},null,4),o("span",De,w(j[a]),1)])),64))]),r(($(),n("div",je,[o("table",ze,[o("thead",null,[o("tr",null,[a[2]||(a[2]=o("th",{class:"venue-header"},"场地/时间",-1)),($(!0),n(g,null,y(k.value,e=>($(),n("th",{key:e,class:"time-header"},w(e),1))),128))])]),o("tbody",null,[($(!0),n(g,null,y(C.value,e=>($(),n("tr",{key:e.id},[o("td",Ne,w(e.name),1),($(!0),n(g,null,y(k.value,a=>($(),n("td",{key:a,class:"status-cell",style:O(P(e.id,a)),onClick:t=>((e,a)=>{const t=b.value[e.id];if(!t||!t[a])return;const l=t[a],s=l.status;let i="";i=1!==s?`${e.name} ${a} - ${j[s]} - ${l.reason}`:`${e.name} ${a} - ${j[s]}`,1===s?x.success(i):2===s?x.warning(i):3===s?x.error(i):4===s&&x.warning(i)})(e,a),title:`${e.name} ${a} - ${j[M(e.id,a)]}`},w(j[M(e.id,a)]),13,Se))),128))]))),128))])])])),[[c,p.value]]),a[3]||(a[3]=o("div",{class:"matrix-info"},[o("p",null,[o("strong",null,"使用说明：")]),o("ul",null,[o("li",null,"点击单元格可查看详细信息"),o("li",null,"绿色表示可预约，红色表示已预约，橙色表示维护中，灰色表示不开放"),o("li",null,"工作日白天时间段场地用于校内上课，不对外开放"),o("li",null,"周末全天开放预约")])],-1))])]),l:1},8,["modelValue"])}}},[["__scopeId","data-v-64f68edf"]]),Oe={class:"create-order-form"},Te={class:"form-header"},Ie={class:"form-title"},Me={class:"form-section venue-section"},Pe={class:"section-header"},qe={key:0,class:"venue-card"},Ae={class:"venue-info"},He={class:"venue-name"},Be={class:"venue-description"},Fe={class:"venue-price"},Re={class:"price-value"},Ee={class:"form-section time-section"},Le={class:"section-header"},Ze={class:"time-display-grid"},Ge={class:"time-display-item"},Je={class:"time-value"},Ke={class:"time-display-item"},Qe={class:"time-value"},We={class:"time-display-item"},Xe={class:"time-value"},ea={key:0,class:"booking-summary"},aa={class:"summary-item"},ta={class:"summary-value"},la={class:"summary-item total-price"},sa={class:"summary-value price"},ia={class:"price-note"},na={class:"form-section contact-section"},oa={class:"section-header"},ra={class:"contact-form-grid"},ca={class:"form-section notice-section"},da={class:"section-header"},ua={class:"notice-content"},ma={class:"form-actions"},pa=Q({t:"CreateOrderForm",props:{selectedVenue:{type:Object,default:()=>({})},reservationDate:{type:String,default:""},startTime:{type:String,default:""},endTime:{type:String,default:""}},emits:["cancel"],setup(e,{emit:t}){const l=T(),s=e,i=t,r=a(null),m=a(!1),p=a({venueId:"",contactName:"",contactPhone:"",remark:""}),v={venueId:[{required:!0,message:"请选择场地",trigger:"change"}],contactName:[{required:!0,message:"请输入联系人姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度在2-20个字符",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5a-zA-Z\s]+$/,message:"姓名只能包含中文、英文和空格",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],remark:[{max:200,message:"备注不能超过200个字符",trigger:"blur"}]},f=S(()=>{if(!s.startTime||!s.endTime)return 0;const[e]=s.startTime.split(":").map(Number),[a]=s.endTime.split(":").map(Number);return a-e}),g=S(()=>{var e;const a=(null==(e=s.selectedVenue)?void 0:e.price)||30;return Math.ceil(f.value)*a});U(()=>s.selectedVenue,e=>{(null==e?void 0:e.id)&&(p.value.venueId=e.id)},{immediate:!0});const y=async()=>{if(!r.value)return!1;try{await r.value.validate();const a={venueId:s.selectedVenue.id,reservationDate:s.reservationDate,startTime:s.startTime,endTime:s.endTime,remark:p.value.contactName+" "+p.value.contactPhone+" "+p.value.remark};m.value=!0;try{x.info("正在创建订单...");const e=await K(a);if(0!==e.data.code)return x.error(e.data.message||"创建订单失败"),!1;l.push({path:"/payment",query:{orderNo:e.data.data.orderNo},state:{orderDetail:{id:e.data.data.id,venueName:s.selectedVenue.name,venueId:s.selectedVenue.id,reservationDate:a.reservationDate,startTime:a.startTime,endTime:a.endTime,duration:f.value,contactName:p.value.contactName,contactPhone:p.value.contactPhone,remark:e.data.data.remark,payTypeDesc:e.data.data.payTypeDesc,pricePerHour:e.data.data.pricePerHour||30,totalAmount:e.data.data.totalAmount}}})}catch(e){return x.error("创建订单失败，请重试"),!1}finally{m.value=!1}}catch(e){return!1}},b=()=>{i("cancel")};return(e,a)=>{const t=P,l=F,i=B,h=R,k=z,V=E;return $(),n("div",Oe,[o("div",Te,[o("h3",Ie,[d(t,null,{default:u(()=>[d(I(M))]),l:1}),a[3]||(a[3]=_(" 创建预约订单 ",-1))]),a[4]||(a[4]=o("p",{class:"form-subtitle"},"请填写完整的预约信息，确保信息准确无误",-1))]),d(V,{ref_key:"formRef",ref:r,model:p.value,rules:v,"label-width":"100px",class:"order-form",size:"large"},{default:u(()=>{var e,r;return[o("div",Me,[o("div",Pe,[d(t,{class:"section-icon"},{default:u(()=>[d(I(q))]),l:1}),a[5]||(a[5]=o("h4",{class:"section-title"},"场地信息",-1))]),(null==(e=s.selectedVenue)?void 0:e.id)?($(),n("div",qe,[o("div",Ae,[o("h5",He,w(s.selectedVenue.name),1),o("p",Be,w(s.selectedVenue.description||"标准羽毛球场地，配备专业羽毛球网和照明设备"),1),o("div",Fe,[a[6]||(a[6]=o("span",{class:"price-label"},"价格：",-1)),o("span",Re,w(s.selectedVenue.price||30)+"元/小时",1)])])])):c("",!0)]),o("div",Ee,[o("div",Le,[d(t,{class:"section-icon"},{default:u(()=>[d(I(A))]),l:1}),a[7]||(a[7]=o("h4",{class:"section-title"},"预约时间",-1))]),o("div",Ze,[o("div",Ge,[a[8]||(a[8]=o("span",{class:"time-label"},"预约日期",-1)),o("div",Je,w(s.reservationDate||"未选择"),1)]),o("div",Ke,[a[9]||(a[9]=o("span",{class:"time-label"},"开始时间",-1)),o("div",Qe,w(s.startTime||"未选择"),1)]),o("div",We,[a[10]||(a[10]=o("span",{class:"time-label"},"结束时间",-1)),o("div",Xe,w(s.endTime||"未选择"),1)])]),f.value>0?($(),n("div",ea,[o("div",aa,[d(t,null,{default:u(()=>[d(I(H))]),l:1}),a[11]||(a[11]=o("span",{class:"summary-label"},"预约时长：",-1)),o("span",ta,w(f.value)+"小时",1)]),o("div",la,[d(t,null,{default:u(()=>[d(I(M))]),l:1}),a[12]||(a[12]=o("span",{class:"summary-label"},"预计费用：",-1)),o("span",sa,"¥"+w(g.value),1)]),o("div",ia," （按"+w((null==(r=s.selectedVenue)?void 0:r.price)||30)+"元/小时计算，不足1小时按1小时计费） ",1)])):c("",!0)]),o("div",na,[o("div",oa,[d(t,{class:"section-icon"},{default:u(()=>[d(I(M))]),l:1}),a[13]||(a[13]=o("h4",{class:"section-title"},"联系人信息",-1))]),o("div",ra,[d(i,{label:"联系人姓名",prop:"contactName"},{default:u(()=>[d(l,{modelValue:p.value.contactName,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value.contactName=e),placeholder:"请输入联系人姓名",disabled:m.value,clearable:"",size:"large"},{prefix:u(()=>[d(t,null,{default:u(()=>[d(I(M))]),l:1})]),l:1},8,["modelValue","disabled"])]),l:1}),d(i,{label:"联系电话",prop:"contactPhone"},{default:u(()=>[d(l,{modelValue:p.value.contactPhone,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value.contactPhone=e),placeholder:"请输入手机号码",disabled:m.value,clearable:"",size:"large",maxlength:"11"},{prefix:u(()=>[d(t,null,{default:u(()=>[d(I(M))]),l:1})]),l:1},8,["modelValue","disabled"])]),l:1})]),d(i,{label:"备注信息",prop:"remark"},{default:u(()=>[d(l,{modelValue:p.value.remark,"onUpdate:modelValue":a[2]||(a[2]=e=>p.value.remark=e),type:"textarea",placeholder:"请输入备注信息（选填）",disabled:m.value,rows:3,maxlength:"200","show-word-limit":"",resize:"none"},null,8,["modelValue","disabled"])]),l:1})]),o("div",ca,[o("div",da,[d(t,{class:"section-icon"},{default:u(()=>[d(I(M))]),l:1}),a[14]||(a[14]=o("h4",{class:"section-title"},"预约须知",-1))]),o("div",ua,[d(h,{title:"重要提醒",type:"warning",closable:!1,"show-icon":""},{default:u(()=>[...a[15]||(a[15]=[o("ul",{class:"notice-list"},[o("li",null,"请确保预约信息准确无误，提交后不可修改"),o("li",null,"如需取消预约，请至少提前半小时联系管理员"),o("li",null,"请爱护场地设施，如有损坏需要赔偿"),o("li",null,"场地内禁止吸烟，请保持环境整洁")],-1)])]),l:1})])]),o("div",ma,[d(k,{size:"large",disabled:m.value,onClick:b},{default:u(()=>[...a[16]||(a[16]=[_(" 取消 ",-1)])]),l:1},8,["disabled"]),d(k,{type:"primary",size:"large",loading:m.value,onClick:y},{default:u(()=>[_(w(m.value?"创建中...":"确认预约"),1)]),l:1},8,["loading"])])]}),l:1},8,["model"])])}}},[["__scopeId","data-v-3d5b6ff2"]]),va={class:"booking-container"},fa={class:"booking-tools"},ga={class:"date-time-selector"},ya={class:"selector-group"},ba={class:"matrix-button-container"},ha={class:"date-status"},ka={class:"status-text"},_a={key:0,class:"selector-group time-selector"},wa={class:"time-picker-container"},Va={class:"time-picker"},xa={class:"time-picker"},Ca={class:"courts-container"},$a={key:0,class:"loading-container"},Da={class:"court-info"},ja={class:"court-name"},za={class:"court-status"},Na={class:"court-description"},Sa={class:"court-price"},Ua=Q({t:"BookingView",setup(t){const s=e=>{const a=e.getDay();return a>=1&&a<=5},i=e=>{const a=e.getDay();return 0===a||6===a},r=(e,a)=>{const t=new Date,l=new Date;l.setHours(0,0,0,0);const s=new Date(l);s.setDate(s.getDate()+1);const i=new Date(e);if(i.setHours(0,0,0,0),i.getTime()===l.getTime()){const[e,l]=a.split(":").map(Number),s=new Date;return s.setHours(e,l,0,0),t.getTime()<s.getTime()}if(i.getTime()===s.getTime()){return t.getHours()>=18}return!1},v=e=>{const a=new Date,t=new Date;t.setHours(0,0,0,0);const l=new Date(t);l.setDate(l.getDate()+1);const s=new Date(e);return s.setHours(0,0,0,0),s.getTime()===l.getTime()&&a.getHours()<18?"不在可预约时间（明天场地需今天18:00后预约）":null},b=e=>{const a=(e=>s(e)?["18:00-21:00"]:i(e)?["8:00-21:00"]:[])(e);if(0===a.length)return{startOptions:[],endOptions:[]};const t=[],l=[],n=a[0],[o,c]=n.split("-"),[d,u]=o.split(":").map(Number),[m,p]=c.split(":").map(Number);let v=d,f=u,g=m-1,y=p;for(y<f&&(g-=1,y+=60);v<g||v===g&&f<=y;){const a=`${v.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`;r(e,a)&&t.push(a),v+=1}let b=d+1,h=u;for(;b<m||b===m&&h<=p;){const e=`${b.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`;l.push(e),b+=1}return{startOptions:[...new Set(t)].sort(),endOptions:[...new Set(l)].sort()}},h=S(()=>b(C.value).startOptions||[]),k=S(()=>{const e=b(C.value);if(!D.value||0===e.endOptions.length)return[];const[a,t]=D.value.split(":").map(Number),l=`${(a+3).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`;return e.endOptions.filter(e=>e<=l&&e>D.value)}),C=a(new Date),D=a("18:00"),N=a("19:00");s(C.value)?(D.value="18:00",N.value="21:00"):(D.value="8:00",N.value="21:00");const U=async e=>{h.value.length>0?(D.value=h.value[0],k.value.length>0&&(N.value=k.value[0])):(D.value="",N.value=""),D.value&&N.value&&D.value<N.value&&await q(e,D.value,N.value)},O=e=>{let a="";s(e)?a="工作日（仅晚上18:00-21:00开放）":i(e)&&(a="周末（全天开放8:00-21:00）");const t=v(e);return t&&(a+=` - ${t}`),a},T=a([]),M=a(!1),P=async()=>{M.value=!0;try{const a=await e({url:"/api/venue/list",method:"get"});0===a.data.code?T.value=a.data.data.map(e=>({id:e.id,name:e.name,description:e.description,price:e.pricePerHour||20,status:e.status,bookable:!1,availabilityReason:"请选择时间段",location:e.location})):x.error(a.message||"获取场地列表失败")}catch(a){x.error("获取场地列表失败，请稍后重试")}finally{M.value=!1}},q=async(a,t,l)=>{try{const i=v(a);if(i||!r(a,t))return void T.value.forEach(e=>{e.bookable=!1,e.availabilityReason=i||"不在可预约时间"});const n=(e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`)(a),o=await(s={date:n,startTime:t,endTime:l},e({url:"/api/venue/availability",method:"get",params:s}));if(0===o.data.code){const{availableVenues:e,unavailableVenues:a}=o.data.data;T.value.forEach(e=>{e.bookable=!1,e.availabilityReason="未知状态"}),e&&e.length>0&&e.forEach(e=>{const a=T.value.find(a=>a.id===e.id);a&&(a.bookable=!0,a.availabilityReason="可预约",void 0!==e.pricePerHour&&(a.price=e.pricePerHour))}),a&&a.length>0&&a.forEach(e=>{const a=T.value.find(a=>a.id===e.id);a&&(a.bookable=!1,a.availabilityReason=e.reason||"不可预约")})}}catch(i){T.value.forEach(e=>{e.bookable=!1,e.availabilityReason="检查失败"})}var s};l(async()=>{await P(),await U(C.value),await le(D.value)});const H=a(!1),B=a(null),F=a(null),R=()=>{H.value=!1,B.value=null},E=()=>{R()},K=a(!1),Q=()=>{K.value=!1},W=()=>{K.value=!0},X=e=>!!e.bookable&&(!(!D.value||!N.value)&&r(C.value,D.value)),ee=e=>e.bookable?"status-available":e.availabilityReason&&"请选择时间段"!==e.availabilityReason?"status-booked":"status-closed",ae=e=>e.bookable?"可预约":e.availabilityReason||"状态未知",te=async()=>{R(),x.success("预约成功！"),D.value&&N.value&&await q(C.value,D.value,N.value)},le=async e=>{if(0===h.value.length)return;e>=N.value&&(N.value=k.value[0]);N.value.split(":").map(Number)[0]-e.split(":").map(Number)[0]>3&&(N.value=k.value[k.value.length-1]),N.value&&await q(C.value,e,N.value)},se=async e=>{if(e<=D.value)if(s(C.value)){const a=k.value.indexOf(e);D.value=h.value[a]}else D.value="18:00";D.value&&await q(C.value,D.value,e)};return(e,a)=>{var t;const l=Y,s=z,i=m,r=p,v=L,b=J,x=G,S=Z,P=V;return $(),n("div",va,[a[12]||(a[12]=o("div",{class:"page-header"},[o("h2",null,"场地预约")],-1)),d(ke),o("div",fa,[o("div",ga,[o("div",ya,[a[5]||(a[5]=o("p",null,"选择日期：",-1)),d(l,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),type:"date",placeholder:"选择预约日期","disabled-date":e=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date(a);return t.setDate(t.getDate()+1),!(e.toDateString()===a.toDateString()||e.toDateString()===t.toDateString())},format:"YYYY年MM月DD日",onChange:U},null,8,["modelValue","disabled-date"])]),o("div",ba,[d(s,{type:"primary",icon:I(A),onClick:W,class:"matrix-button-enhanced",size:"large"},{default:u(()=>[...a[6]||(a[6]=[o("span",{class:"button-text"},"查看场地使用情况表",-1),o("span",{class:"button-subtitle"},"实时查看所有场地状态",-1)])]),l:1},8,["icon"])]),o("div",ha,[o("span",ka,w(O(C.value)),1)]),h.value.length>0?($(),n("div",_a,[a[8]||(a[8]=o("p",null,"时间段：",-1)),o("div",wa,[o("div",Va,[d(r,{modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value=e),placeholder:"开始时间",onChange:le,class:"time-select"},{default:u(()=>[($(!0),n(g,null,y(h.value,e=>($(),f(i,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),l:1},8,["modelValue"])]),a[7]||(a[7]=o("span",{class:"time-separator"},"至",-1)),o("div",xa,[d(r,{modelValue:N.value,"onUpdate:modelValue":a[2]||(a[2]=e=>N.value=e),placeholder:"结束时间",onChange:se,class:"time-select"},{default:u(()=>[($(!0),n(g,null,y(k.value,e=>($(),f(i,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),l:1},8,["modelValue"])])])])):c("",!0)]),a[9]||(a[9]=o("div",{class:"booking-rules"},[o("p",null,[o("strong",null,"预约规则：")]),o("ul",null,[o("li",null,"工作日（周一至周五）：白天场地用于校内上课，仅晚上18:00-21:00开放预约"),o("li",null,"周末（周六、周日）：全天开放预约，时间为8:00-21:00"),o("li",null,"预约时长为1-3小时，每小时20元，时间选择步长为1小时"),o("li",null,"一人一天只能预约一次，如果当天已预约则无法再次预约"),o("li",null,"只能预约今天和明天的场地"),o("li",null,"今天场地：只要在开始时间之前都可以预约（如果有剩余）"),o("li",null,"明天场地：今天18:00之后才能开始预约")])],-1))]),o("div",Ca,[a[11]||(a[11]=o("h3",null,"场地状态",-1)),M.value?($(),n("div",$a,[d(v,{rows:3,animated:""}),a[10]||(a[10]=o("p",{class:"loading-text"},"正在加载场地信息...",-1))])):($(),f(S,{key:1,gutter:20},{default:u(()=>[($(!0),n(g,null,y(T.value,e=>($(),f(x,{xs:24,sm:12,md:8,key:e.id},{default:u(()=>[d(b,{class:j(["court-card",ee(e)])},{default:u(()=>[o("div",Da,[o("div",ja,w(e.name),1),o("div",za,w(ae(e)),1),o("div",Na,w(e.description),1),o("div",Sa,"¥"+w(e.price)+"/小时",1),d(s,{type:"primary",disabled:!X(e),onClick:a=>(e=>{B.value=e,H.value=!0})(e),class:"book-button"},{default:u(()=>[_(w(X(e)?"立即预约":"暂不可预约"),1)]),l:2},1032,["disabled","onClick"])])]),l:2},1032,["class"])]),l:2},1024))),128))]),l:1}))]),d(P,{modelValue:H.value,"onUpdate:modelValue":a[3]||(a[3]=e=>H.value=e),title:`预约 ${null==(t=B.value)?void 0:t.name}`,width:"600px",onClose:R},{default:u(()=>[B.value?($(),f(pa,{key:0,ref_key:"createOrderFormRef",ref:F,court:B.value,date:C.value,"start-time":D.value,"end-time":N.value,onSuccess:te,onCancel:E},null,8,["court","date","start-time","end-time"])):c("",!0)]),l:1},8,["modelValue","title"]),d(P,{modelValue:K.value,"onUpdate:modelValue":a[4]||(a[4]=e=>K.value=e),title:"场地使用情况表",width:"90%",onClose:Q},{default:u(()=>[K.value?($(),f(Ye,{key:0,"current-date":C.value,"start-time":D.value,"end-time":N.value},null,8,["current-date","start-time","end-time"])):c("",!0)]),l:1},8,["modelValue"])])}}},[["__scopeId","data-v-7de6964d"]]);export{Ua as default};

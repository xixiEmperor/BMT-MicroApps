import{az as e,r as a,E as t,d as r,o as s,l as o,h as l,k as i,g as n,w as c,ap as d,j as u,ai as p,a2 as m,P as v,Q as f,a3 as y,a as g,J as h,as as C,m as N,A as k,x as j,a4 as L,i as D,f as O,c as _}from"./index-BMm2wflY.js";/* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                 */import{_ as A}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                         *//* empty css                    */import{f as P,d as w,O as I}from"./pay-CLrLKGCg.js";/* empty css                       *//* empty css                   */const b=e("order",()=>{const e=a([]),r=a(!1),s=a(0),o=a(null);return{orderList:e,loading:r,fetchOrderList:async function(a=1,o=5,l=null){if(!r.value){r.value=!0;try{const t=await P({pageNum:a,pageSize:o,status:l});if(0!==t.data.code)throw new Error(t.data.message||"获取订单列表失败");e.value=t.data.data.list||[],s.value=t.data.data.total||0}catch(i){t.error("获取订单列表失败")}finally{r.value=!1}}},cancelOrder:async function(a){try{const r=await w(a);if(0===r.data.code){const s=e.value.findIndex(e=>e.orderNo===a);return-1!==s&&(e.value[s].status=I.CANCELLED),t.success(r.data.msg||"订单取消成功"),!0}return t.error(r.data.msg||"取消订单失败"),!1}catch(r){return t.error("取消订单失败"),!1}},getOrderByNo:function(a){return e.value.find(e=>e.orderNo===a)},total:s,status:o}},{persist:!0}),x={class:"order-list-container"},z={class:"order-header"},E={class:"order-tabs"},U={key:0,class:"loading-container"},T={key:1,class:"empty-container"},S={key:2,class:"order-list"},B={class:"order-header-info"},q={class:"order-info"},V={class:"order-no"},F={class:"order-time"},J={class:"order-status"},R={class:"order-content"},$={class:"order-products"},H=["onClick"],K={class:"product-details"},M={class:"product-name"},Q={key:0,class:"product-specs"},G={class:"product-price"},W={class:"product-quantity"},X={class:"order-footer"},Y={class:"order-amount"},Z={class:"total-price"},ee={class:"order-actions"},ae={key:3,class:"pagination-container"},te=A({__name:"OrderListView",setup(e){const A=g(),P=b(),w=a("all"),te=a(1),re=a(5),{loading:se,cancelOrder:oe,refreshOrders:le}=P,ie=r(()=>P.total),handleTabChange=e=>{w.value=e,te.value=1,P.fetchOrderList(te.value,re.value,I[e])},handleSizeChange=e=>{re.value=e,te.value=1,P.fetchOrderList(te.value,re.value,I[w.value])},handleCurrentChange=e=>{te.value=e,P.fetchOrderList(te.value,re.value,I[w.value])},viewOrderDetail=e=>{A.push(`/order-detail/${e}`)},goShopping=()=>{A.push("/shop")},getStatusType=e=>{switch(e){case I.UNPAID:return"warning";case I.PAID:return"success";case I.CANCELLED:return"danger";default:return"info"}},getStatusText=e=>{switch(e){case I.UNPAID:return"待支付";case I.PAID:return"已支付";case I.CANCELLED:return"已取消";case I.COMPLETED:return"已完成";default:return"未知状态"}},formatTime=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},hasValidSpecs=e=>{if(!e||null===e)return!1;if("object"==typeof e){const a=Object.entries(e);return a.length>0&&a.some(([,e])=>null!=e&&""!==e)}return!1};return s(()=>{P.fetchOrderList()}),(e,a)=>{const r=C,s=d,g=p,b=N,ne=m,ce=L,de=D,ue=y;return h(),o("div",x,[l("div",z,[a[3]||(a[3]=l("h2",null,"我的订单",-1)),l("div",E,[n(s,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e),onTabChange:handleTabChange},{default:c(()=>[n(r,{label:"全部订单",name:"all"}),n(r,{label:"待支付",name:"UNPAID"}),n(r,{label:"已支付",name:"PAID"}),n(r,{label:"已取消",name:"CANCELLED"})]),_:1},8,["modelValue"])])]),u(se)?(h(),o("div",U,[n(g,{rows:3,animated:""})])):0===u(P).orderList.length?(h(),o("div",T,[n(ne,{description:"暂无订单数据"},{default:c(()=>[n(b,{type:"primary",onClick:goShopping},{default:c(()=>[...a[4]||(a[4]=[k("去购物",-1)])]),_:1})]),_:1})])):(h(),o("div",S,[(h(!0),o(v,null,f(u(P).orderList,e=>(h(),o("div",{key:e.orderNo,class:"order-item"},[l("div",B,[l("div",q,[l("span",V,"订单号："+j(e.orderNo),1),l("span",F,j(formatTime(e.createTime)),1)]),l("div",J,[n(ce,{type:getStatusType(e.status)},{default:c(()=>[k(j(getStatusText(e.status)),1)]),_:2},1032,["type"])])]),l("div",R,[l("div",$,[(h(!0),o(v,null,f(e.orderItemList,(a,t)=>(h(),o("div",{key:t,class:"product-item",onClick:a=>viewOrderDetail(e.orderNo)},[n(de,{src:a.productImage,class:"product-image",fit:"cover"},null,8,["src"]),l("div",K,[l("div",M,j(a.productName),1),hasValidSpecs(a.specs)?(h(),o("div",Q," 规格："+j(Object.entries(a.specs).map(([,e])=>`${e}`).join("、")),1)):i("",!0),l("div",G,"¥"+j((a.currentUnitPrice+a.priceAdjustment).toFixed(2)),1)]),l("div",W,"x"+j(a.quantity),1)],8,H))),128))]),l("div",X,[l("div",Y,[l("span",null,"共"+j(e.orderItemList.reduce((e,a)=>e+a.quantity,0))+"件商品，合计：",1),l("span",Z,"¥"+j(e.totalPrice.toFixed(2)),1)]),l("div",ee,[n(b,{size:"small",onClick:a=>viewOrderDetail(e.orderNo)},{default:c(()=>[...a[5]||(a[5]=[k(" 查看详情 ",-1)])]),_:1},8,["onClick"]),e.status===u(I).UNPAID?(h(),O(b,{key:0,type:"primary",size:"small",onClick:a=>(e=>{const a={orderNo:e.orderNo,amount:e.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(a)),A.push("/payment")})(e)},{default:c(()=>[...a[6]||(a[6]=[k(" 立即支付 ",-1)])]),_:1},8,["onClick"])):i("",!0),e.status===u(I).UNPAID?(h(),O(b,{key:1,type:"danger",size:"small",onClick:a=>{return t=e.orderNo,void _.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await oe(t)}).catch(()=>{});var t}},{default:c(()=>[...a[7]||(a[7]=[k(" 取消订单 ",-1)])]),_:1},8,["onClick"])):i("",!0),e.status===u(I).PAID?(h(),O(b,{key:2,type:"success",size:"small",onClick:a=>(e.orderNo,void _.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(async()=>{try{t.success("确认收货成功"),await le()}catch(e){t.error("确认收货失败")}}).catch(()=>{}))},{default:c(()=>[...a[8]||(a[8]=[k(" 确认收货 ",-1)])]),_:1},8,["onClick"])):i("",!0)])])])]))),128))])),ie.value>0?(h(),o("div",ae,[n(ue,{"current-page":te.value,"onUpdate:currentPage":a[1]||(a[1]=e=>te.value=e),"page-size":re.value,"onUpdate:pageSize":a[2]||(a[2]=e=>re.value=e),"page-sizes":[5,10,15,20],total:ie.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:handleSizeChange,onCurrentChange:handleCurrentChange},null,8,["current-page","page-size","total"])])):i("",!0)])}}},[["__scopeId","data-v-c13f4ba5"]]);export{te as default};

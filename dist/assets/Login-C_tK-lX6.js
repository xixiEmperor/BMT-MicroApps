import{u as e,r as a,L as l,l as r,f as s,k as o,w as t,g as i,ak as n,ah as d,ae as u,h as p,af as m,j as c,t as f,a_ as g,a$ as _,m as y,A as w,x as V,b0 as x,av as b,P as v,E as h,a as k,aj as C,D as j,J as U}from"./index-RXELqIC3.js";/* empty css               *//* empty css                    *//* empty css                     */import{V as I,a as q,b as $,c as E}from"./VerificationCodeInput-BEoZipuI.js";import{_ as L}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                 */const z={class:"verify-code-section"},A={class:"flex"},D={name:"LoginView"},M=L(Object.assign(D,{setup(L){const D=e(),M=k(),O=a(!1),S=a({username:"",password:"",email:"",verificationCode:""}),H=a(!1),J=a(0);let N=null;const P={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:10,message:"请输入5-10位用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^\S{6,15}$/,message:"请输入6-15位非空密码",trigger:"blur"}],repassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(e,a,l)=>{a!==S.value.password?l(new Error("请输入相同的密码")):l()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"请输入6位验证码",trigger:"blur"}]},R=a();l(O,()=>{S.value={username:"",password:"",repassword:"",email:"",verificationCode:""},N&&(clearInterval(N),N=null),H.value=!1,J.value=0});const B=async()=>{try{await R.value.validateField(["email"]),H.value=!0;const e=await q({email:S.value.email,type:"register"});0===e.data.code?(h.success("验证码已发送至您的邮箱"),J.value=60,N=setInterval(()=>{J.value--,J.value<=0&&(clearInterval(N),N=null,H.value=!1)},1e3)):(h.error(e.data.msg||"发送验证码失败"),H.value=!1)}catch(e){h.error("发送验证码失败，请检查邮箱格式"),H.value=!1}},F=async()=>{await R.value.validate();const e=await $(S.value);0===e.data.code?(h.success("注册成功"),O.value=!1):h.error(e.data.msg||"注册失败")},G=async()=>{var e,a,l;await R.value.validate();try{const a=await E(S.value);if(0===a.code){h.success("登录成功");const l=a.data.token;D.setToken(l),await D.getUserinfo();const r=M.currentRoute.value.query.redirect||"/";if("ROLE_ADMIN"===(null==(e=D.userinfo)?void 0:e.role)){const e=r.startsWith("/admin")?r:"/admin";M.push(e)}else M.push(r)}else h.error(a.message)}catch(r){h.error(`登录失败: ${(null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.message)||r.message||"未知错误"}`)}},K=()=>{M.push("/login/forget-password")};return(e,a)=>{const l=j("router-view"),h=n,k=u,q=m,$=y,E=x,L=d,D=b,M=C;return U(),r(v,null,["/login"!==e.$route.path?(U(),s(l,{key:0})):o("",!0),"/login"===e.$route.path?(U(),s(M,{key:1,class:"login-page"},{default:t(()=>[i(h,{span:12,class:"bg"}),i(h,{span:6,offset:3,class:"form"},{default:t(()=>[O.value?(U(),s(L,{key:0,model:S.value,rules:P,ref_key:"form",ref:R,size:"large",autocomplete:"off"},{default:t(()=>[i(k,null,{default:t(()=>[...a[9]||(a[9]=[p("h1",null,"注册",-1)])]),l:1}),i(k,{prop:"username"},{default:t(()=>[i(q,{modelValue:S.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value.username=e),"prefix-icon":c(f),placeholder:"请输入用户名"},null,8,["modelValue","prefix-icon"])]),l:1}),i(k,{prop:"password"},{default:t(()=>[i(q,{modelValue:S.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>S.value.password=e),"prefix-icon":c(g),type:"password",placeholder:"请输入密码"},null,8,["modelValue","prefix-icon"])]),l:1}),i(k,{prop:"repassword"},{default:t(()=>[i(q,{modelValue:S.value.repassword,"onUpdate:modelValue":a[2]||(a[2]=e=>S.value.repassword=e),"prefix-icon":c(g),type:"password",placeholder:"请输入再次密码"},null,8,["modelValue","prefix-icon"])]),l:1}),i(k,{prop:"email"},{default:t(()=>[i(q,{modelValue:S.value.email,"onUpdate:modelValue":a[3]||(a[3]=e=>S.value.email=e),"prefix-icon":c(_),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue","prefix-icon"])]),l:1}),i(k,{prop:"verificationCode"},{default:t(()=>[p("div",z,[i(I,{modelValue:S.value.verificationCode,"onUpdate:modelValue":a[4]||(a[4]=e=>S.value.verificationCode=e),length:6},null,8,["modelValue"]),i($,{type:"primary",disabled:H.value||J.value>0,onClick:B,class:"verify-code-btn"},{default:t(()=>[w(V(J.value>0?`${J.value}秒后重新获取`:"获取验证码"),1)]),l:1},8,["disabled"])])]),l:1}),i(k,null,{default:t(()=>[i($,{onClick:F,class:"button",type:"primary","auto-insert-space":""},{default:t(()=>[...a[10]||(a[10]=[w(" 注册 ",-1)])]),l:1})]),l:1}),i(k,{class:"flex"},{default:t(()=>[i(E,{type:"info",underline:!1,onClick:a[5]||(a[5]=e=>O.value=!1)},{default:t(()=>[...a[11]||(a[11]=[w(" ← 返回 ",-1)])]),l:1})]),l:1})]),l:1},8,["model"])):(U(),s(L,{key:1,model:S.value,rules:P,ref_key:"form",ref:R,size:"large",autocomplete:"off"},{default:t(()=>[i(k,null,{default:t(()=>[...a[12]||(a[12]=[p("h1",null,"登录",-1)])]),l:1}),i(k,{prop:"username"},{default:t(()=>[i(q,{modelValue:S.value.username,"onUpdate:modelValue":a[6]||(a[6]=e=>S.value.username=e),"prefix-icon":c(f),placeholder:"请输入用户名",id:"username-input"},null,8,["modelValue","prefix-icon"])]),l:1}),i(k,{prop:"password"},{default:t(()=>[i(q,{modelValue:S.value.password,"onUpdate:modelValue":a[7]||(a[7]=e=>S.value.password=e),name:"password","prefix-icon":c(g),type:"password",placeholder:"请输入密码",id:"password-input"},null,8,["modelValue","prefix-icon"])]),l:1}),i(k,{class:"flex"},{default:t(()=>[p("div",A,[i(D,null,{default:t(()=>[...a[13]||(a[13]=[w("记住我",-1)])]),l:1}),i(E,{type:"primary",underline:!1,onClick:K},{default:t(()=>[...a[14]||(a[14]=[w("忘记密码？",-1)])]),l:1})])]),l:1}),i(k,null,{default:t(()=>[i($,{id:"login-btn",onClick:G,class:"button",type:"primary","auto-insert-space":""},{default:t(()=>[...a[15]||(a[15]=[w("登录",-1)])]),l:1})]),l:1}),i(k,{class:"flex"},{default:t(()=>[i(E,{type:"info",underline:!1,onClick:a[8]||(a[8]=e=>O.value=!0)},{default:t(()=>[...a[16]||(a[16]=[w(" 注册 → ",-1)])]),l:1})]),l:1})]),l:1},8,["model"]))]),l:1})]),l:1})):o("",!0)],64)}}}),[["__scopeId","data-v-696f51c4"]]);export{M as default};

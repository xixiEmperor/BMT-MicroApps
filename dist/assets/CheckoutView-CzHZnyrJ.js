import{r as e,o as a,E as t,a as s,l as c,k as o,h as l,g as u,w as r,m as i,i as d,x as p,P as n,Q as v,af as m,J as y,A as h}from"./index-BMm2wflY.js";/* empty css                 *//* empty css                        */import{_ as f}from"./_plugin-vue_export-helper-CTKw_zaB.js";import{c as k,a as g,B as x}from"./pay-CLrLKGCg.js";import{u as j}from"./cart-M_M03IGN.js";const _={key:0,class:"checkout-container"},w={class:"checkout-header"},A={class:"checkout-section"},I={key:0,class:"product-info"},b={class:"product-details"},q={class:"product-name"},F={key:0,class:"product-specs"},N={class:"product-price"},O={class:"product-quantity"},S={class:"product-subtotal"},P={class:"price"},V={key:1},C={class:"product-details"},J={class:"product-name"},B={key:0,class:"product-specs"},L={class:"product-price"},T={class:"product-quantity"},$={class:"product-subtotal"},z={class:"price"},E={class:"checkout-section"},M={class:"checkout-section order-amount"},Q={class:"amount-item"},U={class:"amount-item total"},D={class:"price"},G={class:"checkout-footer"},H={class:"total-payment"},K={class:"price"},R=f({__name:"CheckoutView",setup(f){const R=s(),W=j(),X=e(null),Y=e(""),Z=e(!1),backToCart=()=>{R.push("/cart")},submitOrder=async()=>{try{let a;if(Z.value=!0,X.value.isBuyNow){const e={productId:X.value.products[0].productId,quantity:X.value.products[0].quantity,specs:X.value.products[0].specs||{}};a=await k(e)}else a=await g();if(0===a.data.code){const s={orderNo:a.data.data,amount:X.value.totalAmount,businessType:x.MALL,remarks:Y.value};if(localStorage.setItem("payment_info",JSON.stringify(s)),X.value.products)try{await W.removeOrderedItems(X.value)}catch(e){}localStorage.removeItem("checkout_order"),t.success("订单创建成功，即将跳转到支付页面"),setTimeout(()=>{R.push("/payment")},1e3)}else t.error(a.message||"创建订单失败")}catch(e){t.error("创建订单失败，请重试")}finally{Z.value=!1}};return a(()=>{const e=localStorage.getItem("checkout_order");if(e)try{X.value=JSON.parse(e)}catch(a){t.error("获取订单信息失败"),R.push("/cart")}else t.warning("没有待结算的订单"),R.push("/cart")}),(e,a)=>{const t=i,s=d,f=m;return X.value?(y(),c("div",_,[l("div",w,[a[2]||(a[2]=l("h2",null,"订单确认",-1)),u(t,{type:"text",onClick:backToCart},{default:r(()=>[...a[1]||(a[1]=[h("返回购物车",-1)])]),_:1})]),l("div",A,[a[5]||(a[5]=l("h3",null,"商品信息",-1)),X.value.product?(y(),c("div",I,[u(s,{src:X.value.product.productImage,class:"product-image",fit:"cover"},null,8,["src"]),l("div",b,[l("div",q,p(X.value.product.productName),1),Object.keys(X.value.product.specs||{}).length>0?(y(),c("div",F," 规格："+p(Object.entries(X.value.product.specs).map(([e,a])=>`${a}`).join("、")),1)):o("",!0),l("div",N,"¥"+p((X.value.product.productPrice+X.value.product.priceAdjustment).toFixed(2)),1),l("div",O,"x "+p(X.value.quantity),1)]),l("div",S,[a[3]||(a[3]=l("span",null,"小计：",-1)),l("span",P,"¥"+p(X.value.totalAmount.toFixed(2)),1)])])):o("",!0),X.value.products?(y(),c("div",V,[(y(!0),c(n,null,v(X.value.products,(e,t)=>(y(),c("div",{key:t,class:"product-info"},[u(s,{src:e.productImage,class:"product-image",fit:"cover"},null,8,["src"]),l("div",C,[l("div",J,p(e.productName),1),Object.keys(e.specs||{}).length>0?(y(),c("div",B," 规格："+p(Object.entries(e.specs).map(([e,a])=>`${a}`).join("、")),1)):o("",!0),l("div",L,"¥"+p((e.productPrice+e.priceAdjustment).toFixed(2)),1),l("div",T,"x "+p(e.quantity),1)]),l("div",$,[a[4]||(a[4]=l("span",null,"小计：",-1)),l("span",z,"¥"+p(((e.productPrice+e.priceAdjustment)*e.quantity).toFixed(2)),1)])]))),128))])):o("",!0)]),l("div",E,[a[6]||(a[6]=l("h3",null,"订单备注",-1)),u(f,{type:"textarea",rows:3,placeholder:"可以告诉我们您的特殊要求（选填）",modelValue:Y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.value=e),maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),l("div",M,[l("div",Q,[a[7]||(a[7]=l("span",null,"商品总价：",-1)),l("span",null,"¥"+p(X.value.totalAmount.toFixed(2)),1)]),l("div",U,[a[8]||(a[8]=l("span",null,"应付总额：",-1)),l("span",D,"¥"+p(X.value.totalAmount.toFixed(2)),1)])]),l("div",G,[l("div",H,[a[9]||(a[9]=l("span",null,"应付总额：",-1)),l("span",K,"¥"+p(X.value.totalAmount.toFixed(2)),1)]),u(t,{type:"primary",size:"large",onClick:submitOrder,loading:Z.value},{default:r(()=>[h(p(Z.value?"创建订单中...":"提交订单"),1)]),_:1},8,["loading"])])])):o("",!0)}}},[["__scopeId","data-v-5f7ebdac"]]);export{R as default};

import{r as a,o as t,l as e,h as l,g as s,f as i,k as c,w as o,j as n,ab as r,m as d,ai as u,a2 as p,at as m,x as y,a as k,J as f,A as v,au as _,av as h,i as b,aw as g,ax as w,ay as j,c as C}from"./index-RXELqIC3.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                         */import{_ as x}from"./_plugin-vue_export-helper-CRLhVpGU.js";import{u as V}from"./cart-CpOPODuf.js";/* empty css                       *//* empty css                 *//* empty css                   */const z={class:"cart-container"},B={class:"cart-header"},O={class:"cart-actions"},S={key:0},T={key:1,class:"empty-cart"},q={key:2,class:"cart-content"},A={class:"product-info"},J={class:"product-details"},U={key:0,class:"product-name"},N={key:1,class:"product-name"},P={class:"product-price"},$={class:"price"},E={class:"quantity-control"},I={class:"quantity"},L={class:"subtotal"},M={class:"action-buttons"},D={class:"cart-footer"},F={class:"total-amount"},G={class:"total-price"},H=x({t:"CartView",setup(x){const H=k(),K=V(),Q=a(!1),R=()=>{Q.value=!Q.value},W=async()=>{await K.toggleSelectAll()},X=()=>{C.confirm("确定要清空购物车吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await K.clearCart()}).catch(()=>{})},Y=()=>{const a=K.getSelectedItems();if(0===a.length)return void C.alert("请至少选择一件商品进行结算！","提示");let t=0;const e={products:a.map(a=>{const e=a.productPrice+(a.priceAdjustment||0),l=e*a.quantity;return t+=l,{...a,actualPrice:e}}),totalAmount:t};localStorage.setItem("checkout_order",JSON.stringify(e)),H.push("/checkout")};return t(async()=>{K.resetLoadingState();try{await K.fetchCartList()}catch(a){}}),(a,t)=>{const k=d,x=u,V=p,Z=h,aa=_,ta=b,ea=m;return f(),e("div",z,[l("div",B,[t[3]||(t[3]=l("h2",null,"我的购物车",-1)),l("div",O,[s(k,{type:"primary",icon:n(r),onClick:R},{default:o(()=>[v(y(Q.value?"完成":"编辑"),1)]),l:1},8,["icon"]),n(K).cartItems.length>0?(f(),i(k,{key:0,type:"danger",onClick:X},{default:o(()=>[...t[2]||(t[2]=[v(" 清空购物车 ",-1)])]),l:1})):c("",!0)])]),n(K).loading?(f(),e("div",S,[s(x,{rows:5,animated:""})])):0===n(K).cartItems.length?(f(),e("div",T,[s(V,{description:"购物车是空的，快去添加喜欢的商品吧！"},{default:o(()=>[s(k,{type:"primary",onClick:t[0]||(t[0]=t=>a.$router.push("/shop"))},{default:o(()=>[...t[4]||(t[4]=[v("去购物",-1)])]),l:1})]),l:1})])):(f(),e("div",q,[s(ea,{data:n(K).cartItems,style:{width:"100%"}},{default:o(()=>[s(aa,{width:"55",align:"center"},{header:o(()=>[s(Z,{modelValue:n(K).isAllSelected,"onUpdate:modelValue":t[1]||(t[1]=a=>n(K).isAllSelected=a),onChange:W},null,8,["modelValue"])]),default:o(a=>[s(Z,{modelValue:a.row.selected,"onUpdate:modelValue":t=>a.row.selected=t,onChange:()=>(async a=>{await K.toggleSelectItem(a)})(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),l:1}),s(aa,{label:"商品","min-width":"300"},{default:o(a=>[l("div",A,[s(ta,{src:a.row.productImage,fit:"cover",class:"product-image"},null,8,["src"]),l("div",J,[Object.keys(a.row.specs||{}).length>0?(f(),e("div",U,y(a.row.productName)+" ("+y(Object.entries(a.row.specs).map(([a,t])=>`${t}`).join("、"))+") ",1)):(f(),e("div",N,y(a.row.productName),1)),l("div",P,"¥"+y(a.row.productPrice+a.row.priceAdjustment),1)])])]),l:1}),s(aa,{label:"单价",width:"120",align:"center"},{default:o(a=>[l("span",$,"¥"+y(a.row.productPrice+a.row.priceAdjustment),1)]),l:1}),s(aa,{label:"数量",width:"180",align:"center"},{default:o(a=>[l("div",E,[s(k,{icon:n(g),circle:"",size:"small",onClick:t=>(async a=>{await K.decreaseQuantity(a)})(a.row),disabled:a.row.quantity<=1},null,8,["icon","onClick","disabled"]),l("span",I,y(a.row.quantity),1),s(k,{icon:n(w),circle:"",size:"small",onClick:t=>(async a=>{await K.increaseQuantity(a)})(a.row),disabled:a.row.quantity>=a.row.stock},null,8,["icon","onClick","disabled"])])]),l:1}),s(aa,{label:"小计",width:"150",align:"center"},{default:o(a=>[l("span",L,"¥"+y(((a.row.productPrice+a.row.priceAdjustment)*a.row.quantity).toFixed(2)),1)]),l:1}),s(aa,{label:"操作",width:"180",align:"center"},{default:o(a=>[l("div",M,[Q.value?(f(),i(k,{key:0,type:"danger",icon:n(j),size:"small",onClick:t=>{return e=a.row,void C.confirm(`确定要从购物车中移除 ${e.productName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await K.removeFromCart(e)}).catch(()=>{});var e}},{default:o(()=>[...t[5]||(t[5]=[v(" 删除 ",-1)])]),l:1},8,["icon","onClick"])):c("",!0),Q.value?c("",!0):(f(),i(k,{key:1,type:"primary",size:"small",onClick:t=>(a=>{const t=a.productPrice+(a.priceAdjustment||0),e=t*a.quantity,l={product:{...a,actualPrice:t},totalAmount:e};localStorage.setItem("checkout_order",JSON.stringify(l)),H.push("/checkout")})(a.row)},{default:o(()=>[...t[6]||(t[6]=[v(" 立即购买 ",-1)])]),l:1},8,["onClick"]))])]),l:1})]),l:1},8,["data"]),l("div",D,[l("div",F,[t[7]||(t[7]=l("span",null,"总计:",-1)),l("span",G,"¥"+y(n(K).totalPrice.toFixed(2)),1)]),s(k,{type:"primary",size:"large",onClick:Y,disabled:Q.value},{default:o(()=>[...t[8]||(t[8]=[v(" 结算 ",-1)])]),l:1},8,["disabled"])])]))])}}},[["__scopeId","data-v-92b21634"]]);export{H as default};

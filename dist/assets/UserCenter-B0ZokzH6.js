import{r as e,u as a,K as l,o as t,l as o,h as s,g as n,w as r,ah as d,ae as i,aK as u,af as c,j as p,t as m,aL as f,a0 as h,P as v,Q as g,a9 as b,q as _,aM as w,m as V,A as y,U as j,E as x,an as U,aN as k,a as F,aO as M,J as R,$ as A}from"./index-RXELqIC3.js";/* empty css                *//* empty css                     */import{_ as C}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                             *//* empty css                 *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                    */const O={class:"user-center-container"},$=["src"],z={key:1,src:"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png",class:"avatar",alt:"默认头像"},B={class:"form-section"},D={class:"form-section"},E=C({l:"UserCenter",setup(C){const E=F(),I=U(),K=e("/"),L=a(),P=l({username:"",nickname:"",phone:"",bio:"",gender:"",birthday:"",location:"",avatar:""}),q=e(null),H=e(!1),J=[{value:"male",label:"男"},{value:"female",label:"女"},{value:"other",label:"其他"}],N=e(""),Q={nickname:[{pattern:/^[\u4e00-\u9fa5a-zA-Z]+$/,message:"名称只能由英文字母，汉字组成",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},Z=e=>{const a="image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type,l=e.size/1024/1024<10;return a?!!l||(x.error("头像大小不能超过 10MB!"),!1):(x.error("文件格式不支持，请上传jpg、png或jpeg格式图片"),!1)},G=async(e,a)=>{var l,t;if(a.raw)try{const e=await((e,a=.8)=>new Promise(l=>{const t=new FileReader;t.readAsDataURL(e),t.onload=t=>{const o=new Image;o.src=t.target.result,o.onload=()=>{const t=document.createElement("canvas"),s=t.getContext("2d");let n=o.width,r=o.height;const d=800;n>r&&n>d?(r=Math.round(r*d/n),n=d):r>d&&(n=Math.round(n*d/r),r=d),t.width=n,t.height=r,s.clearRect(0,0,n,r),s.drawImage(o,0,0,n,r),t.toBlob(a=>{const t=new File([a],e.name,{type:e.type,lastModified:Date.now()});l(t)},e.type,a)}}}))(a.raw),l=new FormData;l.append("file",e);const t=new FileReader;t.readAsDataURL(e),t.onload=()=>{N.value=t.result};const o=await M(l);if(0===o.data.code){N.value=o.data.data.avatarUrl,P.avatar=o.data.data.avatarUrl;const e={...L.userinfo,avatar:o.data.data.avatarUrl};L.setUserinfo(e),window.dispatchEvent(new CustomEvent("user-avatar-updated",{detail:{avatarUrl:o.data.data.avatarUrl}})),x.success(o.data.message||"上传成功")}else x.error(o.data.message||"上传失败")}catch(o){x.error((null==(t=null==(l=o.response)?void 0:l.data)?void 0:t.message)||"头像上传失败")}},S=e=>{e.raw&&Z(e.raw)&&G(0,e)},T=async()=>{try{H.value=!0,await q.value.validate();const e=await k(P);x.success(e.data.msg);const a={...L.userinfo,...e.data.data};L.setUserinfo(a),E.push(K.value)}catch(e){x.error(e.response.data.message)}finally{H.value=!1}};return t(()=>{(()=>{const e=L.userinfo;if(e)try{Object.keys(P).forEach(a=>{e[a]&&(P[a]=e[a])}),e.avatar&&(N.value=e.avatar)}catch(a){x.error(a.response.data.message)}if(I.query.from)K.value=I.query.from;else if(document.referrer&&document.referrer.includes(window.location.origin)){const e=new URL(document.referrer);K.value=e.pathname+e.search}})()}),(e,a)=>{const l=u,t=i,x=c,U=A,k=h,F=b,M=V,C=d,E=j;return R(),o("div",O,[a[11]||(a[11]=s("h2",null,"个人中心",-1)),n(E,{class:"user-center-card"},{default:r(()=>[n(C,{ref_key:"userFormRef",ref:q,model:P,rules:Q,"label-position":"top",class:"user-form"},{default:r(()=>[n(t,{class:"avatar-uploader-container"},{default:r(()=>[n(l,{class:"avatar-uploader","show-file-list":!1,"on-change":S,"before-upload":Z,"auto-upload":!1,name:"file"},{default:r(()=>[N.value?(R(),o("img",{key:0,src:N.value,class:"avatar"},null,8,$)):(R(),o("img",z)),a[7]||(a[7]=s("div",{class:"avatar-hover-text"},"点击更换头像",-1))]),t:1})]),t:1}),s("div",B,[a[8]||(a[8]=s("h3",null,"基本信息",-1)),n(t,{label:"账号"},{default:r(()=>[n(x,{modelValue:P.username,"onUpdate:modelValue":a[0]||(a[0]=e=>P.username=e),disabled:"",placeholder:"userinfo.username"},null,8,["modelValue"])]),t:1}),n(t,{label:"昵称",prop:"nickname"},{default:r(()=>[n(x,{modelValue:P.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>P.nickname=e),placeholder:"请输入昵称","prefix-icon":p(m)},null,8,["modelValue","prefix-icon"])]),t:1}),n(t,{label:"手机号码",prop:"phone"},{default:r(()=>[n(x,{modelValue:P.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>P.phone=e),placeholder:"请输入手机号码","prefix-icon":p(f)},null,8,["modelValue","prefix-icon"])]),t:1}),n(t,{label:"个人简介"},{default:r(()=>[n(x,{modelValue:P.bio,"onUpdate:modelValue":a[3]||(a[3]=e=>P.bio=e),type:"textarea",placeholder:"请输入个人简介",rows:4},null,8,["modelValue"])]),t:1})]),s("div",D,[a[9]||(a[9]=s("h3",null,"更多信息",-1)),n(t,{label:"性别"},{default:r(()=>[n(k,{modelValue:P.gender,"onUpdate:modelValue":a[4]||(a[4]=e=>P.gender=e),placeholder:"请选择性别",style:{width:"100%"}},{default:r(()=>[(R(),o(v,null,g(J,e=>n(U,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),t:1},8,["modelValue"])]),t:1}),n(t,{label:"生日"},{default:r(()=>[n(F,{modelValue:P.birthday,"onUpdate:modelValue":a[5]||(a[5]=e=>P.birthday=e),type:"date",placeholder:"请选择生日",style:{width:"100%"},"prefix-icon":p(_)},null,8,["modelValue","prefix-icon"])]),t:1}),n(t,{label:"所在地"},{default:r(()=>[n(x,{modelValue:P.location,"onUpdate:modelValue":a[6]||(a[6]=e=>P.location=e),placeholder:"请输入所在地","prefix-icon":p(w)},null,8,["modelValue","prefix-icon"])]),t:1})]),n(t,null,{default:r(()=>[n(M,{type:"primary",onClick:T,loading:H.value,class:"save-btn"},{default:r(()=>[...a[10]||(a[10]=[y("保存修改",-1)])]),t:1},8,["loading"])]),t:1})]),t:1},8,["model"])]),t:1})])}}},[["__scopeId","data-v-1c0e85da"]]);export{E as default};

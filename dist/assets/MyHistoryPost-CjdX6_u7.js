import{u as a,r as e,o as t,l as s,h as l,k as o,g as i,j as r,aS as n,x as p,A as u,w as c,m as d,M as m,a1 as v,f as h,p as f,aJ as y,au as g,a4 as w,aT as j,ay as b,a3 as C,E as _,a as k,c as x,at as z,J as T}from"./index-BMm2wflY.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";import{_ as A}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                  */import{f as M}from"./format-D0hGXpTN.js";import{j as R,h as S}from"./forum-kHVTcl2q.js";/* empty css                       *//* empty css                   */const I={class:"my-posts-container"},P={class:"posts-header"},V={key:0,class:"user-info"},B={class:"username"},E={class:"user-stats"},J={class:"stat-item"},L={class:"posts-content"},$=["onClick"],D={class:"post-stats"},F={class:"post-actions"},G={class:"pagination-container"},H=A({__name:"MyHistoryPost",setup(A){const H=k(),O=a();e({}).value=O.userinfo||{};const U=e(1),q=e(10),K=e(0),N=e([]),Q=e(!1),loadUserPosts=async()=>{var a;if(!(null==(a=O.userinfo)?void 0:a.id))return _.warning("请先登录"),void H.push("/login");Q.value=!0;try{const a={userId:O.userinfo.id,page:U.value,pageSize:q.value},e=await R(a);0===e.data.code?(N.value=e.data.data.list||[],K.value=e.data.data.total||0,N.value.forEach(a=>{a.publishTime&&(a.publishTime=M(a.publishTime)),a.lastReply&&(a.lastReply=M(a.lastReply))})):_.error(e.data.msg||"获取发帖记录失败")}catch(e){_.error("获取发帖记录失败")}finally{Q.value=!1}},navigateToDetail=a=>{H.push(`/post/${a}`)},handlePageChange=a=>{U.value=a,loadUserPosts()},handleSizeChange=a=>{q.value=a,U.value=1,loadUserPosts()},navigateToPublish=()=>{H.push("/publish-post")},getCategoryName=a=>({team:"打球组队",notice:"赛事讨论",help:"求助问答",exp:"经验交流"}[a]||"其他");return t(()=>{loadUserPosts()}),(a,e)=>{var t,k;const A=n,M=d,R=f,H=g,W=w,X=z,Y=C,Z=v;return T(),s("div",I,[e[3]||(e[3]=l("h2",null,"我的发帖",-1)),l("div",P,[r(O).token?(T(),s("div",V,[i(A,{src:(null==(t=r(O).userinfo)?void 0:t.avatar)||"https://tse1-mm.cn.bing.net/th/id/OIP-C.gaAkkFf8LStn-oc4l8iM0wAAAA?w=160&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7"},null,8,["src"]),l("span",B,p((null==(k=r(O).userinfo)?void 0:k.username)||"羽球爱好者"),1),l("div",E,[l("div",J,[e[1]||(e[1]=u("发帖数量：",-1)),l("span",null,p(K.value),1)])])])):o("",!0),i(M,{type:"primary",onClick:navigateToPublish},{default:c(()=>[...e[2]||(e[2]=[u("发布新帖",-1)])]),_:1})]),l("div",L,[m((T(),h(X,{data:N.value,style:{width:"100%"},"empty-text":"暂无发帖记录"},{default:c(()=>[i(H,{prop:"title",label:"帖子标题","min-width":"300"},{default:c(a=>[l("div",{class:"post-title",onClick:e=>navigateToDetail(a.row.id)},[a.row.isTop?(T(),h(R,{key:0,class:"top-icon"},{default:c(()=>[i(r(y))]),_:1})):o("",!0),u(" "+p(a.row.title),1)],8,$)]),_:1}),i(H,{prop:"categoryCode",label:"分类",width:"120"},{default:c(a=>{return[i(W,{type:(e=a.row.categoryCode,{team:"success",notice:"primary",help:"warning",exp:"info"}[e]||"default")},{default:c(()=>[u(p(getCategoryName(a.row.categoryCode)),1)]),_:2},1032,["type"])];var e}),_:1}),i(H,{prop:"publishTime",label:"发布时间",width:"180"}),i(H,{label:"回复/查看",width:"120"},{default:c(a=>[l("div",D,[l("div",null,p(a.row.replyCount||0)+" 回复",1),l("div",null,p(a.row.views||0)+" 查看",1)])]),_:1}),i(H,{label:"操作",width:"150"},{default:c(a=>[l("div",F,[i(M,{type:"primary",icon:r(j),circle:"",size:"small",onClick:e=>navigateToDetail(a.row.id),title:"查看详情"},null,8,["icon","onClick"]),i(M,{type:"danger",icon:r(b),circle:"",size:"small",onClick:e=>{return t=a.row,void x.confirm(`确定要删除帖子"${t.title}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await S(t.id),_.success("帖子删除成功"),loadUserPosts()}catch(a){_.error("删除帖子失败")}}).catch(()=>{});var t},title:"删除帖子"},null,8,["icon","onClick"])])]),_:1})]),_:1},8,["data"])),[[Z,Q.value]]),l("div",G,[i(Y,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value=a),"page-size":q.value,total:K.value,"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:handleSizeChange,onCurrentChange:handlePageChange},null,8,["modelValue","page-size","total"])])])])}}},[["__scopeId","data-v-b4ba7672"]]);export{H as default};

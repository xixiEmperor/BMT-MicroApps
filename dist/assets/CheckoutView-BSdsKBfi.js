import{r as s,o as a,E as t,a as c,l as e,k as l,h as o,g as i,w as r,m as n,i as u,x as d,P as p,Q as m,af as v,J as y,A as h}from"./index-RXELqIC3.js";/* empty css                 *//* empty css                        */import{_ as f}from"./_plugin-vue_export-helper-CRLhVpGU.js";import{c as k,a as g,B as _}from"./pay-CUktMawW.js";import{u as j}from"./cart-CpOPODuf.js";const w={key:0,class:"checkout-container"},x={class:"checkout-header"},b={class:"checkout-section"},O={key:0,class:"product-info"},S={class:"product-details"},q={class:"product-name"},N={key:0,class:"product-specs"},V={class:"product-price"},C={class:"product-quantity"},J={class:"product-subtotal"},I={class:"price"},T={key:1},$={class:"product-details"},z={class:"product-name"},A={key:0,class:"product-specs"},B={class:"product-price"},E={class:"product-quantity"},P={class:"product-subtotal"},Q={class:"price"},U={class:"checkout-section"},D={class:"checkout-section order-amount"},F={class:"amount-item"},G={class:"amount-item total"},H={class:"price"},K={class:"checkout-footer"},L={class:"total-payment"},M={class:"price"},R=f({t:"CheckoutView",setup(f){const R=c(),W=j(),X=s(null),Y=s(""),Z=s(!1),ss=()=>{R.push("/cart")},as=async()=>{try{let a;if(Z.value=!0,X.value.isBuyNow){const s={productId:X.value.products[0].productId,quantity:X.value.products[0].quantity,specs:X.value.products[0].specs||{}};a=await k(s)}else a=await g();if(0===a.data.code){const c={orderNo:a.data.data,amount:X.value.totalAmount,businessType:_.MALL,remarks:Y.value};if(localStorage.setItem("payment_info",JSON.stringify(c)),X.value.products)try{await W.removeOrderedItems(X.value)}catch(s){}localStorage.removeItem("checkout_order"),t.success("订单创建成功，即将跳转到支付页面"),setTimeout(()=>{R.push("/payment")},1e3)}else t.error(a.message||"创建订单失败")}catch(s){t.error("创建订单失败，请重试")}finally{Z.value=!1}};return a(()=>{const s=localStorage.getItem("checkout_order");if(s)try{X.value=JSON.parse(s)}catch(a){t.error("获取订单信息失败"),R.push("/cart")}else t.warning("没有待结算的订单"),R.push("/cart")}),(s,a)=>{const t=n,c=u,f=v;return X.value?(y(),e("div",w,[o("div",x,[a[2]||(a[2]=o("h2",null,"订单确认",-1)),i(t,{type:"text",onClick:ss},{default:r(()=>[...a[1]||(a[1]=[h("返回购物车",-1)])]),l:1})]),o("div",b,[a[5]||(a[5]=o("h3",null,"商品信息",-1)),X.value.product?(y(),e("div",O,[i(c,{src:X.value.product.productImage,class:"product-image",fit:"cover"},null,8,["src"]),o("div",S,[o("div",q,d(X.value.product.productName),1),Object.keys(X.value.product.specs||{}).length>0?(y(),e("div",N," 规格："+d(Object.entries(X.value.product.specs).map(([s,a])=>`${a}`).join("、")),1)):l("",!0),o("div",V,"¥"+d((X.value.product.productPrice+X.value.product.priceAdjustment).toFixed(2)),1),o("div",C,"x "+d(X.value.quantity),1)]),o("div",J,[a[3]||(a[3]=o("span",null,"小计：",-1)),o("span",I,"¥"+d(X.value.totalAmount.toFixed(2)),1)])])):l("",!0),X.value.products?(y(),e("div",T,[(y(!0),e(p,null,m(X.value.products,(s,t)=>(y(),e("div",{key:t,class:"product-info"},[i(c,{src:s.productImage,class:"product-image",fit:"cover"},null,8,["src"]),o("div",$,[o("div",z,d(s.productName),1),Object.keys(s.specs||{}).length>0?(y(),e("div",A," 规格："+d(Object.entries(s.specs).map(([s,a])=>`${a}`).join("、")),1)):l("",!0),o("div",B,"¥"+d((s.productPrice+s.priceAdjustment).toFixed(2)),1),o("div",E,"x "+d(s.quantity),1)]),o("div",P,[a[4]||(a[4]=o("span",null,"小计：",-1)),o("span",Q,"¥"+d(((s.productPrice+s.priceAdjustment)*s.quantity).toFixed(2)),1)])]))),128))])):l("",!0)]),o("div",U,[a[6]||(a[6]=o("h3",null,"订单备注",-1)),i(f,{type:"textarea",rows:3,placeholder:"可以告诉我们您的特殊要求（选填）",modelValue:Y.value,"onUpdate:modelValue":a[0]||(a[0]=s=>Y.value=s),maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),o("div",D,[o("div",F,[a[7]||(a[7]=o("span",null,"商品总价：",-1)),o("span",null,"¥"+d(X.value.totalAmount.toFixed(2)),1)]),o("div",G,[a[8]||(a[8]=o("span",null,"应付总额：",-1)),o("span",H,"¥"+d(X.value.totalAmount.toFixed(2)),1)])]),o("div",K,[o("div",L,[a[9]||(a[9]=o("span",null,"应付总额：",-1)),o("span",M,"¥"+d(X.value.totalAmount.toFixed(2)),1)]),i(t,{type:"primary",size:"large",onClick:as,loading:Z.value},{default:r(()=>[h(d(Z.value?"创建订单中...":"提交订单"),1)]),l:1},8,["loading"])])])):l("",!0)}}},[["__scopeId","data-v-5f7ebdac"]]);export{R as default};

import{Y as ie,r as b,K as Ee,o as he,q as y,l as e,M as be,p as X,j as l,w as n,Z as ke,_ as $e,$ as De,f as J,P as ee,Q as te,a0 as He,a1 as Ne,a2 as Me,F as K,B as v,a3 as _e,E as R,a4 as ze,i,a5 as Oe,O as ve,s as me,a6 as Pe,d as ne,L as Te,a7 as we,a8 as ye,b as Re,n as Z,a9 as oe,v as Be,aa as Ye,y as xe,ab as Ie,ac as Ue,ad as Fe,ae as Le,af as Ae,ag as qe,ah as je,ai as We,U as Ze}from"./index-CBwtJ5i4.js";import{c as Ke}from"./venueOrder-BD3RNKbu.js";/* empty css                   *//* empty css               *//* empty css                *//* empty css                         *//* empty css               *//* empty css                  *//* empty css                     */import{_ as pe}from"./_plugin-vue_export-helper-CfPbstfH.js";/* empty css                       *//* empty css                 *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                         */import{f as Qe}from"./format-BoKD-3ja.js";/* empty css                     *//* empty css                 */function Ge(M={}){return ie({url:"/api/reservation/notice",method:"get",params:{pageNum:M.pageNum||1,pageSize:M.pageSize||10,type:M.type||null}})}function Je(M){return ie({url:`/api/reservation/notice/${M}`,method:"get"})}const Xe={class:"notice-list-page"},et={class:"filter-container"},tt={class:"notice-carousel-container"},at={class:"notice-header"},st={class:"notice-title"},lt={class:"notice-meta"},ot={class:"notice-time"},nt={class:"notice-content"},it={class:"notice-footer"},rt={key:1,class:"empty-state"},ut={key:0,class:"notice-grid"},ct={class:"notice-grid-container"},dt=["onClick"],mt={class:"grid-item-header"},pt={class:"grid-item-title"},vt={class:"grid-item-time"},_t={key:1,class:"pagination-container"},gt={class:"notice-detail"},ft={class:"detail-meta"},yt={class:"detail-time"},ht={class:"detail-content"},bt={__name:"NoticeList",setup(M){const Q=b(null),z=b(!1),d=b(1),q=b(5),U=b(0),D=b([]),h=b(!1),C=Ee({id:"",title:"",content:"",type:1,publishTime:""}),V=c=>({1:"",2:"warning"})[c]||"",k=c=>({1:"普通通知",2:"重要通知"})[c]||"未知",u=c=>Qe(c,"YYYY-MM-DD HH:mm"),p=(c,m=100)=>c?c.length>m?c.substring(0,m)+"...":c:"",f=async()=>{try{z.value=!0;const c=await Ge({pageNum:d.value,pageSize:q.value,type:Q.value});c.data.code===0?(D.value=c.data.data.list,U.value=c.data.data.total):R.error(c.data.msg||"获取通知列表失败")}catch(c){console.error("获取通知列表失败:",c),R.error("获取通知列表失败")}finally{z.value=!1}},a=()=>{d.value=1,f()},T=c=>{d.value=c,f()},j=c=>{q.value=c,d.value=1,f()},F=async c=>{try{const m=await Je(c.id);if(m.data.code===0){const O=m.data.data;Object.assign(C,O),h.value=!0}else R.error(m.data.msg||"获取通知详情失败")}catch(m){console.error("获取通知详情失败:",m),R.error("获取通知详情失败")}};return he(()=>{f()}),(c,m)=>{const O=ke,_=$e,o=Me,g=me,P=Oe,H=ze,A=He,S=Ne,B=_e,re=De;return i(),y("div",Xe,[m[4]||(m[4]=e("h2",{class:"page-title"},"通知公告",-1)),e("div",et,[l(_,{modelValue:Q.value,"onUpdate:modelValue":m[0]||(m[0]=$=>Q.value=$),placeholder:"选择通知类型",clearable:"",onChange:a},{default:n(()=>[l(O,{label:"全部通知",value:null}),l(O,{label:"普通通知",value:1}),l(O,{label:"重要通知",value:2})]),_:1},8,["modelValue"])]),be((i(),y("div",tt,[D.value.length>0?(i(),J(H,{key:0,height:"300px",autoplay:!0,interval:5e3,"indicator-position":"outside",arrow:"hover",type:"card"},{default:n(()=>[(i(!0),y(ee,null,te(D.value,$=>(i(),J(P,{key:$.id,onClick:ue=>F($)},{default:n(()=>[e("div",{class:ve(["notice-card",{important:$.type===2}])},[e("div",at,[e("h3",st,v($.title),1),e("div",lt,[l(o,{type:V($.type),size:"small"},{default:n(()=>[K(v(k($.type)),1)]),_:2},1032,["type"]),e("span",ot,v(u($.publishTime)),1)])]),e("div",nt,v(p($.content,200)),1),e("div",it,[l(g,{type:"primary",size:"small",onClick:Pe(ue=>F($),["stop"])},{default:n(()=>m[2]||(m[2]=[K(" 查看详情 ")])),_:2},1032,["onClick"])])],2)]),_:2},1032,["onClick"]))),128))]),_:1})):X("",!0),!z.value&&D.value.length===0?(i(),y("div",rt,[l(A,{description:"暂无通知"})])):X("",!0)])),[[re,z.value]]),D.value.length>0?(i(),y("div",ut,[m[3]||(m[3]=e("h3",{class:"grid-title"},"所有通知",-1)),e("div",ct,[(i(!0),y(ee,null,te(D.value,$=>(i(),y("div",{key:`grid-${$.id}`,class:ve(["notice-grid-item",{important:$.type===2}]),onClick:ue=>F($)},[e("div",mt,[e("span",pt,v($.title),1),l(o,{type:V($.type),size:"small"},{default:n(()=>[K(v(k($.type)),1)]),_:2},1032,["type"])]),e("div",vt,v(u($.publishTime)),1)],10,dt))),128))])])):X("",!0),U.value>0?(i(),y("div",_t,[l(S,{background:"","hide-on-single-page":!1,layout:"total, sizes, prev, pager, next",total:U.value,"page-size":q.value,"page-sizes":[5,8,10],"current-page":d.value,onCurrentChange:T,onSizeChange:j},null,8,["total","page-size","current-page"])])):X("",!0),l(B,{modelValue:h.value,"onUpdate:modelValue":m[1]||(m[1]=$=>h.value=$),title:C.title,width:"60%"},{default:n(()=>[e("div",gt,[e("div",ft,[l(o,{type:V(C.type)},{default:n(()=>[K(v(k(C.type)),1)]),_:1},8,["type"]),e("span",yt,"发布时间："+v(u(C.publishTime)),1)]),e("div",ht,v(C.content),1)])]),_:1},8,["modelValue","title"])])}}},kt=pe(bt,[["__scopeId","data-v-8775d99f"]]);function $t(){return ie({url:"/api/venue/list",method:"get"})}function Dt(M){return ie({url:"/api/venue/status-matrix",method:"get",params:M})}function Tt(M){return ie({url:"/api/venue/availability",method:"get",params:M})}const wt={class:"matrix-container"},xt={class:"date-selector"},Ct={class:"date-info"},Vt={key:0,class:"workday-info"},St={key:1,class:"weekend-info"},Et={class:"legend"},Ht={class:"legend-text"},Nt={class:"matrix-table"},Mt={class:"status-matrix"},zt={class:"venue-name"},Ot=["onClick","title"],Pt={class:"dialog-footer"},Rt={__name:"VenueStatusMatrix",props:{visible:{type:Boolean,default:!1}},emits:["close"],setup(M,{emit:Q}){const z=M,d=ne({get:()=>z.visible});Te(()=>z.visible,_=>{_&&a()},{immediate:!0});const q=Q,U=()=>{q("close")},D=b(!1),h=b({}),C=b(new Date),V=b([]),k=b([]),u={1:"#67c23a",2:"#909399",3:"#f56c6c",4:"#e6a23c"},p={1:"空闲中",2:"使用中",3:"已预约",4:"不开放"},f=_=>{const o=_.getFullYear(),g=String(_.getMonth()+1).padStart(2,"0"),P=String(_.getDate()).padStart(2,"0");return`${o}-${g}-${P}`},a=async()=>{if(z.visible){D.value=!0;try{const _=f(C.value),o=await Dt({date:_});o.data.code===0&&(h.value=o.data.data.statusMatrix||{},k.value=o.data.data.venues||[],V.value=o.data.data.timeSlots||[])}catch(_){console.error("获取场地状态矩阵失败:",_),R.error("获取场地状态矩阵失败")}finally{D.value=!1}}},T=_=>{const o=_.getDay();return o>=1&&o<=5},j=_=>{const o=new Date;o.setHours(0,0,0,0);const g=new Date(o);g.setDate(g.getDate()+1);const P=new Date(_);return P.setHours(0,0,0,0),!(P.getTime()===o.getTime()||P.getTime()===g.getTime())},F=(_,o)=>{const g=h.value[_];return!g||!g[o]?1:g[o].status},c=(_,o)=>{const g=F(_,o);return{backgroundColor:u[g],color:"#fff",textAlign:"center",padding:"8px 4px",fontSize:"12px",cursor:"pointer",transition:"all 0.3s"}},m=(_,o)=>{const g=h.value[_.id];if(!g||!g[o])return;const P=g[o],H=P.status;let A="";H!==1?A=`${_.name} ${o} - ${p[H]} - ${P.reason}`:A=`${_.name} ${o} - ${p[H]}`,H===1?R.success(A):H===2?R.warning(A):H===3?R.error(A):H===4&&R.warning(A)},O=()=>{a()};return(_,o)=>{const g=we,P=me,H=_e,A=De;return i(),J(H,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=S=>d.value=S),title:"场地使用情况表",width:"90%","close-on-click-modal":!1,onClose:U,class:"venue-matrix-dialog"},{footer:n(()=>[e("div",Pt,[l(P,{onClick:U},{default:n(()=>o[4]||(o[4]=[K("关闭")])),_:1}),l(P,{type:"primary",onClick:a},{default:n(()=>o[5]||(o[5]=[K("刷新数据")])),_:1})])]),default:n(()=>[e("div",wt,[e("div",xt,[l(g,{modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=S=>C.value=S),type:"date",placeholder:"选择查询日期",format:"YYYY年MM月DD日",onChange:O,"disabled-date":j},null,8,["modelValue"]),e("div",Ct,[T(C.value)?(i(),y("span",Vt," 工作日：白天场地用于校内上课，仅晚上18:00-21:00开放预约 ")):(i(),y("span",St," 周末：全天开放预约，时间为8:00-21:00 "))])]),e("div",Et,[(i(),y(ee,null,te(u,(S,B)=>e("div",{class:"legend-item",key:B},[e("div",{class:"legend-color",style:ye({backgroundColor:S})},null,4),e("span",Ht,v(p[B]),1)])),64))]),be((i(),y("div",Nt,[e("table",Mt,[e("thead",null,[e("tr",null,[o[2]||(o[2]=e("th",{class:"venue-header"},"场地/时间",-1)),(i(!0),y(ee,null,te(V.value,S=>(i(),y("th",{key:S,class:"time-header"},v(S),1))),128))])]),e("tbody",null,[(i(!0),y(ee,null,te(k.value,S=>(i(),y("tr",{key:S.id},[e("td",zt,v(S.name),1),(i(!0),y(ee,null,te(V.value,B=>(i(),y("td",{key:B,class:"status-cell",style:ye(c(S.id,B)),onClick:re=>m(S,B),title:`${S.name} ${B} - ${p[F(S.id,B)]}`},v(p[F(S.id,B)]),13,Ot))),128))]))),128))])])])),[[A,D.value]]),o[3]||(o[3]=e("div",{class:"matrix-info"},[e("p",null,[e("strong",null,"使用说明：")]),e("ul",null,[e("li",null,"点击单元格可查看详细信息"),e("li",null,"绿色表示可预约，红色表示已预约，橙色表示维护中，灰色表示不开放"),e("li",null,"工作日白天时间段场地用于校内上课，不对外开放"),e("li",null,"周末全天开放预约")])],-1))])]),_:1},8,["modelValue"])}}},Bt=pe(Rt,[["__scopeId","data-v-64f68edf"]]),Yt={class:"create-order-form"},It={class:"form-header"},Ut={class:"form-title"},Ft={class:"form-section venue-section"},Lt={class:"section-header"},At={key:0,class:"venue-card"},qt={class:"venue-info"},jt={class:"venue-name"},Wt={class:"venue-description"},Zt={class:"venue-price"},Kt={class:"price-value"},Qt={class:"form-section time-section"},Gt={class:"section-header"},Jt={class:"time-display-grid"},Xt={class:"time-display-item"},ea={class:"time-value"},ta={class:"time-display-item"},aa={class:"time-value"},sa={class:"time-display-item"},la={class:"time-value"},oa={key:0,class:"booking-summary"},na={class:"summary-item"},ia={class:"summary-value"},ra={class:"summary-item total-price"},ua={class:"summary-value price"},ca={class:"price-note"},da={class:"form-section contact-section"},ma={class:"section-header"},pa={class:"contact-form-grid"},va={class:"form-section notice-section"},_a={class:"section-header"},ga={class:"notice-content"},fa={class:"form-actions"},ya={__name:"CreateOrderForm",props:{selectedVenue:{type:Object,default:()=>({})},reservationDate:{type:String,default:""},startTime:{type:String,default:""},endTime:{type:String,default:""}},emits:["cancel"],setup(M,{emit:Q}){const z=Re(),d=M,q=Q,U=b(null),D=b(!1),h=b({venueId:"",contactName:"",contactPhone:"",remark:""}),C={venueId:[{required:!0,message:"请选择场地",trigger:"change"}],contactName:[{required:!0,message:"请输入联系人姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度在2-20个字符",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5a-zA-Z\s]+$/,message:"姓名只能包含中文、英文和空格",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],remark:[{max:200,message:"备注不能超过200个字符",trigger:"blur"}]},V=ne(()=>{if(!d.startTime||!d.endTime)return 0;const[f]=d.startTime.split(":").map(Number),[a]=d.endTime.split(":").map(Number);return a-f}),k=ne(()=>{var a;const f=((a=d.selectedVenue)==null?void 0:a.price)||30;return Math.ceil(V.value)*f});Te(()=>d.selectedVenue,f=>{f!=null&&f.id&&(console.log(f),h.value.venueId=f.id)},{immediate:!0});const u=async()=>{if(!U.value)return!1;try{await U.value.validate();const f={venueId:d.selectedVenue.id,reservationDate:d.reservationDate,startTime:d.startTime,endTime:d.endTime,remark:h.value.contactName+" "+h.value.contactPhone+" "+h.value.remark};D.value=!0;try{R.info("正在创建订单...");const a=await Ke(f);if(a.data.code===0)z.push({path:"/payment",query:{orderNo:a.data.data.orderNo},state:{orderDetail:{id:a.data.data.id,venueName:d.selectedVenue.name,venueId:d.selectedVenue.id,reservationDate:f.reservationDate,startTime:f.startTime,endTime:f.endTime,duration:V.value,contactName:h.value.contactName,contactPhone:h.value.contactPhone,remark:a.data.data.remark,payTypeDesc:a.data.data.payTypeDesc,pricePerHour:a.data.data.pricePerHour||30,totalAmount:a.data.data.totalAmount}}});else return R.error(a.data.message||"创建订单失败"),!1}catch(a){return console.error("创建订单失败:",a),R.error("创建订单失败，请重试"),!1}finally{D.value=!1}}catch(f){return console.error("表单验证失败:",f),!1}},p=()=>{q("cancel")};return(f,a)=>{const T=Be,j=Fe,F=Ue,c=Le,m=me,O=Ae;return i(),y("div",Yt,[e("div",It,[e("h3",Ut,[l(T,null,{default:n(()=>[l(Z(oe))]),_:1}),a[3]||(a[3]=K(" 创建预约订单 "))]),a[4]||(a[4]=e("p",{class:"form-subtitle"},"请填写完整的预约信息，确保信息准确无误",-1))]),l(O,{ref_key:"formRef",ref:U,model:h.value,rules:C,"label-width":"100px",class:"order-form",size:"large"},{default:n(()=>{var _,o;return[e("div",Ft,[e("div",Lt,[l(T,{class:"section-icon"},{default:n(()=>[l(Z(Ye))]),_:1}),a[5]||(a[5]=e("h4",{class:"section-title"},"场地信息",-1))]),(_=d.selectedVenue)!=null&&_.id?(i(),y("div",At,[e("div",qt,[e("h5",jt,v(d.selectedVenue.name),1),e("p",Wt,v(d.selectedVenue.description||"标准羽毛球场地，配备专业羽毛球网和照明设备"),1),e("div",Zt,[a[6]||(a[6]=e("span",{class:"price-label"},"价格：",-1)),e("span",Kt,v(d.selectedVenue.price||30)+"元/小时",1)])])])):X("",!0)]),e("div",Qt,[e("div",Gt,[l(T,{class:"section-icon"},{default:n(()=>[l(Z(xe))]),_:1}),a[7]||(a[7]=e("h4",{class:"section-title"},"预约时间",-1))]),e("div",Jt,[e("div",Xt,[a[8]||(a[8]=e("span",{class:"time-label"},"预约日期",-1)),e("div",ea,v(d.reservationDate||"未选择"),1)]),e("div",ta,[a[9]||(a[9]=e("span",{class:"time-label"},"开始时间",-1)),e("div",aa,v(d.startTime||"未选择"),1)]),e("div",sa,[a[10]||(a[10]=e("span",{class:"time-label"},"结束时间",-1)),e("div",la,v(d.endTime||"未选择"),1)])]),V.value>0?(i(),y("div",oa,[e("div",na,[l(T,null,{default:n(()=>[l(Z(Ie))]),_:1}),a[11]||(a[11]=e("span",{class:"summary-label"},"预约时长：",-1)),e("span",ia,v(V.value)+"小时",1)]),e("div",ra,[l(T,null,{default:n(()=>[l(Z(oe))]),_:1}),a[12]||(a[12]=e("span",{class:"summary-label"},"预计费用：",-1)),e("span",ua,"¥"+v(k.value),1)]),e("div",ca," （按"+v(((o=d.selectedVenue)==null?void 0:o.price)||30)+"元/小时计算，不足1小时按1小时计费） ",1)])):X("",!0)]),e("div",da,[e("div",ma,[l(T,{class:"section-icon"},{default:n(()=>[l(Z(oe))]),_:1}),a[13]||(a[13]=e("h4",{class:"section-title"},"联系人信息",-1))]),e("div",pa,[l(F,{label:"联系人姓名",prop:"contactName"},{default:n(()=>[l(j,{modelValue:h.value.contactName,"onUpdate:modelValue":a[0]||(a[0]=g=>h.value.contactName=g),placeholder:"请输入联系人姓名",disabled:D.value,clearable:"",size:"large"},{prefix:n(()=>[l(T,null,{default:n(()=>[l(Z(oe))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(F,{label:"联系电话",prop:"contactPhone"},{default:n(()=>[l(j,{modelValue:h.value.contactPhone,"onUpdate:modelValue":a[1]||(a[1]=g=>h.value.contactPhone=g),placeholder:"请输入手机号码",disabled:D.value,clearable:"",size:"large",maxlength:"11"},{prefix:n(()=>[l(T,null,{default:n(()=>[l(Z(oe))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),l(F,{label:"备注信息",prop:"remark"},{default:n(()=>[l(j,{modelValue:h.value.remark,"onUpdate:modelValue":a[2]||(a[2]=g=>h.value.remark=g),type:"textarea",placeholder:"请输入备注信息（选填）",disabled:D.value,rows:3,maxlength:"200","show-word-limit":"",resize:"none"},null,8,["modelValue","disabled"])]),_:1})]),e("div",va,[e("div",_a,[l(T,{class:"section-icon"},{default:n(()=>[l(Z(oe))]),_:1}),a[14]||(a[14]=e("h4",{class:"section-title"},"预约须知",-1))]),e("div",ga,[l(c,{title:"重要提醒",type:"warning",closable:!1,"show-icon":""},{default:n(()=>a[15]||(a[15]=[e("ul",{class:"notice-list"},[e("li",null,"请确保预约信息准确无误，提交后不可修改"),e("li",null,"如需取消预约，请至少提前半小时联系管理员"),e("li",null,"请爱护场地设施，如有损坏需要赔偿"),e("li",null,"场地内禁止吸烟，请保持环境整洁")],-1)])),_:1})])]),e("div",fa,[l(m,{size:"large",disabled:D.value,onClick:p},{default:n(()=>a[16]||(a[16]=[K(" 取消 ")])),_:1},8,["disabled"]),l(m,{type:"primary",size:"large",loading:D.value,onClick:u},{default:n(()=>[K(v(D.value?"创建中...":"确认预约"),1)]),_:1},8,["loading"])])]}),_:1},8,["model"])])}}},ha=pe(ya,[["__scopeId","data-v-3d5b6ff2"]]),ba={class:"booking-container"},ka={class:"booking-tools"},$a={class:"date-time-selector"},Da={class:"selector-group"},Ta={class:"matrix-button-container"},wa={class:"date-status"},xa={class:"status-text"},Ca={key:0,class:"selector-group time-selector"},Va={class:"time-picker-container"},Sa={class:"time-picker"},Ea={class:"time-picker"},Ha={class:"courts-container"},Na={key:0,class:"loading-container"},Ma={class:"court-info"},za={class:"court-name"},Oa={class:"court-status"},Pa={class:"court-description"},Ra={class:"court-price"},Ba={__name:"BookingView",setup(M){const Q=s=>{const t=s.getFullYear(),w=String(s.getMonth()+1).padStart(2,"0"),x=String(s.getDate()).padStart(2,"0");return`${t}-${w}-${x}`},z=s=>{const t=s.getDay();return t>=1&&t<=5},d=s=>{const t=s.getDay();return t===0||t===6},q=(s,t)=>{const w=new Date,x=new Date;x.setHours(0,0,0,0);const E=new Date(x);E.setDate(E.getDate()+1);const Y=new Date(s);if(Y.setHours(0,0,0,0),Y.getTime()===x.getTime()){const[L,W]=t.split(":").map(Number),N=new Date;return N.setHours(L,W,0,0),w.getTime()<N.getTime()}return Y.getTime()===E.getTime()?w.getHours()>=18:!1},U=s=>{const t=new Date,w=new Date;w.setHours(0,0,0,0);const x=new Date(w);x.setDate(x.getDate()+1);const E=new Date(s);return E.setHours(0,0,0,0),E.getTime()===x.getTime()&&t.getHours()<18?"不在可预约时间（明天场地需今天18:00后预约）":null},D=s=>z(s)?["18:00-21:00"]:d(s)?["8:00-21:00"]:[],h=s=>{const t=D(s);if(t.length===0)return{startOptions:[],endOptions:[]};const w=[],x=[],E=t[0],[Y,L]=E.split("-"),[W,N]=Y.split(":").map(Number),[I,G]=L.split(":").map(Number);let se=W,r=N,ae=I-1,le=G;for(le<r&&(ae-=1,le+=60);se<ae||se===ae&&r<=le;){const de=`${se.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`;q(s,de)&&w.push(de),se+=1}let ce=W+1,fe=N;for(;ce<I||ce===I&&fe<=G;){const de=`${ce.toString().padStart(2,"0")}:${fe.toString().padStart(2,"0")}`;x.push(de),ce+=1}const Ve=[...new Set(w)].sort(),Se=[...new Set(x)].sort();return{startOptions:Ve,endOptions:Se}},C=ne(()=>h(k.value).startOptions||[]),V=ne(()=>{const s=h(k.value);if(!u.value||s.endOptions.length===0)return[];const[t,w]=u.value.split(":").map(Number),E=`${(t+3).toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`;return s.endOptions.filter(Y=>Y<=E&&Y>u.value)}),k=b(new Date),u=b("18:00"),p=b("19:00");z(k.value)?(u.value="18:00",p.value="21:00"):(u.value="8:00",p.value="21:00");const f=async s=>{C.value.length>0?(u.value=C.value[0],V.value.length>0&&(p.value=V.value[0])):(u.value="",p.value=""),u.value&&p.value&&u.value<p.value&&await c(s,u.value,p.value)},a=s=>{let t="";z(s)?t="工作日（仅晚上18:00-21:00开放）":d(s)&&(t="周末（全天开放8:00-21:00）");const w=U(s);return w&&(t+=` - ${w}`),t},T=b([]),j=b(!1),F=async()=>{j.value=!0;try{const s=await $t();s.data.code===0?T.value=s.data.data.map(t=>({id:t.id,name:t.name,description:t.description,price:t.pricePerHour||20,status:t.status,bookable:!1,availabilityReason:"请选择时间段",location:t.location})):R.error(s.message||"获取场地列表失败")}catch(s){console.error("获取场地列表失败:",s),R.error("获取场地列表失败，请稍后重试")}finally{j.value=!1}},c=async(s,t,w)=>{try{const x=U(s);if(x||!q(s,t)){T.value.forEach(L=>{L.bookable=!1,L.availabilityReason=x||"不在可预约时间"});return}const E=Q(s),Y=await Tt({date:E,startTime:t,endTime:w});if(Y.data.code===0){const{availableVenues:L,unavailableVenues:W}=Y.data.data;T.value.forEach(N=>{N.bookable=!1,N.availabilityReason="未知状态"}),L&&L.length>0&&L.forEach(N=>{const I=T.value.find(G=>G.id===N.id);I&&(I.bookable=!0,I.availabilityReason="可预约",N.pricePerHour!==void 0&&(I.price=N.pricePerHour))}),W&&W.length>0&&W.forEach(N=>{const I=T.value.find(G=>G.id===N.id);I&&(I.bookable=!1,I.availabilityReason=N.reason||"不可预约")})}}catch(x){console.error("检查场地可用性失败:",x),T.value.forEach(E=>{E.bookable=!1,E.availabilityReason="检查失败"})}};he(async()=>{await F(),await f(k.value),await ge(u.value)});const m=b(!1),O=b(null),_=b(null),o=s=>{O.value=s,m.value=!0},g=()=>{m.value=!1,O.value=null},P=()=>{g()},H=b(!1),A=()=>{H.value=!1},S=()=>{H.value=!0},B=s=>!s.bookable||!u.value||!p.value?!1:q(k.value,u.value),re=s=>s.bookable?"status-available":s.availabilityReason&&s.availabilityReason!=="请选择时间段"?"status-booked":"status-closed",$=s=>s.bookable?"可预约":s.availabilityReason||"状态未知",ue=async()=>{g(),R.success("预约成功！"),u.value&&p.value&&await c(k.value,u.value,p.value)},ge=async s=>{if(C.value.length===0)return;s>=p.value&&(p.value=V.value[0]);const t=p.value.split(":").map(Number)[0],w=s.split(":").map(Number)[0];t-w>3&&(p.value=V.value[V.value.length-1]),p.value&&await c(k.value,s,p.value)},Ce=async s=>{if(s<=u.value)if(z(k.value)){const t=V.value.indexOf(s);u.value=C.value[t]}else u.value="18:00";u.value&&await c(k.value,u.value,s)};return(s,t)=>{var se;const w=we,x=me,E=ke,Y=$e,L=qe,W=Ze,N=We,I=je,G=_e;return i(),y("div",ba,[t[12]||(t[12]=e("div",{class:"page-header"},[e("h2",null,"场地预约")],-1)),l(kt),e("div",ka,[e("div",$a,[e("div",Da,[t[5]||(t[5]=e("p",null,"选择日期：",-1)),l(w,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=r=>k.value=r),type:"date",placeholder:"选择预约日期","disabled-date":r=>{const ae=new Date;ae.setHours(0,0,0,0);const le=new Date(ae);return le.setDate(le.getDate()+1),!(r.toDateString()===ae.toDateString()||r.toDateString()===le.toDateString())},format:"YYYY年MM月DD日",onChange:f},null,8,["modelValue","disabled-date"])]),e("div",Ta,[l(x,{type:"primary",icon:Z(xe),onClick:S,class:"matrix-button-enhanced",size:"large"},{default:n(()=>t[6]||(t[6]=[e("span",{class:"button-text"},"查看场地使用情况表",-1),e("span",{class:"button-subtitle"},"实时查看所有场地状态",-1)])),_:1},8,["icon"])]),e("div",wa,[e("span",xa,v(a(k.value)),1)]),C.value.length>0?(i(),y("div",Ca,[t[8]||(t[8]=e("p",null,"时间段：",-1)),e("div",Va,[e("div",Sa,[l(Y,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=r=>u.value=r),placeholder:"开始时间",onChange:ge,class:"time-select"},{default:n(()=>[(i(!0),y(ee,null,te(C.value,r=>(i(),J(E,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t[7]||(t[7]=e("span",{class:"time-separator"},"至",-1)),e("div",Ea,[l(Y,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=r=>p.value=r),placeholder:"结束时间",onChange:Ce,class:"time-select"},{default:n(()=>[(i(!0),y(ee,null,te(V.value,r=>(i(),J(E,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])])):X("",!0)]),t[9]||(t[9]=e("div",{class:"booking-rules"},[e("p",null,[e("strong",null,"预约规则：")]),e("ul",null,[e("li",null,"工作日（周一至周五）：白天场地用于校内上课，仅晚上18:00-21:00开放预约"),e("li",null,"周末（周六、周日）：全天开放预约，时间为8:00-21:00"),e("li",null,"预约时长为1-3小时，每小时20元，时间选择步长为1小时"),e("li",null,"一人一天只能预约一次，如果当天已预约则无法再次预约"),e("li",null,"只能预约今天和明天的场地"),e("li",null,"今天场地：只要在开始时间之前都可以预约（如果有剩余）"),e("li",null,"明天场地：今天18:00之后才能开始预约")])],-1))]),e("div",Ha,[t[11]||(t[11]=e("h3",null,"场地状态",-1)),j.value?(i(),y("div",Na,[l(L,{rows:3,animated:""}),t[10]||(t[10]=e("p",{class:"loading-text"},"正在加载场地信息...",-1))])):(i(),J(I,{key:1,gutter:20},{default:n(()=>[(i(!0),y(ee,null,te(T.value,r=>(i(),J(N,{xs:24,sm:12,md:8,key:r.id},{default:n(()=>[l(W,{class:ve(["court-card",re(r)])},{default:n(()=>[e("div",Ma,[e("div",za,v(r.name),1),e("div",Oa,v($(r)),1),e("div",Pa,v(r.description),1),e("div",Ra,"¥"+v(r.price)+"/小时",1),l(x,{type:"primary",disabled:!B(r),onClick:ae=>o(r),class:"book-button"},{default:n(()=>[K(v(B(r)?"立即预约":"暂不可预约"),1)]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}))]),l(G,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=r=>m.value=r),title:`预约 ${(se=O.value)==null?void 0:se.name}`,width:"600px",onClose:g},{default:n(()=>[O.value?(i(),J(ha,{key:0,ref_key:"createOrderFormRef",ref:_,court:O.value,date:k.value,"start-time":u.value,"end-time":p.value,onSuccess:ue,onCancel:P},null,8,["court","date","start-time","end-time"])):X("",!0)]),_:1},8,["modelValue","title"]),l(G,{modelValue:H.value,"onUpdate:modelValue":t[4]||(t[4]=r=>H.value=r),title:"场地使用情况表",width:"90%",onClose:A},{default:n(()=>[H.value?(i(),J(Bt,{key:0,"current-date":k.value,"start-time":u.value,"end-time":p.value},null,8,["current-date","start-time","end-time"])):X("",!0)]),_:1},8,["modelValue"])])}}},ls=pe(Ba,[["__scopeId","data-v-7de6964d"]]);export{ls as default};

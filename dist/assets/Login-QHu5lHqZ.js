import{c as e,a as t,u as a,i as r}from"./index-BuScbc3L.js";/* empty css               *//* empty css                     */import{_ as o}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                 */import{E as n,r as s,w as i,N as l,y as u,M as p,A as d,B as c,az as f,aw as m,at as w,K as g,au as h,u as y,T as v,b3 as _,b4 as b,O as T,Y as x,b5 as k,a6 as E,ay as V,x as H,z as P}from"./element-plus-D8DMz00a.js";function sleep(e){return new Promise(t=>setTimeout(t,e))}async function withRetry(e,t={}){const a=function(e={}){const{retries:t=3,baseMs:a=1e3,capMs:r=3e4,strategy:o="exponential",jitter:n=!0,shouldRetry:s}=e,computeDelay=e=>{let t;t="fixed"===o?a:"linear"===o?a*(e+1):a*Math.pow(2,e);const s=Math.min(t,r);return n?Math.floor(Math.random()*s):s},defaultShouldRetry=(e,a)=>a<t;return async function(e){const a=t+1;let r;for(let n=0;n<a;n++)try{return await e()}catch(o){if(r=o,!(s??defaultShouldRetry)(o,n)||n>=t)throw o;const e=computeDelay(n);await sleep(e)}throw r}}(t);return a(e)}var C=null,R=[],$=!0,j=new Map;function stableStringify(e){if(null===e||"object"!=typeof e)return JSON.stringify(e);if(Array.isArray(e))return`[${e.map(stableStringify).join(",")}]`;return`{${Object.entries(e).sort(([e],[t])=>e<t?-1:e>t?1:0).map(([e,t])=>`${JSON.stringify(e)}:${stableStringify(t)}`).join(",")}}`}var z={get:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},post:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},put:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},delete:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},patch:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},head:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},options:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")}};const q=t();let U=!1;!function(t){const{baseURL:a,plugins:r=[],retry:o={retries:1},requestDedup:n=!0,timeout:s=1e4}=t;(C=e.create({baseURL:a,timeout:s})).interceptors.request.use(e=>(e.__startTime=Date.now(),e)),C.interceptors.response.use(e=>{const t=e.config.__startTime;return e.duration="number"==typeof t?Date.now()-t:0,e},e=>{if(e&&e.config){const t=e.config.__startTime;e.response&&(e.response.duration="number"==typeof t?Date.now()-t:0)}return Promise.reject(e)}),R=r,$=n;const makeRequest=async(e,t,a,r)=>{if(!C)throw new Error("Axios instance not initialized");const n={...r??{},method:e,url:t,data:a},s=await async function(e){let t=e;for(const a of R)a.onRequest&&(t=await a.onRequest(t));return t}(n),exec=async()=>{try{const e=await C.request(s);return await async function(e){let t=e;for(const a of R)a.onResponse&&(t=await a.onResponse(t));return t&&"data"in t?t.data:t}(e)}catch(e){let t=e;try{await async function(e){for(const t of R)t.onError&&await t.onError(e);throw e}(t)}catch{}throw t}},execWithRetry=()=>withRetry(exec,{...o??{},...(null==r?void 0:r.retryConfig)??{}});if(((null==r?void 0:r.enableDedup)??!0)&&$&&s.method&&s.url){const e=function(e,t,a,r){const o=(null==a?void 0:a.params)?stableStringify(a.params):"",n=void 0!==r?stableStringify(r):"";return`${e.toUpperCase()} ${t}?${o} body:${n}`}(s.method,s.url,s,s.data);if(j.has(e))return j.get(e);const t=execWithRetry().finally(()=>j.delete(e));return j.set(e,t),t}return execWithRetry()},i={get:(e,t)=>makeRequest("GET",e,void 0,t),delete:(e,t)=>makeRequest("DELETE",e,void 0,t),head:(e,t)=>makeRequest("HEAD",e,void 0,t),options:(e,t)=>makeRequest("OPTIONS",e,void 0,t),post:(e,t,a)=>makeRequest("POST",e,t,a),put:(e,t,a)=>makeRequest("PUT",e,t,a),patch:(e,t,a)=>makeRequest("PATCH",e,t,a)};z.get=i.get,z.post=i.post,z.put=i.put,z.delete=i.delete,z.patch=i.patch,z.head=i.head,z.options=i.options}({baseURL:"http://8.162.3.209:8080",timeout:1e4,plugins:[function(e={}){const{getToken:t=()=>null,refreshToken:a,onTokenExpired:r,tokenHeader:o="Authorization",tokenPrefix:n="Bearer "}=e;return{name:"auth",async onRequest(e){const a=await t();return a&&(e.headers=e.headers??{},e.headers[o]=`${n}${a}`),e},async onError(e){if(e&&401===e.status)try{await(null==r?void 0:r())}catch{}throw e}}}({getToken:()=>localStorage.getItem("token"),onTokenExpired:()=>{if(U)return;U=!0;if(a().userinfo.token){n.warning("登录已过期，请重新登录");a().logout()}else n.warning("请先登录");const e=q.currentRoute.value.fullPath;"/login"!==e&&q.push({path:"/login",query:{redirect:e}}),setTimeout(()=>{U=!1},1e3)}})]});const S={name:"LoginView"},M=o(Object.assign(S,{setup(e){const o=a(),C=t(),R=s(!1),$=s({username:"",password:"",email:""}),j=s(!1),q=s(0),U={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:10,message:"请输入5-10位用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^\S{6,15}$/,message:"请输入6-15位非空密码",trigger:"blur"}],repassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(e,t,a)=>{t!==$.value.password?a(new Error("请输入相同的密码")):a()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}]},S=s();i(R,()=>{$.value={username:"",password:"",repassword:"",email:""},j.value=!1,q.value=0});const register=async()=>{await S.value.validate();const e=await(t=$.value,r({url:"/api/auth/register",method:"post",data:t}));var t;0===e.data.code?(n.success("注册成功"),R.value=!1):n.error(e.data.msg||"注册失败")},login=async()=>{var e,t,a,r;await S.value.validate();try{const t=await(r=$.value,z.post("/api/auth/login",r));if(0===t.code){n.success("登录成功");const a=t.data.token;o.setToken(a),await o.getUserinfo();const r=C.currentRoute.value.query.redirect||"/";if("ROLE_ADMIN"===(null==(e=o.userinfo)?void 0:e.role)){const e=r.startsWith("/admin")?r:"/admin";C.push(e)}else C.push(r)}else n.error(t.message)}catch(s){n.error(`登录失败: ${(null==(a=null==(t=s.response)?void 0:t.data)?void 0:a.message)||s.message||"未知错误"}`)}};return(e,t)=>{const a=H("router-view"),r=f,o=w,n=h,s=T,i=k,C=m,j=V;return P(),l(E,null,["/login"!==e.$route.path?(P(),u(a,{key:0})):p("",!0),"/login"===e.$route.path?(P(),u(j,{key:1,class:"login-page"},{default:d(()=>[c(r,{span:12,class:"bg"}),c(r,{span:6,offset:3,class:"form"},{default:d(()=>[R.value?(P(),u(C,{key:0,model:$.value,rules:U,ref_key:"form",ref:S,size:"large",autocomplete:"off"},{default:d(()=>[c(o,null,{default:d(()=>[...t[8]||(t[8]=[g("h1",null,"注册",-1)])]),_:1}),c(o,{prop:"username"},{default:d(()=>[c(n,{modelValue:$.value.username,"onUpdate:modelValue":t[0]||(t[0]=e=>$.value.username=e),"prefix-icon":y(v),placeholder:"请输入用户名"},null,8,["modelValue","prefix-icon"])]),_:1}),c(o,{prop:"password"},{default:d(()=>[c(n,{modelValue:$.value.password,"onUpdate:modelValue":t[1]||(t[1]=e=>$.value.password=e),"prefix-icon":y(_),type:"password",placeholder:"请输入密码"},null,8,["modelValue","prefix-icon"])]),_:1}),c(o,{prop:"repassword"},{default:d(()=>[c(n,{modelValue:$.value.repassword,"onUpdate:modelValue":t[2]||(t[2]=e=>$.value.repassword=e),"prefix-icon":y(_),type:"password",placeholder:"请输入再次密码"},null,8,["modelValue","prefix-icon"])]),_:1}),c(o,{prop:"email"},{default:d(()=>[c(n,{modelValue:$.value.email,"onUpdate:modelValue":t[3]||(t[3]=e=>$.value.email=e),"prefix-icon":y(b),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue","prefix-icon"])]),_:1}),c(o,null,{default:d(()=>[c(s,{onClick:register,class:"button",type:"primary","auto-insert-space":""},{default:d(()=>[...t[9]||(t[9]=[x(" 注册 ",-1)])]),_:1})]),_:1}),c(o,{class:"flex"},{default:d(()=>[c(i,{type:"info",underline:!1,onClick:t[4]||(t[4]=e=>R.value=!1)},{default:d(()=>[...t[10]||(t[10]=[x(" ← 返回 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])):(P(),u(C,{key:1,model:$.value,rules:U,ref_key:"form",ref:S,size:"large",autocomplete:"off"},{default:d(()=>[c(o,null,{default:d(()=>[...t[11]||(t[11]=[g("h1",null,"登录",-1)])]),_:1}),c(o,{prop:"username"},{default:d(()=>[c(n,{modelValue:$.value.username,"onUpdate:modelValue":t[5]||(t[5]=e=>$.value.username=e),"prefix-icon":y(v),placeholder:"请输入用户名",id:"username-input"},null,8,["modelValue","prefix-icon"])]),_:1}),c(o,{prop:"password"},{default:d(()=>[c(n,{modelValue:$.value.password,"onUpdate:modelValue":t[6]||(t[6]=e=>$.value.password=e),name:"password","prefix-icon":y(_),type:"password",placeholder:"请输入密码",id:"password-input"},null,8,["modelValue","prefix-icon"])]),_:1}),c(o,null,{default:d(()=>[c(s,{id:"login-btn",onClick:login,class:"button",type:"primary","auto-insert-space":""},{default:d(()=>[...t[12]||(t[12]=[x("登录",-1)])]),_:1})]),_:1}),c(o,{class:"flex"},{default:d(()=>[c(i,{type:"info",underline:!1,onClick:t[7]||(t[7]=e=>R.value=!0)},{default:d(()=>[...t[13]||(t[13]=[x(" 注册 → ",-1)])]),_:1})]),_:1})]),_:1},8,["model"]))]),_:1})]),_:1})):p("",!0)],64)}}}),[["__scopeId","data-v-9b500c27"]]);export{M as default};

import{u as R,a as N,r as b,o as O,b as Y,E as P,c as V,d as Z,e as ee,f as m,w as t,g as o,h as n,i as te,j as h,k as E,l as A,m as oe,n as ne,p as se,s as ae,q as z,t as le,v as re,x as ue,y as ie,z as ce,A as u,B as de,C as pe,D,F as _e,G as fe,H as me,I as ve,J as i}from"./index-C7uw_EaC.js";/* empty css                     */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     */import{_ as ge}from"./_plugin-vue_export-helper-DedD7E0N.js";/* empty css                        *//* empty css                       *//* empty css                 *//* empty css                   */import{u as ke}from"./cart-BkCcYCxp.js";const he="/BMT-MicroApps/assets/whlg_logo-eAl-Tk7z.png";function ye(L={}){const{warningTime:d=1800*1e3,checkInterval:B=300*1e3}=L,s=R(),p=N(),c=b(null),_=b(!1),a=()=>{if(!s.token)return;const l=s.getTokenRemainingTime();if(l<=0){r();return}l<=d&&!_.value&&(y(l),_.value=!0)},r=()=>{f(),s.logout(),P.warning("登录已过期，请重新登录");const l=p.currentRoute.value.fullPath;l!=="/login"&&p.push({path:"/login",query:{redirect:l}})},y=l=>{const M=Math.floor(l/6e4);V.confirm(`您的登录状态将在 ${M} 分钟后过期，是否需要延长登录时间？`,"登录即将过期",{confirmButtonText:"延长登录",cancelButtonText:"稍后处理",type:"warning"}).then(()=>{I()}).catch(()=>{P.info("请注意登录状态，避免操作中断")})},I=()=>{const l=p.currentRoute.value.fullPath;p.push({path:"/login",query:{redirect:l,refresh:"true"}})},w=()=>{c.value&&clearInterval(c.value),a(),c.value=setInterval(a,B)},f=()=>{c.value&&(clearInterval(c.value),c.value=null),_.value=!1};return O(()=>{s.token&&w()}),Y(()=>{f()}),{startTokenCheck:w,stopTokenCheck:f,checkTokenStatus:a}}const we={class:"header__content"},xe={class:"container"},Ce={class:"header__logo"},Te={class:"user-area"},Ee={key:4,class:"user-info"},be={class:"user-info-wrapper"},Be={class:"user-avatar"},Ie=["src"],Me={key:1,src:"https://tse1-mm.cn.bing.net/th/id/OIP-C.gaAkkFf8LStn-oc4l8iM0wAAAA?w=160&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7",alt:"默认头像"},Ae={class:"username"},Le={class:"nav"},Se={class:"container"},Ue={__name:"LayOut",setup(L){const d=R(),B=ke(),s=N(),{startTokenCheck:p,stopTokenCheck:c}=ye({warningTime:1800*1e3,checkInterval:300*1e3}),_=Z(()=>B.totalCount),a=b(!1),r=b({});r.value=d.userinfo;const y=v=>{const{avatarUrl:e}=v.detail;r.value&&(r.value={...r.value,avatar:e})},I=()=>{if(d.token&&!d.isTokenExpired())try{a.value=!0,p()}catch(v){console.error("解析用户信息失败",v),a.value=!1}else a.value=!1,c()},w=()=>{s.push("/user-center")},f=()=>{s.push("/my-history-post")},l=()=>{s.push("/login")},M=()=>{s.push("/cart")},S=()=>{s.push("/booking-history")},U=()=>{s.push("/orders")},q=()=>{V.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.logout(),a.value=!1,r.value={username:"",avatar:""},s.currentRoute.value.path==="/user-center"&&s.push("/")})};return O(()=>{I(),window.addEventListener("user-avatar-updated",y)}),ee(()=>{window.removeEventListener("user-avatar-updated",y)}),(v,e)=>{const F=te,x=se,H=ne,g=oe,k=ce,W=ie,$=re,C=D("router-link"),T=pe,j=de,G=_e,J=D("router-view"),K=fe,Q=me,X=ve;return i(),m(X,{class:"layout-container"},{default:t(()=>[o(G,{class:"header"},{default:t(()=>[n("div",we,[n("div",xe,[n("div",Ce,[o(F,{src:h(he),alt:"",fit:"contain",style:{width:"300px",height:"100px"}},null,8,["src"]),e[0]||(e[0]=n("p",{style:{"font-size":"22px"}},"南湖校区羽毛球场地预定",-1))]),n("div",Te,[a.value?(i(),m(g,{key:0,type:"text",class:"cart-btn",onClick:M},{default:t(()=>[o(H,{value:_.value,hidden:_.value===0},{default:t(()=>[o(x,null,{default:t(()=>[o(h(ae))]),_:1})]),_:1},8,["value","hidden"]),e[1]||(e[1]=n("span",null,"购物车",-1))]),_:1})):E("",!0),a.value?(i(),m(g,{key:1,type:"text",class:"booking-history-btn",onClick:U},{default:t(()=>[o(x,null,{default:t(()=>[o(h(z))]),_:1}),e[2]||(e[2]=n("span",null,"商品订单",-1))]),_:1})):E("",!0),a.value?(i(),m(g,{key:2,type:"text",class:"booking-history-btn",onClick:S},{default:t(()=>[o(x,null,{default:t(()=>[o(h(z))]),_:1}),e[3]||(e[3]=n("span",null,"场地预订",-1))]),_:1})):E("",!0),a.value?(i(),m(g,{key:3,type:"text",class:"user-center-btn",onClick:f},{default:t(()=>[o(x,null,{default:t(()=>[o(h(le))]),_:1}),e[4]||(e[4]=n("span",null,"我的发帖",-1))]),_:1})):E("",!0),a.value?(i(),A("div",Ee,[o($,{trigger:"click"},{dropdown:t(()=>[o(W,null,{default:t(()=>[o(k,{onClick:w},{default:t(()=>[...e[5]||(e[5]=[u("个人中心",-1)])]),_:1}),o(k,{onClick:f},{default:t(()=>[...e[6]||(e[6]=[u("我的发帖",-1)])]),_:1}),o(k,{onClick:S},{default:t(()=>[...e[7]||(e[7]=[u("场地预订",-1)])]),_:1}),o(k,{onClick:U},{default:t(()=>[...e[8]||(e[8]=[u("商品订单",-1)])]),_:1}),o(k,{onClick:q},{default:t(()=>[...e[9]||(e[9]=[u("退出登录",-1)])]),_:1})]),_:1})]),default:t(()=>[n("div",be,[n("div",Be,[r.value.avatar?(i(),A("img",{key:0,src:r.value.avatar,alt:"头像"},null,8,Ie)):(i(),A("img",Me))]),n("span",Ae,ue(r.value.username),1)])]),_:1})])):(i(),m(g,{key:5,type:"primary",size:"large",class:"login",onClick:l},{default:t(()=>[...e[10]||(e[10]=[u(" 登录 / 注册 ",-1)])]),_:1}))])]),n("div",Le,[n("div",Se,[o(j,{"default-active":v.$route.path,class:"el-menu-demo",mode:"horizontal","background-color":"rgb(41, 108, 182)","text-color":"#fff","active-text-color":"#ffd04b"},{default:t(()=>[o(T,{index:"/home"},{default:t(()=>[o(C,{to:"/home"},{default:t(()=>[...e[11]||(e[11]=[u("首页",-1)])]),_:1})]),_:1}),o(T,{index:"/booking"},{default:t(()=>[o(C,{to:"/booking"},{default:t(()=>[...e[12]||(e[12]=[u("场地预定",-1)])]),_:1})]),_:1}),o(T,{index:"/shop"},{default:t(()=>[o(C,{to:"/shop"},{default:t(()=>[...e[13]||(e[13]=[u("羽体商城",-1)])]),_:1})]),_:1}),o(T,{index:"/forum"},{default:t(()=>[o(C,{to:"/forum"},{default:t(()=>[...e[14]||(e[14]=[u("羽你同行论坛",-1)])]),_:1})]),_:1})]),_:1},8,["default-active"])])])])]),_:1}),o(K,{class:"main-content"},{default:t(()=>[o(J)]),_:1}),o(Q,{class:"footer-container"},{default:t(()=>[...e[15]||(e[15]=[n("div",{class:"footer"},[n("div",{class:"container"},[n("p",null,"版权所有 © 2025 南湖校区羽毛球场预定系统"),n("p",null,"联系电话: 12345678901 | 地址: 南湖校区体育中心一楼")])],-1)])]),_:1})]),_:1})}}},We=ge(Ue,[["__scopeId","data-v-2611dc03"]]);export{We as default};

import{r as s,o as a,l as e,g as t,ai as i,h as l,k as c,f as n,j as r,w as o,x as d,a4 as u,P as p,Q as m,m as y,a2 as v,an as f,E as k,a as g,p as _,J as w,aE as h,aF as b,aG as j,A as x,i as C,c as O}from"./index-RXELqIC3.js";/* empty css                 */import{_ as T}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                        *//* empty css               *//* empty css                         */import{O as z,b as B,g as E,P as N,q,d as D}from"./pay-CUktMawW.js";/* empty css                       *//* empty css                 *//* empty css                   */const P={class:"order-detail-container"},S={key:0,class:"loading-container"},H={key:1,class:"order-detail"},J={class:"order-status-section"},R={class:"status-icon"},A={class:"status-info"},F={key:0},G={key:1},I={key:2},Q={class:"order-info-section"},U={class:"info-grid"},V={class:"info-item"},W={class:"value"},$={class:"info-item"},K={class:"value"},L={key:0,class:"info-item"},M={class:"value"},X={class:"info-item"},Y={key:1,class:"info-item"},Z={class:"value"},ss={class:"info-item pickup-code-item"},as={key:0,class:"pickup-code"},es={key:1,class:"pickup-code-pending"},ts={class:"products-section"},is={class:"product-list"},ls={class:"product-details"},cs={class:"product-name"},ns={key:0,class:"product-specs"},rs={class:"product-price"},os={class:"product-quantity"},ds={class:"product-subtotal"},us={key:0,class:"payment-section"},ps={class:"info-grid"},ms={class:"info-item"},ys={class:"value"},vs={key:0,class:"info-item"},fs={class:"value"},ks={class:"info-item"},gs={class:"amount-section"},_s={class:"amount-details"},ws={class:"amount-item"},hs={class:"amount-item total"},bs={class:"total-price"},js={class:"action-section"},xs={key:2,class:"error-container"},Cs=T({t:"OrderDetailView",setup(T){const Cs=g(),Os=f(),Ts=s(null),zs=s(null),Bs=s(!1),Es=async()=>{try{Bs.value=!0;const s=Os.params.orderNo;if(!s)return k.error("订单号不存在"),void Cs.push("/orders");const a=await E(s);0===a.data.code?(Ts.value=a.data.data,Ts.value.status===z.PAID&&await Ns(s)):k.error(a.message||"获取订单详情失败")}catch(s){k.error("获取订单详情失败")}finally{Bs.value=!1}},Ns=async s=>{try{const a=await q(s);0===a.data.code&&(zs.value=a.data.data)}catch(a){}},qs=()=>{const s={orderNo:Ts.value.orderNo,amount:Ts.value.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(s)),Cs.push("/payment")},Ds=()=>{O.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const s=await D(Ts.value.orderNo);0===s.data.code?(k.success("订单取消成功"),await Es()):k.error(s.message||"取消订单失败")}catch(s){k.error("取消订单失败")}}).catch(()=>{})},Ps=()=>{O.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(()=>{k.success("确认收货成功"),Es()}).catch(()=>{})},Ss=()=>{Cs.go(-1)},Hs=s=>{switch(s){case z.UNPAID:return"warning";case z.PAID:return"success";case z.CANCELLED:return"danger";default:return"info"}},Js=s=>{switch(s){case z.UNPAID:return"待支付";case z.PAID:return"已支付";case z.CANCELLED:return"已取消";default:return"未知状态"}},Rs=s=>{switch(s){case N.ALIPAY:return"支付宝";case N.WECHAT:return"微信支付";default:return"未知"}},As=s=>{if(!s)return"";return new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})};return a(()=>{Es()}),(s,a)=>{const f=i,k=_,g=u,O=C,T=y,E=v;return w(),e("div",P,[Bs.value?(w(),e("div",S,[t(f,{rows:8,animated:""})])):Ts.value?(w(),e("div",H,[l("div",J,[l("div",R,[Ts.value.status===r(z).PAID?(w(),n(k,{key:0,class:"success-icon",size:"60"},{default:o(()=>[t(r(h))]),i:1})):Ts.value.status===r(z).CANCELLED?(w(),n(k,{key:1,class:"error-icon",size:"60"},{default:o(()=>[t(r(b))]),i:1})):(w(),n(k,{key:2,class:"warning-icon",size:"60"},{default:o(()=>[t(r(j))]),i:1}))]),l("div",A,[l("h2",null,d(Js(Ts.value.status)),1),Ts.value.status===r(z).PAID?(w(),e("p",F,"您的订单已支付成功")):Ts.value.status===r(z).CANCELLED?(w(),e("p",G,"订单已取消")):(w(),e("p",I,"请尽快完成支付"))])]),l("div",Q,[a[6]||(a[6]=l("h3",null,"订单信息",-1)),l("div",U,[l("div",V,[a[0]||(a[0]=l("span",{class:"label"},"订单号：",-1)),l("span",W,d(Ts.value.orderNo),1)]),l("div",$,[a[1]||(a[1]=l("span",{class:"label"},"下单时间：",-1)),l("span",K,d(As(Ts.value.createTime)),1)]),Ts.value.payTime?(w(),e("div",L,[a[2]||(a[2]=l("span",{class:"label"},"支付时间：",-1)),l("span",M,d(As(Ts.value.payTime)),1)])):c("",!0),l("div",X,[a[3]||(a[3]=l("span",{class:"label"},"订单状态：",-1)),t(g,{type:Hs(Ts.value.status)},{default:o(()=>[x(d(Js(Ts.value.status)),1)]),i:1},8,["type"])]),Ts.value.remarks?(w(),e("div",Y,[a[4]||(a[4]=l("span",{class:"label"},"订单备注：",-1)),l("span",Z,d(Ts.value.remarks),1)])):c("",!0),l("div",ss,[a[5]||(a[5]=l("span",{class:"label"},"取件码：",-1)),Ts.value.status===r(z).PAID?(w(),e("span",as,d(Ts.value.pickupCode||"WHUT2024"),1)):(w(),e("span",es," 支付成功后显示取件码 "))])])]),l("div",ts,[a[7]||(a[7]=l("h3",null,"商品信息",-1)),l("div",is,[(w(!0),e(p,null,m(Ts.value.orderItems,(s,a)=>(w(),e("div",{key:a,class:"product-item"},[t(O,{src:s.productImage,class:"product-image",fit:"cover"},null,8,["src"]),l("div",ls,[l("div",cs,d(s.productName),1),s.specs?(w(),e("div",ns," 规格："+d(Object.entries(s.specs).map(([s,a])=>`${a}`).join("、")),1)):c("",!0),l("div",rs,"¥"+d(s.productPrice.toFixed(2)),1)]),l("div",os,"x"+d(s.quantity),1),l("div",ds," ¥"+d((s.productPrice*s.quantity).toFixed(2)),1)]))),128))])]),zs.value?(w(),e("div",us,[a[11]||(a[11]=l("h3",null,"支付信息",-1)),l("div",ps,[l("div",ms,[a[8]||(a[8]=l("span",{class:"label"},"支付方式：",-1)),l("span",ys,d(Rs(zs.value.payPlatform)),1)]),zs.value.payTime?(w(),e("div",vs,[a[9]||(a[9]=l("span",{class:"label"},"支付时间：",-1)),l("span",fs,d(As(zs.value.payTime)),1)])):c("",!0),l("div",ks,[a[10]||(a[10]=l("span",{class:"label"},"支付状态：",-1)),t(g,{type:zs.value.status===r(B).SUCCESS?"success":"warning"},{default:o(()=>[x(d(zs.value.status===r(B).SUCCESS?"已支付":"未支付"),1)]),i:1},8,["type"])])])])):c("",!0),l("div",gs,[a[14]||(a[14]=l("h3",null,"金额明细",-1)),l("div",_s,[l("div",ws,[a[12]||(a[12]=l("span",null,"商品总价：",-1)),l("span",null,"¥"+d(Ts.value.totalPrice.toFixed(2)),1)]),l("div",hs,[a[13]||(a[13]=l("span",null,"实付金额：",-1)),l("span",bs,"¥"+d(Ts.value.totalPrice.toFixed(2)),1)])])]),l("div",js,[t(T,{onClick:Ss},{default:o(()=>[...a[15]||(a[15]=[x("返回",-1)])]),i:1}),Ts.value.status===r(z).UNPAID?(w(),n(T,{key:0,type:"primary",onClick:qs},{default:o(()=>[...a[16]||(a[16]=[x(" 立即支付 ",-1)])]),i:1})):c("",!0),Ts.value.status===r(z).UNPAID?(w(),n(T,{key:1,type:"danger",onClick:Ds},{default:o(()=>[...a[17]||(a[17]=[x(" 取消订单 ",-1)])]),i:1})):c("",!0),Ts.value.status===r(z).PAID?(w(),n(T,{key:2,type:"success",onClick:Ps},{default:o(()=>[...a[18]||(a[18]=[x(" 确认收货 ",-1)])]),i:1})):c("",!0)])])):(w(),e("div",xs,[t(E,{description:"订单不存在或已被删除"},{default:o(()=>[t(T,{type:"primary",onClick:Ss},{default:o(()=>[...a[19]||(a[19]=[x("返回",-1)])]),i:1})]),i:1})]))])}}},[["__scopeId","data-v-69822995"]]);export{Cs as default};

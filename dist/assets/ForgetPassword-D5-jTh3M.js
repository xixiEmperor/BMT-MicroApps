import{r as e,f as a,w as l,g as r,ak as s,ah as o,ae as i,h as t,af as u,j as d,a$ as n,m as c,A as m,x as p,a_ as f,b0 as v,E as g,a as w,aj as _,J as y}from"./index-BMm2wflY.js";/* empty css               *//* empty css                     */import{V as b,a as V,d as P}from"./VerificationCodeInput-DAeUKHfv.js";import{_ as h}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                 */const x={class:"verify-code-section"},C={name:"ForgetPasswordView"},j=h(Object.assign(C,{setup(h){const C=w(),j=e({email:"",verificationCode:"",newPassword:"",confirmPassword:""}),k={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"请输入6位验证码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{pattern:/^\S{6,15}$/,message:"请输入6-15位非空密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(e,a,l)=>{a!==j.value.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},I=e(),q=e(!1),U=e(!1),$=e(0);let E=null;const sendVerifyCode=async()=>{try{await I.value.validateField(["email"]),U.value=!0;const e=await V({email:j.value.email,type:"reset"});0===e.data.code?(g.success("验证码已发送至您的邮箱"),$.value=60,E=setInterval(()=>{$.value--,$.value<=0&&(clearInterval(E),E=null,U.value=!1)},1e3)):(g.error(e.data.msg||"发送验证码失败"),U.value=!1)}catch(e){g.error("发送验证码失败，请检查邮箱格式"),U.value=!1}},resetPassword=async()=>{try{await I.value.validate(),q.value=!0;const e=await P({email:j.value.email,verificationCode:j.value.verificationCode,newPassword:j.value.newPassword});0===e.data.code?(g.success("密码重置成功"),C.push("/login")):g.error(e.data.msg||"密码重置失败")}catch(e){g.error("密码重置失败")}finally{q.value=!1}},goBack=()=>{E&&(clearInterval(E),E=null),C.push("/login")};return(e,g)=>{const w=s,V=i,P=u,h=c,C=v,E=o,F=_;return y(),a(F,{class:"login-page"},{default:l(()=>[r(w,{span:12,class:"bg"}),r(w,{span:6,offset:3,class:"form"},{default:l(()=>[r(E,{model:j.value,rules:k,ref_key:"form",ref:I,size:"large",autocomplete:"off"},{default:l(()=>[r(V,null,{default:l(()=>[...g[4]||(g[4]=[t("h1",null,"找回密码",-1)])]),_:1}),r(V,{prop:"email"},{default:l(()=>[r(P,{modelValue:j.value.email,"onUpdate:modelValue":g[0]||(g[0]=e=>j.value.email=e),"prefix-icon":d(n),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue","prefix-icon"])]),_:1}),r(V,{prop:"verificationCode"},{default:l(()=>[t("div",x,[r(b,{modelValue:j.value.verificationCode,"onUpdate:modelValue":g[1]||(g[1]=e=>j.value.verificationCode=e),length:6},null,8,["modelValue"]),r(h,{type:"primary",disabled:U.value||$.value>0,onClick:sendVerifyCode,class:"verify-code-btn"},{default:l(()=>[m(p($.value>0?`${$.value}秒后重新获取`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1}),r(V,{prop:"newPassword"},{default:l(()=>[r(P,{modelValue:j.value.newPassword,"onUpdate:modelValue":g[2]||(g[2]=e=>j.value.newPassword=e),"prefix-icon":d(f),type:"password",placeholder:"请输入新密码"},null,8,["modelValue","prefix-icon"])]),_:1}),r(V,{prop:"confirmPassword"},{default:l(()=>[r(P,{modelValue:j.value.confirmPassword,"onUpdate:modelValue":g[3]||(g[3]=e=>j.value.confirmPassword=e),"prefix-icon":d(f),type:"password",placeholder:"请确认新密码"},null,8,["modelValue","prefix-icon"])]),_:1}),r(V,null,{default:l(()=>[r(h,{onClick:resetPassword,class:"button",type:"primary","auto-insert-space":"",loading:q.value},{default:l(()=>[...g[5]||(g[5]=[m(" 保存 ",-1)])]),_:1},8,["loading"])]),_:1}),r(V,{class:"flex"},{default:l(()=>[r(C,{type:"info",underline:!1,onClick:goBack},{default:l(()=>[...g[6]||(g[6]=[m(" ← 返回登录 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-a4c8c7b3"]]);export{j as default};

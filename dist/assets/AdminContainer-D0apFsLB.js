import{u as a,r as s,d as e,Z as t,o as n,aW as i,c as r,E as o,b as l,l as c,k as d,M as m,g as p,h as u,w as g,j as f,aX as y,p as v,S as _,x as w,A as x,m as h,aY as j,aZ as k,J as b}from"./index-RXELqIC3.js";import{_ as C}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                       *//* empty css                 *//* empty css                   */const z={class:"admin-container"},A={key:0,class:"loading-container"},T={key:1,class:"error-container"},B={class:"error-message"},E=C({t:"AdminContainer",setup(C){const E=a(),I=s(!0),Z=s(!1),D=s(""),F=s(null),J=e(()=>({userInfo:E.userinfo,token:E.token,theme:"light",language:"zh-CN",timestamp:Date.now(),useRealtime:t()})),M=async()=>{try{if(!F.value)throw new Error("子应用容器元素不存在");await k(F.value,J.value),I.value=!1,Z.value=!1}catch(a){N(a)}},N=a=>{I.value=!1,Z.value=!0;const s=(null==a?void 0:a.message)||(null==a?void 0:a.toString())||"未知错误";D.value=s,s.includes("Failed to fetch")?D.value="网络连接失败，请检查网络状态或稍后重试":s.includes("404")?D.value="管理后台服务未启动，请联系管理员":D.value=`加载失败: ${s}`,o.error("管理后台加载失败，请刷新重试")},R=async()=>{Z.value=!1,I.value=!0,await M()};return n(()=>{setTimeout(async()=>{await M()},100),i.$on("admin-logout",()=>{r.confirm("您确定要退出登录吗？","确认退出",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{E.logout(),o.success("已退出登录"),window.location.href="/login"}).catch(()=>{})}),i.$on("admin-navigate",a=>{}),i.$on("admin-user-updated",a=>{E.updateUserInfo(a)}),i.$on("admin-message",({type:a,message:s})=>{"success"===a?o.success(s):"error"===a?o.error(s):"warning"===a?o.warning(s):o.info(s)})}),l(()=>{i.$off("admin-logout"),i.$off("admin-navigate"),i.$off("admin-user-updated"),i.$off("admin-message")}),(a,s)=>{const e=v,t=h;return b(),c("div",z,[I.value?(b(),c("div",A,[p(e,{class:"loading-icon",size:40},{default:g(()=>[p(f(y))]),i:1}),s[0]||(s[0]=u("p",{class:"loading-text"},"正在加载管理后台...",-1)),s[1]||(s[1]=u("p",{class:"loading-tip"},"首次加载可能需要几秒钟，请耐心等待",-1))])):d("",!0),Z.value?(b(),c("div",T,[p(e,{class:"error-icon",size:40},{default:g(()=>[p(f(_))]),i:1}),s[3]||(s[3]=u("p",{class:"error-text"},"管理后台加载失败",-1)),u("p",B,w(D.value),1),p(t,{type:"primary",onClick:R},{default:g(()=>[...s[2]||(s[2]=[x("重新加载",-1)])]),i:1})])):d("",!0),m(u("div",{ref_key:"subAppContainer",ref:F,id:"react-admin-container",class:"sub-app-container"},null,512),[[j,!I.value&&!Z.value]])])}}},[["__scopeId","data-v-47418b67"]]);export{E as default};

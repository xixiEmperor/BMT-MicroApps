import{r as t,o as e,l as a,h as l,g as o,f as s,k as c,w as r,j as i,ab as n,m as d,ai as u,a2 as p,at as m,x as y,a as w,J as g,A as h,au as v,av as f,i as k,aw as j,ax as _,ay as b,c as C}from"./index-BMm2wflY.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                         */import{_ as x}from"./_plugin-vue_export-helper-CTKw_zaB.js";import{u as A}from"./cart-M_M03IGN.js";/* empty css                       *//* empty css                 *//* empty css                   */const S={class:"cart-container"},q={class:"cart-header"},I={class:"cart-actions"},P={key:0},V={key:1,class:"empty-cart"},z={key:2,class:"cart-content"},N={class:"product-info"},B={class:"product-details"},O={key:0,class:"product-name"},T={key:1,class:"product-name"},F={class:"product-price"},J={class:"price"},L={class:"quantity-control"},U={class:"quantity"},$={class:"subtotal"},Q={class:"action-buttons"},E={class:"cart-footer"},M={class:"total-amount"},D={class:"total-price"},G=x({__name:"CartView",setup(x){const G=w(),H=A(),K=t(!1),toggleEditMode=()=>{K.value=!K.value},toggleSelectAll=async()=>{await H.toggleSelectAll()},clearCartItems=()=>{C.confirm("确定要清空购物车吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await H.clearCart()}).catch(()=>{})},checkoutFromCart=()=>{const t=H.getSelectedItems();if(0===t.length)return void C.alert("请至少选择一件商品进行结算！","提示");let e=0;const a={products:t.map(t=>{const a=t.productPrice+(t.priceAdjustment||0),l=a*t.quantity;return e+=l,{...t,actualPrice:a}}),totalAmount:e};localStorage.setItem("checkout_order",JSON.stringify(a)),G.push("/checkout")};return e(async()=>{H.resetLoadingState();try{await H.fetchCartList()}catch(t){}}),(t,e)=>{const w=d,x=u,A=p,R=f,W=v,X=k,Y=m;return g(),a("div",S,[l("div",q,[e[3]||(e[3]=l("h2",null,"我的购物车",-1)),l("div",I,[o(w,{type:"primary",icon:i(n),onClick:toggleEditMode},{default:r(()=>[h(y(K.value?"完成":"编辑"),1)]),_:1},8,["icon"]),i(H).cartItems.length>0?(g(),s(w,{key:0,type:"danger",onClick:clearCartItems},{default:r(()=>[...e[2]||(e[2]=[h(" 清空购物车 ",-1)])]),_:1})):c("",!0)])]),i(H).loading?(g(),a("div",P,[o(x,{rows:5,animated:""})])):0===i(H).cartItems.length?(g(),a("div",V,[o(A,{description:"购物车是空的，快去添加喜欢的商品吧！"},{default:r(()=>[o(w,{type:"primary",onClick:e[0]||(e[0]=e=>t.$router.push("/shop"))},{default:r(()=>[...e[4]||(e[4]=[h("去购物",-1)])]),_:1})]),_:1})])):(g(),a("div",z,[o(Y,{data:i(H).cartItems,style:{width:"100%"}},{default:r(()=>[o(W,{width:"55",align:"center"},{header:r(()=>[o(R,{modelValue:i(H).isAllSelected,"onUpdate:modelValue":e[1]||(e[1]=t=>i(H).isAllSelected=t),onChange:toggleSelectAll},null,8,["modelValue"])]),default:r(t=>[o(R,{modelValue:t.row.selected,"onUpdate:modelValue":e=>t.row.selected=e,onChange:()=>(async t=>{await H.toggleSelectItem(t)})(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(W,{label:"商品","min-width":"300"},{default:r(t=>[l("div",N,[o(X,{src:t.row.productImage,fit:"cover",class:"product-image"},null,8,["src"]),l("div",B,[Object.keys(t.row.specs||{}).length>0?(g(),a("div",O,y(t.row.productName)+" ("+y(Object.entries(t.row.specs).map(([t,e])=>`${e}`).join("、"))+") ",1)):(g(),a("div",T,y(t.row.productName),1)),l("div",F,"¥"+y(t.row.productPrice+t.row.priceAdjustment),1)])])]),_:1}),o(W,{label:"单价",width:"120",align:"center"},{default:r(t=>[l("span",J,"¥"+y(t.row.productPrice+t.row.priceAdjustment),1)]),_:1}),o(W,{label:"数量",width:"180",align:"center"},{default:r(t=>[l("div",L,[o(w,{icon:i(j),circle:"",size:"small",onClick:e=>(async t=>{await H.decreaseQuantity(t)})(t.row),disabled:t.row.quantity<=1},null,8,["icon","onClick","disabled"]),l("span",U,y(t.row.quantity),1),o(w,{icon:i(_),circle:"",size:"small",onClick:e=>(async t=>{await H.increaseQuantity(t)})(t.row),disabled:t.row.quantity>=t.row.stock},null,8,["icon","onClick","disabled"])])]),_:1}),o(W,{label:"小计",width:"150",align:"center"},{default:r(t=>[l("span",$,"¥"+y(((t.row.productPrice+t.row.priceAdjustment)*t.row.quantity).toFixed(2)),1)]),_:1}),o(W,{label:"操作",width:"180",align:"center"},{default:r(t=>[l("div",Q,[K.value?(g(),s(w,{key:0,type:"danger",icon:i(b),size:"small",onClick:e=>{return a=t.row,void C.confirm(`确定要从购物车中移除 ${a.productName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await H.removeFromCart(a)}).catch(()=>{});var a}},{default:r(()=>[...e[5]||(e[5]=[h(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):c("",!0),K.value?c("",!0):(g(),s(w,{key:1,type:"primary",size:"small",onClick:e=>(t=>{const e=t.productPrice+(t.priceAdjustment||0),a=e*t.quantity,l={product:{...t,actualPrice:e},totalAmount:a};localStorage.setItem("checkout_order",JSON.stringify(l)),G.push("/checkout")})(t.row)},{default:r(()=>[...e[6]||(e[6]=[h(" 立即购买 ",-1)])]),_:1},8,["onClick"]))])]),_:1})]),_:1},8,["data"]),l("div",E,[l("div",M,[e[7]||(e[7]=l("span",null,"总计:",-1)),l("span",D,"¥"+y(i(H).totalPrice.toFixed(2)),1)]),o(w,{type:"primary",size:"large",onClick:checkoutFromCart,disabled:K.value},{default:r(()=>[...e[8]||(e[8]=[h(" 结算 ",-1)])]),_:1},8,["disabled"])])]))])}}},[["__scopeId","data-v-92b21634"]]);export{G as default};

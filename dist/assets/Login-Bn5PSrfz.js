import{u as e,r as a,L as l,l as r,f as s,k as o,w as u,g as t,ak as i,ah as d,ae as n,h as p,af as m,j as c,t as f,a_ as v,a$ as g,m as _,A as w,x as y,b0 as V,av as x,P as b,E as h,a as k,aj as C,D as j,J as U}from"./index-BtPdgGUc.js";/* empty css               *//* empty css                    *//* empty css                     */import{V as q,a as I,b as $,c as E}from"./VerificationCodeInput-BMw-bzRy.js";import{_ as L}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                 */const z={class:"verify-code-section"},A={class:"flex"},D={name:"LoginView"},M=L(Object.assign(D,{setup(L){const D=e(),M=k(),O=a(!1),R=a({username:"",password:"",email:"",verificationCode:""}),S=a(!1),F=a(0);let H=null;const J={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:10,message:"请输入5-10位用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^\S{6,15}$/,message:"请输入6-15位非空密码",trigger:"blur"}],repassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(e,a,l)=>{a!==R.value.password?l(new Error("请输入相同的密码")):l()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"请输入6位验证码",trigger:"blur"}]},N=a();l(O,()=>{R.value={username:"",password:"",repassword:"",email:"",verificationCode:""},H&&(clearInterval(H),H=null),S.value=!1,F.value=0});const sendVerificationCode=async()=>{try{await N.value.validateField(["email"]),S.value=!0;const e=await I({email:R.value.email,type:"register"});0===e.data.code?(h.success("验证码已发送至您的邮箱"),F.value=60,H=setInterval(()=>{F.value--,F.value<=0&&(clearInterval(H),H=null,S.value=!1)},1e3)):(h.error(e.data.msg||"发送验证码失败"),S.value=!1)}catch(e){h.error("发送验证码失败，请检查邮箱格式"),S.value=!1}},register=async()=>{await N.value.validate();const e=await $(R.value);0===e.data.code?(h.success("注册成功"),O.value=!1):h.error(e.data.msg||"注册失败")},login=async()=>{var e,a,l;await N.value.validate();try{const a=await E(R.value);if(0===a.code){h.success("登录成功");const l=a.data.token;D.setToken(l),await D.getUserinfo();const r=M.currentRoute.value.query.redirect||"/";if("ROLE_ADMIN"===(null==(e=D.userinfo)?void 0:e.role)){const e=r.startsWith("/admin")?r:"/admin";M.push(e)}else M.push(r)}else h.error(a.message)}catch(r){h.error(`登录失败: ${(null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.message)||r.message||"未知错误"}`)}},goToForgetPassword=()=>{M.push("/login/forget-password")};return(e,a)=>{const l=j("router-view"),h=i,k=n,I=m,$=_,E=V,L=d,D=x,M=C;return U(),r(b,null,["/login"!==e.$route.path?(U(),s(l,{key:0})):o("",!0),"/login"===e.$route.path?(U(),s(M,{key:1,class:"login-page"},{default:u(()=>[t(h,{span:12,class:"bg"}),t(h,{span:6,offset:3,class:"form"},{default:u(()=>[O.value?(U(),s(L,{key:0,model:R.value,rules:J,ref_key:"form",ref:N,size:"large",autocomplete:"off"},{default:u(()=>[t(k,null,{default:u(()=>[...a[9]||(a[9]=[p("h1",null,"注册",-1)])]),_:1}),t(k,{prop:"username"},{default:u(()=>[t(I,{modelValue:R.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>R.value.username=e),"prefix-icon":c(f),placeholder:"请输入用户名"},null,8,["modelValue","prefix-icon"])]),_:1}),t(k,{prop:"password"},{default:u(()=>[t(I,{modelValue:R.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value.password=e),"prefix-icon":c(v),type:"password",placeholder:"请输入密码"},null,8,["modelValue","prefix-icon"])]),_:1}),t(k,{prop:"repassword"},{default:u(()=>[t(I,{modelValue:R.value.repassword,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value.repassword=e),"prefix-icon":c(v),type:"password",placeholder:"请输入再次密码"},null,8,["modelValue","prefix-icon"])]),_:1}),t(k,{prop:"email"},{default:u(()=>[t(I,{modelValue:R.value.email,"onUpdate:modelValue":a[3]||(a[3]=e=>R.value.email=e),"prefix-icon":c(g),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue","prefix-icon"])]),_:1}),t(k,{prop:"verificationCode"},{default:u(()=>[p("div",z,[t(q,{modelValue:R.value.verificationCode,"onUpdate:modelValue":a[4]||(a[4]=e=>R.value.verificationCode=e),length:6},null,8,["modelValue"]),t($,{type:"primary",disabled:S.value||F.value>0,onClick:sendVerificationCode,class:"verify-code-btn"},{default:u(()=>[w(y(F.value>0?`${F.value}秒后重新获取`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1}),t(k,null,{default:u(()=>[t($,{onClick:register,class:"button",type:"primary","auto-insert-space":""},{default:u(()=>[...a[10]||(a[10]=[w(" 注册 ",-1)])]),_:1})]),_:1}),t(k,{class:"flex"},{default:u(()=>[t(E,{type:"info",underline:!1,onClick:a[5]||(a[5]=e=>O.value=!1)},{default:u(()=>[...a[11]||(a[11]=[w(" ← 返回 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])):(U(),s(L,{key:1,model:R.value,rules:J,ref_key:"form",ref:N,size:"large",autocomplete:"off"},{default:u(()=>[t(k,null,{default:u(()=>[...a[12]||(a[12]=[p("h1",null,"登录",-1)])]),_:1}),t(k,{prop:"username"},{default:u(()=>[t(I,{modelValue:R.value.username,"onUpdate:modelValue":a[6]||(a[6]=e=>R.value.username=e),"prefix-icon":c(f),placeholder:"请输入用户名",id:"username-input"},null,8,["modelValue","prefix-icon"])]),_:1}),t(k,{prop:"password"},{default:u(()=>[t(I,{modelValue:R.value.password,"onUpdate:modelValue":a[7]||(a[7]=e=>R.value.password=e),name:"password","prefix-icon":c(v),type:"password",placeholder:"请输入密码",id:"password-input"},null,8,["modelValue","prefix-icon"])]),_:1}),t(k,{class:"flex"},{default:u(()=>[p("div",A,[t(D,null,{default:u(()=>[...a[13]||(a[13]=[w("记住我",-1)])]),_:1}),t(E,{type:"primary",underline:!1,onClick:goToForgetPassword},{default:u(()=>[...a[14]||(a[14]=[w("忘记密码？",-1)])]),_:1})])]),_:1}),t(k,null,{default:u(()=>[t($,{id:"login-btn",onClick:login,class:"button",type:"primary","auto-insert-space":""},{default:u(()=>[...a[15]||(a[15]=[w("登录",-1)])]),_:1})]),_:1}),t(k,{class:"flex"},{default:u(()=>[t(E,{type:"info",underline:!1,onClick:a[8]||(a[8]=e=>O.value=!0)},{default:u(()=>[...a[16]||(a[16]=[w(" 注册 → ",-1)])]),_:1})]),_:1})]),_:1},8,["model"]))]),_:1})]),_:1})):o("",!0)],64)}}}),[["__scopeId","data-v-696f51c4"]]);export{M as default};

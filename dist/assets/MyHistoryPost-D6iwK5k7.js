import{u as a,a as e}from"./index-BuScbc3L.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";import{_ as t}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                  */import{r as s,q as l,N as i,K as o,M as r,B as n,u as p,aZ as u,V as c,Y as d,A as m,O as v,a3 as f,ag as y,y as h,Q as g,aT as w,aH as j,aj as b,a_ as C,aL as _,ai as k,E as x,J as z,aG as T,z as A}from"./element-plus-D8DMz00a.js";import{f as V}from"./format-D0hGXpTN.js";import{j as B,h as I}from"./forum-CaX-pHs2.js";/* empty css                       *//* empty css                   */const L={class:"my-posts-container"},M={class:"posts-header"},O={key:0,class:"user-info"},R={class:"username"},S={class:"user-stats"},E={class:"stat-item"},G={class:"posts-content"},H=["onClick"],P={class:"post-stats"},Q={class:"post-actions"},$={class:"pagination-container"},q=t({__name:"MyHistoryPost",setup(t){const q=e(),D=a();s({}).value=D.userinfo||{};const F=s(1),J=s(10),K=s(0),N=s([]),U=s(!1),loadUserPosts=async()=>{var a;if(!(null==(a=D.userinfo)?void 0:a.id))return x.warning("请先登录"),void q.push("/login");U.value=!0;try{const a={userId:D.userinfo.id,page:F.value,pageSize:J.value},e=await B(a);0===e.data.code?(N.value=e.data.data.list||[],K.value=e.data.data.total||0,N.value.forEach(a=>{a.publishTime&&(a.publishTime=V(a.publishTime)),a.lastReply&&(a.lastReply=V(a.lastReply))})):x.error(e.data.msg||"获取发帖记录失败")}catch(e){x.error("获取发帖记录失败")}finally{U.value=!1}},navigateToDetail=a=>{q.push(`/post/${a}`)},handlePageChange=a=>{F.value=a,loadUserPosts()},handleSizeChange=a=>{J.value=a,F.value=1,loadUserPosts()},navigateToPublish=()=>{q.push("/publish-post")},getCategoryName=a=>({team:"打球组队",notice:"赛事讨论",help:"求助问答",exp:"经验交流"}[a]||"其他");return l(()=>{loadUserPosts()}),(a,e)=>{var t,s;const l=u,V=v,B=g,q=j,Y=b,Z=T,W=k,X=y;return A(),i("div",L,[e[3]||(e[3]=o("h2",null,"我的发帖",-1)),o("div",M,[p(D).token?(A(),i("div",O,[n(l,{src:(null==(t=p(D).userinfo)?void 0:t.avatar)||"https://tse1-mm.cn.bing.net/th/id/OIP-C.gaAkkFf8LStn-oc4l8iM0wAAAA?w=160&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7"},null,8,["src"]),o("span",R,c((null==(s=p(D).userinfo)?void 0:s.username)||"羽球爱好者"),1),o("div",S,[o("div",E,[e[1]||(e[1]=d("发帖数量：",-1)),o("span",null,c(K.value),1)])])])):r("",!0),n(V,{type:"primary",onClick:navigateToPublish},{default:m(()=>[...e[2]||(e[2]=[d("发布新帖",-1)])]),_:1})]),o("div",G,[f((A(),h(Z,{data:N.value,style:{width:"100%"},"empty-text":"暂无发帖记录"},{default:m(()=>[n(q,{prop:"title",label:"帖子标题","min-width":"300"},{default:m(a=>[o("div",{class:"post-title",onClick:e=>navigateToDetail(a.row.id)},[a.row.isTop?(A(),h(B,{key:0,class:"top-icon"},{default:m(()=>[n(p(w))]),_:1})):r("",!0),d(" "+c(a.row.title),1)],8,H)]),_:1}),n(q,{prop:"categoryCode",label:"分类",width:"120"},{default:m(a=>{return[n(Y,{type:(e=a.row.categoryCode,{team:"success",notice:"primary",help:"warning",exp:"info"}[e]||"default")},{default:m(()=>[d(c(getCategoryName(a.row.categoryCode)),1)]),_:2},1032,["type"])];var e}),_:1}),n(q,{prop:"publishTime",label:"发布时间",width:"180"}),n(q,{label:"回复/查看",width:"120"},{default:m(a=>[o("div",P,[o("div",null,c(a.row.replyCount||0)+" 回复",1),o("div",null,c(a.row.views||0)+" 查看",1)])]),_:1}),n(q,{label:"操作",width:"150"},{default:m(a=>[o("div",Q,[n(V,{type:"primary",icon:p(C),circle:"",size:"small",onClick:e=>navigateToDetail(a.row.id),title:"查看详情"},null,8,["icon","onClick"]),n(V,{type:"danger",icon:p(_),circle:"",size:"small",onClick:e=>{return t=a.row,void z.confirm(`确定要删除帖子"${t.title}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await I(t.id),x.success("帖子删除成功"),loadUserPosts()}catch(a){x.error("删除帖子失败")}}).catch(()=>{});var t},title:"删除帖子"},null,8,["icon","onClick"])])]),_:1})]),_:1},8,["data"])),[[X,U.value]]),o("div",$,[n(W,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=a=>F.value=a),"page-size":J.value,total:K.value,"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:handleSizeChange,onCurrentChange:handlePageChange},null,8,["modelValue","page-size","total"])])])])}}},[["__scopeId","data-v-b4ba7672"]]);export{q as default};

import{u as e,a}from"./index-BuScbc3L.js";/* empty css                     */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     */import{_ as t}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                        */import{r as l,q as s,I as n,E as o,J as u,d as r,v as i,y as c,A as d,B as p,K as v,L as f,u as h,M as m,N as k,O as _,P as g,Q as y,R as x,S as w,T as C,U as T,V as b,W as j,X as I,Y as A,Z as B,_ as R,x as L,$ as M,a0 as q,a1 as z,a2 as E,z as P}from"./element-plus-D8DMz00a.js";/* empty css                       *//* empty css                 *//* empty css                   */import{u as O}from"./cart-Dkt6AmB0.js";const S={class:"header__content"},$={class:"container"},U={class:"header__logo"},F={class:"user-area"},G={key:4,class:"user-info"},J={class:"user-info-wrapper"},K={class:"user-avatar"},N=["src"],Q={key:1,src:"https://tse1-mm.cn.bing.net/th/id/OIP-C.gaAkkFf8LStn-oc4l8iM0wAAAA?w=160&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7",alt:"默认头像"},V={class:"username"},W={class:"nav"},X={class:"container"},Y=t({__name:"LayOut",setup(t){const Y=e(),Z=O(),D=a(),{startTokenCheck:H,stopTokenCheck:ee}=function(t={}){const{warningTime:r=18e5,checkInterval:i=3e5}=t,c=e(),d=a(),p=l(null),v=l(!1),checkTokenStatus=()=>{if(!c.token)return;const e=c.getTokenRemainingTime();e<=0?handleTokenExpired():e<=r&&!v.value&&(showExpirationWarning(e),v.value=!0)},handleTokenExpired=()=>{stopTokenCheck(),c.logout(),o.warning("登录已过期，请重新登录");const e=d.currentRoute.value.fullPath;"/login"!==e&&d.push({path:"/login",query:{redirect:e}})},showExpirationWarning=e=>{const a=Math.floor(e/6e4);u.confirm(`您的登录状态将在 ${a} 分钟后过期，是否需要延长登录时间？`,"登录即将过期",{confirmButtonText:"延长登录",cancelButtonText:"稍后处理",type:"warning"}).then(()=>{refreshLogin()}).catch(()=>{o.info("请注意登录状态，避免操作中断")})},refreshLogin=()=>{const e=d.currentRoute.value.fullPath;d.push({path:"/login",query:{redirect:e,refresh:"true"}})},startTokenCheck=()=>{p.value&&clearInterval(p.value),checkTokenStatus(),p.value=setInterval(checkTokenStatus,i)},stopTokenCheck=()=>{p.value&&(clearInterval(p.value),p.value=null),v.value=!1};return s(()=>{c.token&&startTokenCheck()}),n(()=>{stopTokenCheck()}),{startTokenCheck:startTokenCheck,stopTokenCheck:stopTokenCheck,checkTokenStatus:checkTokenStatus}}({warningTime:18e5,checkInterval:3e5}),ae=r(()=>Z.totalCount),te=l(!1),le=l({});le.value=Y.userinfo;const handleUserAvatarUpdated=e=>{const{avatarUrl:a}=e.detail;le.value&&(le.value={...le.value,avatar:a})},goToUserCenter=()=>{D.push("/user-center")},goToMyPost=()=>{D.push("/my-history-post")},goToLogin=()=>{D.push("/login")},goToCart=()=>{D.push("/cart")},goToBookingHistory=()=>{D.push("/booking-history")},goToOrders=()=>{D.push("/orders")},logout=()=>{u.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Y.logout(),te.value=!1,le.value={username:"",avatar:""},"/user-center"===D.currentRoute.value.path&&D.push("/")})};return s(()=>{(()=>{if(Y.token&&!Y.isTokenExpired())try{te.value=!0,H()}catch(e){te.value=!1}else te.value=!1,ee()})(),window.addEventListener("user-avatar-updated",handleUserAvatarUpdated)}),i(()=>{window.removeEventListener("user-avatar-updated",handleUserAvatarUpdated)}),(e,a)=>{const t=f,l=y,s=g,n=_,o=I,u=j,r=T,i=L("router-link"),O=R,Y=B,Z=M,D=L("router-view"),H=q,ee=z,se=E;return P(),c(se,{class:"layout-container"},{default:d(()=>[p(Z,{class:"header"},{default:d(()=>[v("div",S,[v("div",$,[v("div",U,[p(t,{src:h("/BMT-MicroApps/assets/whlg_logo-Ckl8GxR1.png"),alt:"",fit:"contain",style:{width:"300px",height:"100px"}},null,8,["src"]),a[0]||(a[0]=v("p",{style:{"font-size":"22px"}},"南湖校区羽毛球场地预定",-1))]),v("div",F,[te.value?(P(),c(n,{key:0,type:"text",class:"cart-btn",onClick:goToCart},{default:d(()=>[p(s,{value:ae.value,hidden:0===ae.value},{default:d(()=>[p(l,null,{default:d(()=>[p(h(x))]),_:1})]),_:1},8,["value","hidden"]),a[1]||(a[1]=v("span",null,"购物车",-1))]),_:1})):m("",!0),te.value?(P(),c(n,{key:1,type:"text",class:"booking-history-btn",onClick:goToOrders},{default:d(()=>[p(l,null,{default:d(()=>[p(h(w))]),_:1}),a[2]||(a[2]=v("span",null,"商品订单",-1))]),_:1})):m("",!0),te.value?(P(),c(n,{key:2,type:"text",class:"booking-history-btn",onClick:goToBookingHistory},{default:d(()=>[p(l,null,{default:d(()=>[p(h(w))]),_:1}),a[3]||(a[3]=v("span",null,"场地预订",-1))]),_:1})):m("",!0),te.value?(P(),c(n,{key:3,type:"text",class:"user-center-btn",onClick:goToMyPost},{default:d(()=>[p(l,null,{default:d(()=>[p(h(C))]),_:1}),a[4]||(a[4]=v("span",null,"我的发帖",-1))]),_:1})):m("",!0),te.value?(P(),k("div",G,[p(r,{trigger:"click"},{dropdown:d(()=>[p(u,null,{default:d(()=>[p(o,{onClick:goToUserCenter},{default:d(()=>[...a[5]||(a[5]=[A("个人中心",-1)])]),_:1}),p(o,{onClick:goToMyPost},{default:d(()=>[...a[6]||(a[6]=[A("我的发帖",-1)])]),_:1}),p(o,{onClick:goToBookingHistory},{default:d(()=>[...a[7]||(a[7]=[A("场地预订",-1)])]),_:1}),p(o,{onClick:goToOrders},{default:d(()=>[...a[8]||(a[8]=[A("商品订单",-1)])]),_:1}),p(o,{onClick:logout},{default:d(()=>[...a[9]||(a[9]=[A("退出登录",-1)])]),_:1})]),_:1})]),default:d(()=>[v("div",J,[v("div",K,[le.value.avatar?(P(),k("img",{key:0,src:le.value.avatar,alt:"头像"},null,8,N)):(P(),k("img",Q))]),v("span",V,b(le.value.username),1)])]),_:1})])):(P(),c(n,{key:5,type:"primary",size:"large",class:"login",onClick:goToLogin},{default:d(()=>[...a[10]||(a[10]=[A(" 登录 / 注册 ",-1)])]),_:1}))])]),v("div",W,[v("div",X,[p(Y,{"default-active":e.$route.path,class:"el-menu-demo",mode:"horizontal","background-color":"rgb(41, 108, 182)","text-color":"#fff","active-text-color":"#ffd04b"},{default:d(()=>[p(O,{index:"/home"},{default:d(()=>[p(i,{to:"/home"},{default:d(()=>[...a[11]||(a[11]=[A("首页",-1)])]),_:1})]),_:1}),p(O,{index:"/booking"},{default:d(()=>[p(i,{to:"/booking"},{default:d(()=>[...a[12]||(a[12]=[A("场地预定",-1)])]),_:1})]),_:1}),p(O,{index:"/shop"},{default:d(()=>[p(i,{to:"/shop"},{default:d(()=>[...a[13]||(a[13]=[A("羽体商城",-1)])]),_:1})]),_:1}),p(O,{index:"/forum"},{default:d(()=>[p(i,{to:"/forum"},{default:d(()=>[...a[14]||(a[14]=[A("羽你同行论坛",-1)])]),_:1})]),_:1})]),_:1},8,["default-active"])])])])]),_:1}),p(H,{class:"main-content"},{default:d(()=>[p(D)]),_:1}),p(ee,{class:"footer-container"},{default:d(()=>[...a[15]||(a[15]=[v("div",{class:"footer"},[v("div",{class:"container"},[v("p",null,"版权所有 © 2025 南湖校区羽毛球场预定系统"),v("p",null,"联系电话: 12345678901 | 地址: 南湖校区体育中心一楼")])],-1)])]),_:1})]),_:1})}}},[["__scopeId","data-v-2611dc03"]]);export{Y as default};

import{aI as a,u as e,r as l,o as t,L as s,l as o,h as i,g as p,w as u,m as n,af as r,ap as m,j as d,at as c,a3 as v,a as h,J as f,A as w,P as b,Q as T,f as g,as as _,au as y,k as j,p as k,aJ as V,x as C,E as x}from"./index-BMm2wflY.js";/* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                    */import{_ as z}from"./_plugin-vue_export-helper-CTKw_zaB.js";import{g as D}from"./forum-kHVTcl2q.js";import{u as R}from"./forum-BtzwW1DJ.js";import{f as P}from"./format-D0hGXpTN.js";const U={class:"forum-container"},A={class:"forum-actions"},I={class:"forum-content"},J={class:"topics-container"},L=["onClick"],Q={class:"topic-author"},S={class:"topic-stats"},E={class:"topic-last-reply"},F={class:"pagination-container"},G=z(a({__name:"ForumView",setup(a){const z=h(),G=e(),K=R(),M=l([{name:"all",label:"全部帖子"},{name:"team",label:"打球组队"},{name:"notice",label:"赛事讨论"},{name:"help",label:"求助问答"},{name:"exp",label:"经验交流"}]),$=l("all"),q=l("");let B=null;const H=l(1),N=l(5),O=l(0),getForumListData=async()=>{const a=await D({page:H.value,pageSize:N.value,keyword:q.value,category:$.value});if(0===a.data.code){const e=a.data.data.list.map(a=>({...a,publishTime:P(a.publishTime),lastReply:P(a.lastReply)}));e.sort((a,e)=>a.isTop&&!e.isTop?-1:!a.isTop&&e.isTop?1:a.isTop&&e.isTop?new Date(e.topTime||e.publishTime).getTime()-new Date(a.topTime||a.publishTime).getTime():new Date(e.publishTime).getTime()-new Date(a.publishTime).getTime()),K.setPosts(e),O.value=a.data.data.total}};t(async()=>{await getForumListData()});const navigateToPublish=()=>{if(!G.token)return x.warning("请先登录后再发布文章"),void z.push("/login");z.push("/publish-post")},handleSearch=()=>{B&&clearTimeout(B),B=setTimeout(()=>{H.value=1,getForumListData()},500)},handlePageChange=a=>{H.value=a,getForumListData()},handleSizeChange=a=>{N.value=a,H.value=1,getForumListData()};s($,()=>{H.value=1,getForumListData()}),s(q,()=>{handleSearch()});const tableRowClassName=({row:a})=>a.isTop?"top-row":"";return(a,e)=>{const l=n,t=r,s=_,h=m,x=k,D=y,R=c,P=v;return f(),o("div",U,[e[5]||(e[5]=i("h2",null,"羽你同行论坛",-1)),i("div",A,[p(l,{type:"primary",onClick:navigateToPublish},{default:u(()=>[...e[3]||(e[3]=[w("发布新帖",-1)])]),_:1}),p(t,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),placeholder:"搜索论坛内容",class:"search-input"},{append:u(()=>[p(l,{onClick:handleSearch},{default:u(()=>[...e[4]||(e[4]=[w("搜索",-1)])]),_:1})]),_:1},8,["modelValue"])]),i("div",I,[p(h,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),class:"demo-tabs"},{default:u(()=>[(f(!0),o(b,null,T(M.value,a=>(f(),g(s,{key:a.name,label:a.label,name:a.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),i("div",J,[p(R,{data:d(K).posts,style:{width:"100%"},"row-class-name":tableRowClassName},{default:u(()=>[p(D,{prop:"title",label:"主题","min-width":"300"},{default:u(a=>[i("div",{class:"topic-title",onClick:e=>{return l=a.row.id,void z.push(`/post/${l}`);var l}},[a.row.isTop?(f(),g(x,{key:0,class:"top-icon"},{default:u(()=>[p(d(V))]),_:1})):j("",!0),w(" "+C(a.row.title),1)],8,L)]),_:1}),p(D,{prop:"author",label:"作者",width:"120"},{default:u(a=>[i("div",Q,C(a.row.author),1)]),_:1}),p(D,{prop:"replies",label:"回复/查看",width:"120"},{default:u(a=>[i("div",S,[i("div",null,C(a.row.replyCount||0)+" 回复",1),i("div",null,C(a.row.views)+" 查看",1)])]),_:1}),p(D,{prop:"lastReply",label:"最后回复",width:"120"},{default:u(a=>[i("div",E,C(a.row.lastReply),1)]),_:1})]),_:1},8,["data"])]),i("div",F,[p(P,{modelValue:H.value,"onUpdate:modelValue":e[2]||(e[2]=a=>H.value=a),"page-size":N.value,total:O.value,"page-sizes":[5,8,10,15],layout:"total, sizes, prev, pager, next",onSizeChange:handleSizeChange,onCurrentChange:handlePageChange},null,8,["modelValue","page-size","total"])])])])}}}),[["__scopeId","data-v-a7125a8d"]]);export{G as default};

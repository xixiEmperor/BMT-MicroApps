import{r as e,K as a,d as s,L as l,o as t,l as i,k as c,J as u,P as o,Q as n,h as r,x as d,O as p,g as v,ag as m,E as f,an as y,M as k,a1 as h,f as b,w as g,ao as j,aj as I,ap as _,aq as S,a as w,ar as A,A as x,ak as C,a6 as P,a7 as q,i as N,j as K,m as V,af as z,as as F}from"./index-BMm2wflY.js";/* empty css                   *//* empty css                    *//* empty css               *//* empty css                 */import{_ as O}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                         *//* empty css                        */import{c as J,d as L,e as M}from"./shop-CHtgWOwE.js";import{u as T}from"./cart-M_M03IGN.js";/* empty css                 */const B={key:0,class:"spec-selector"},E={class:"spec-title"},H={class:"spec-values"},U=["onClick"],D={key:0,class:"spec-info"},Q={class:"price-info"},$={class:"price"},G={key:0,class:"adjustment"},R={class:"stock-info"},W={key:1,class:"spec-hint"},X=O({__name:"SpecificationSelector",props:{productId:{type:[String,Number],required:!0},basePrice:{type:Number,required:!0},hasSpecification:{type:Boolean,default:!1},specifications:{type:Array,default:()=>[]}},emits:["specification-selected","specification-change"],setup(y,{emit:k}){const h=y,b=k,g=e([]),j=a({}),I=e(null),_=e(!1),S=s(()=>{if(!I.value)return h.basePrice.toFixed(2);return(h.basePrice+I.value.priceAdjustment).toFixed(2)}),isSpecValueDisabled=(e,a)=>!h.specifications.some(s=>s.specifications[e]===a&&s.stock>0),findMatchingSpecification=()=>{const e=Object.keys(j),a=[];for(const l of g.value)a.push(l.specKey);if(e.length!==a.length)return I.value=null,void b("specification-change",null);const s=h.specifications.find(e=>a.every(a=>e.specifications[a]===j[a]));s?(I.value=s,b("specification-selected",s)):fetchSpecificationBySelection()},fetchSpecificationBySelection=async()=>{_.value=!0;try{const e=await L(h.productId,j);0===e.data.code?I.value=e.data.data:f.warning("获取规格信息失败，请重新选择")}catch(e){f.error(e.msg)}finally{_.value=!1}},loadSpecOptions=()=>{h.hasSpecification&&h.productId&&(_.value=!0,J(h.productId).then(e=>{0===e.data.code&&(g.value=e.data.data)}).catch(e=>{f.error(e.msg)}).finally(()=>{_.value=!1}))};return l(()=>h.productId,()=>{h.productId&&h.hasSpecification&&loadSpecOptions()},{immediate:!0}),l(()=>h.hasSpecification,e=>{e&&h.productId?loadSpecOptions():(g.value={},Object.keys(j).forEach(e=>delete j[e]),I.value=null)},{immediate:!0}),l(()=>j,()=>{j&&fetchSpecificationBySelection()},{deep:!0}),t(()=>{h.productId&&h.hasSpecification&&loadSpecOptions()}),(e,a)=>{const s=m;return y.hasSpecification?(u(),i("div",B,[(u(!0),i(o,null,n(g.value,e=>{return u(),i("div",{key:e.id,class:"spec-group"},[r("div",E,d((a=e.specKey,{color:"颜色",size:"尺码",material:"材质",style:"款式"}[a]||a))+":",1),r("div",H,[(u(!0),i(o,null,n(e.specValues,a=>(u(),i("span",{key:a,class:p(["spec-value",j[e.specKey]===a?"selected":"",isSpecValueDisabled(e.specKey,a)?"disabled":""]),onClick:s=>{return!isSpecValueDisabled(e.specKey,a)&&(l=e.specKey,t=a,j[l]=t,void findMatchingSpecification());var l,t}},d(a),11,U))),128))])]);var a}),128)),I.value?(u(),i("div",D,[r("div",Q,[a[0]||(a[0]=r("span",{class:"label"},"现价:",-1)),r("span",$,"¥"+d(S.value),1),0!==I.value.priceAdjustment?(u(),i("span",G," ("+d(I.value.priceAdjustment>0?"+":"")+d(I.value.priceAdjustment)+") ",1)):c("",!0)]),r("div",R,[a[1]||(a[1]=r("span",{class:"label"},"库存:",-1)),r("span",{class:p(["stock",{"low-stock":I.value.stock<10}])},d(I.value.stock>0?I.value.stock:"无货"),3)])])):c("",!0),!I.value&&Object.keys(j).length>0?(u(),i("div",W,[v(s,{title:"请选择完整的规格组合",type:"warning",closable:!1,"show-icon":""})])):c("",!0)])):c("",!0)}}},[["__scopeId","data-v-828efb6c"]]),Y={class:"product-detail"},Z={key:0},ee={class:"product-gallery"},ae={key:1,class:"thumbnail-list"},se=["onClick"],le={class:"product-info"},te={class:"product-name"},ie={class:"product-subtitle"},ce={class:"product-meta"},ue={class:"price-row"},oe={class:"price"},ne={class:"stock-row"},re={class:"sales-row"},de={class:"sales"},pe={key:0,class:"spec-selection"},ve={class:"quantity-selection"},me={class:"quantity-control"},fe={class:"total-price-section"},ye={class:"total-price"},ke={class:"action-buttons"},he={class:"product-detail-content"},be=["innerHTML"],ge=O({__name:"ProductDetail",setup(a){const l=y(),m=w(),O=T(),J=e(!0),L=e(null),B=e([]),E=e("detail"),H=e(null),U=e(!1),D=e(1),Q=s(()=>{if(!L.value)return 0;let e=L.value.price;return 1===L.value.hasSpecification&&H.value&&(e=Number(e)+Number(H.value.priceAdjustment)),(e*D.value).toFixed(2)}),processImages=()=>{if(L.value&&(B.value=[],L.value.mainImage&&B.value.push(L.value.mainImage),L.value.subImages)){let e=L.value.subImages;"string"==typeof e?e=e.split(",").map(e=>e.trim()):Array.isArray(e)&&(e=[...e]),B.value.push(...e)}},handleSpecificationSelected=e=>{H.value=e,U.value=e&&e.stock>0,D.value=1},handleSpecificationChange=()=>{U.value=!1},increaseQuantity=()=>{const e=1===L.value.hasSpecification&&H.value?H.value.stock:L.value.stock;D.value<e?D.value++:f.warning("已达到最大库存数量")},decreaseQuantity=()=>{D.value>1&&D.value--},addToCartHandler=async()=>{if(!U.value)return void f.warning("请先选择有效的商品规格");const e={productId:L.value.id,productName:L.value.name,productImage:L.value.mainImage,productPrice:L.value.price,quantity:D.value,stock:1===L.value.hasSpecification&&H.value?H.value.stock:L.value.stock,selected:!0};1===L.value.hasSpecification&&H.value?(e.specificationId=H.value.id,e.specs=H.value.specifications,e.priceAdjustment=H.value.priceAdjustment):e.priceAdjustment=0;await O.addToCart(e)&&f.success("已添加到购物车")},buyNow=async()=>{if(!U.value)return void f.warning("请先选择有效的商品规格");const e={productId:L.value.id,productName:L.value.name,productImage:L.value.mainImage,productPrice:L.value.price,quantity:D.value,stock:1===L.value.hasSpecification&&H.value?H.value.stock:L.value.stock,selected:!0};1===L.value.hasSpecification&&H.value?(e.specificationId=H.value.id,e.specs=H.value.specifications,e.priceAdjustment=H.value.priceAdjustment):e.priceAdjustment=0;const a=e.productPrice+(e.priceAdjustment||0),s=a*e.quantity;e.actualPrice=a;const l={products:[e],totalAmount:s,isBuyNow:!0};localStorage.setItem("checkout_order",JSON.stringify(l)),m.push("/checkout")},goBack=()=>{m.push("/shop")};return t(()=>{const e=l.params.id;e?(async e=>{J.value=!0;try{const a=await M(e);0===a.data.code&&(L.value=a.data.data,0===L.value.hasSpecification&&L.value.stock&&(U.value=!0),processImages())}catch(a){f.error("获取商品详情失败")}finally{J.value=!1}})(e):J.value=!1}),(e,a)=>{const s=A,t=j,m=N,f=q,y=P,w=C,O=V,M=z,T=I,$=F,G=_,R=S,W=h;return k((u(),i("div",Y,[L.value?(u(),i("div",Z,[v(t,{separator:"/"},{default:g(()=>[v(s,{to:{path:"/"}},{default:g(()=>[...a[2]||(a[2]=[x("首页",-1)])]),_:1}),v(s,{to:{path:"/shop",query:{categoryId:L.value.categoryId}}},{default:g(()=>[x(d(L.value.categoryName),1)]),_:1},8,["to"]),v(s,null,{default:g(()=>[x(d(L.value.name),1)]),_:1})]),_:1}),v(T,{gutter:30,class:"product-info-container"},{default:g(()=>[v(w,{span:12},{default:g(()=>[r("div",ee,[B.value.length>0?(u(),b(y,{key:0,interval:4e3,type:"card",height:"400px",ref:"carousel"},{default:g(()=>[(u(!0),i(o,null,n(B.value,(e,a)=>(u(),b(f,{key:a},{default:g(()=>[v(m,{src:e,fit:"contain",class:"carousel-image"},null,8,["src"])]),_:2},1024))),128))]),_:1},512)):c("",!0),B.value.length>1?(u(),i("div",ae,[(u(!0),i(o,null,n(B.value,(a,s)=>(u(),i("div",{key:s,class:"thumbnail-item",onClick:a=>e.$refs.carousel.setActiveItem(s)},[v(m,{src:a,fit:"cover"},null,8,["src"])],8,se))),128))])):c("",!0)])]),_:1}),v(w,{span:12},{default:g(()=>[r("div",le,[r("h1",te,d(L.value.name),1),r("p",ie,d(L.value.subtitle),1),r("div",ce,[r("div",ue,[a[3]||(a[3]=r("span",{class:"label"},"原价:",-1)),r("span",oe,"¥"+d(L.value.price.toFixed(2)),1)]),r("div",ne,[a[4]||(a[4]=r("span",{class:"label"},"库存:",-1)),r("span",{class:p(["stock",{"low-stock":L.value.stock<10}])},d(L.value.stock>0?L.value.stock:"无货"),3)]),r("div",re,[a[5]||(a[5]=r("span",{class:"label"},"销量:",-1)),r("span",de,d(L.value.sales),1)])]),1===L.value.hasSpecification?(u(),i("div",pe,[v(X,{productId:Number(K(l).params.id),basePrice:L.value.price,hasSpecification:1===L.value.hasSpecification,specifications:L.value.specifications,onSpecificationSelected:handleSpecificationSelected,onSpecificationChange:handleSpecificationChange},null,8,["productId","basePrice","hasSpecification","specifications"])])):c("",!0),r("div",ve,[a[8]||(a[8]=r("span",{class:"label"},"数量:",-1)),r("div",me,[v(O,{type:"primary",circle:"",size:"small",onClick:decreaseQuantity,disabled:D.value<=1},{default:g(()=>[...a[6]||(a[6]=[x("-",-1)])]),_:1},8,["disabled"]),v(M,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),min:1,max:1===L.value.hasSpecification&&H.value?H.value.stock:L.value.stock,size:"small",style:{width:"120px"},disabled:!U.value},null,8,["modelValue","max","disabled"]),v(O,{type:"primary",circle:"",size:"small",onClick:increaseQuantity,disabled:!U.value},{default:g(()=>[...a[7]||(a[7]=[x("+",-1)])]),_:1},8,["disabled"])])]),r("div",fe,[a[9]||(a[9]=r("span",{class:"label"},"总价:",-1)),r("span",ye,"¥"+d(Q.value),1)]),r("div",ke,[v(O,{type:"primary",size:"large",disabled:!U.value,onClick:addToCartHandler},{default:g(()=>[...a[10]||(a[10]=[x(" 加入购物车 ",-1)])]),_:1},8,["disabled"]),v(O,{type:"danger",size:"large",disabled:!U.value,onClick:buyNow},{default:g(()=>[...a[11]||(a[11]=[x(" 立即购买 ",-1)])]),_:1},8,["disabled"])])])]),_:1})]),_:1}),r("div",he,[v(G,{modelValue:E.value,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value=e)},{default:g(()=>[v($,{label:"商品详情",name:"detail"},{default:g(()=>[r("div",{class:"detail-content",innerHTML:L.value.detail},null,8,be)]),_:1})]),_:1},8,["modelValue"])])])):c("",!0),J.value||L.value?c("",!0):(u(),b(R,{key:1,icon:"error",title:"商品加载失败","sub-title":"未找到商品信息或者商品已下架"},{extra:g(()=>[v(O,{type:"primary",onClick:goBack},{default:g(()=>[...a[12]||(a[12]=[x("返回商城",-1)])]),_:1})]),_:1}))])),[[W,J.value]])}}},[["__scopeId","data-v-a652f22b"]]);export{ge as default};

import{al as t,a as e,u as n,E as r,Y as o,r as a,L as i,l as s,J as l,h as u,P as c,Q as d,M as p,N as f,T as h}from"./index-RXELqIC3.js";import{_ as w}from"./_plugin-vue_export-helper-CRLhVpGU.js";function m(t){return new Promise(e=>setTimeout(e,t))}async function y(t,e={}){const n=function(t={}){const{retries:e=3,baseMs:n=1e3,capMs:r=3e4,strategy:o="exponential",jitter:a=!0,shouldRetry:i}=t,s=t=>{let e;e="fixed"===o?n:"linear"===o?n*(t+1):n*Math.pow(2,t);const i=Math.min(e,r);return a?Math.floor(Math.random()*i):i},l=(t,n)=>n<e;return async function(t){const n=e+1;let r;for(let a=0;a<n;a++)try{return await t()}catch(o){if(r=o,!(i??l)(o,a)||a>=e)throw o;const t=s(a);await m(t)}throw r}}(e);return n(t)}var T=null,v=[],g=!0,E=new Map;function H(t){if(null===t||"object"!=typeof t)return JSON.stringify(t);if(Array.isArray(t))return`[${t.map(H).join(",")}]`;return`{${Object.entries(t).sort(([t],[e])=>t<e?-1:t>e?1:0).map(([t,e])=>`${JSON.stringify(t)}:${H(e)}`).join(",")}}`}var P={get:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},post:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},put:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},delete:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},patch:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},head:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},options:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")}};const x=e();let b=!1;!function(e){const{baseURL:n,plugins:r=[],retry:o={retries:1},requestDedup:a=!0,timeout:i=1e4}=e;(T=t.create({baseURL:n,timeout:i})).interceptors.request.use(t=>(t.t=Date.now(),t)),T.interceptors.response.use(t=>{const e=t.config.t;return t.duration="number"==typeof e?Date.now()-e:0,t},t=>{if(t&&t.config){const e=t.config.t;t.response&&(t.response.duration="number"==typeof e?Date.now()-e:0)}return Promise.reject(t)}),v=r,g=a;const s=async(t,e,n,r)=>{if(!T)throw new Error("Axios instance not initialized");const a={...r??{},method:t,url:e,data:n},i=await async function(t){let e=t;for(const n of v)n.onRequest&&(e=await n.onRequest(e));return e}(a),s=async()=>{try{const t=await T.request(i);return await async function(t){let e=t;for(const n of v)n.onResponse&&(e=await n.onResponse(e));return e&&"data"in e?e.data:e}(t)}catch(t){let e=t;try{await async function(t){for(const e of v)e.onError&&await e.onError(t);throw t}(e)}catch{}throw e}},l=()=>y(s,{...o??{},...(null==r?void 0:r.retryConfig)??{}});if(((null==r?void 0:r.enableDedup)??!0)&&g&&i.method&&i.url){const t=function(t,e,n,r){const o=(null==n?void 0:n.params)?H(n.params):"",a=void 0!==r?H(r):"";return`${t.toUpperCase()} ${e}?${o} body:${a}`}(i.method,i.url,i,i.data);if(E.has(t))return E.get(t);const e=l().finally(()=>E.delete(t));return E.set(t,e),e}return l()},l={get:(t,e)=>s("GET",t,void 0,e),delete:(t,e)=>s("DELETE",t,void 0,e),head:(t,e)=>s("HEAD",t,void 0,e),options:(t,e)=>s("OPTIONS",t,void 0,e),post:(t,e,n)=>s("POST",t,e,n),put:(t,e,n)=>s("PUT",t,e,n),patch:(t,e,n)=>s("PATCH",t,e,n)};P.get=l.get,P.post=l.post,P.put=l.put,P.delete=l.delete,P.patch=l.patch,P.head=l.head,P.options=l.options}({baseURL:"http://localhost:8080",timeout:1e4,plugins:[function(t={}){const{getToken:e=()=>null,refreshToken:n,onTokenExpired:r,tokenHeader:o="Authorization",tokenPrefix:a="Bearer "}=t;return{name:"auth",async onRequest(t){const n=await e();return n&&(t.headers=t.headers??{},t.headers[o]=`${a}${n}`),t},async onError(t){if(t&&401===t.status)try{await(null==r?void 0:r())}catch{}throw t}}}({getToken:()=>localStorage.getItem("token"),onTokenExpired:()=>{if(b)return;b=!0;if(n().userinfo.token){r.warning("登录已过期，请重新登录");n().logout()}else r.warning("请先登录");const t=x.currentRoute.value.fullPath;"/login"!==t&&x.push({path:"/login",query:{redirect:t}}),setTimeout(()=>{b=!1},1e3)}})]});const k=t=>o({url:"/api/auth/send-code",method:"post",data:t}),A=t=>o({url:"/api/auth/register",method:"post",data:t}),$=t=>P.post("/api/auth/login",t),z=t=>o({url:"/api/auth/reset-password",method:"post",data:t}),C={class:"verification-code-input"},M={class:"code-inputs"},D=["onUpdate:modelValue","onInput","onKeydown"],_=w({o:"VerificationCodeInput",props:{modelValue:{type:String,default:""},length:{type:Number,default:6}},emits:["update:modelValue"],setup(t,{expose:e,emit:n}){const r=t,o=n,w=a(Array(r.length).fill("")),m=a([]);i(()=>r.modelValue,t=>{t!==w.value.join("")&&(w.value=t.split("").concat(Array(r.length).fill("")).slice(0,r.length))},{immediate:!0}),i(w,t=>{const e=t.join("");o("update:modelValue",e)},{deep:!0});const y=t=>{t.preventDefault();const e=t.clipboardData.getData("text").replace(/\D/g,"").split("").slice(0,r.length);e.forEach((t,e)=>{e<r.length&&(w.value[e]=t)});const n=Math.min(e.length-1,r.length-1);h(()=>{var t;null==(t=m.value[n])||t.focus()})};return e({focus:()=>{var t;null==(t=m.value[0])||t.focus()},clear:()=>{var t;w.value=Array(r.length).fill(""),null==(t=m.value[0])||t.focus()}}),(t,e)=>(l(),s("div",C,[u("div",M,[(l(!0),s(c,null,d(w.value,(t,e)=>p((l(),s("input",{key:e,"onUpdate:modelValue":t=>w.value[e]=t,ref_for:!0,ref:t=>((t,e)=>{t&&(m.value[e]=t)})(t,e),maxlength:"1",class:"code-digit",onInput:t=>((t,e)=>{const n=e.replace(/\D/g,"");w.value[t]=n,n&&t<r.length-1&&h(()=>{var e;null==(e=m.value[t+1])||e.focus()})})(e,t.target.value),onKeydown:t=>((t,e)=>{"Backspace"===e.key&&!w.value[t]&&t>0||"ArrowLeft"===e.key&&t>0?h(()=>{var e;null==(e=m.value[t-1])||e.focus()}):"ArrowRight"===e.key&&t<r.length-1&&h(()=>{var e;null==(e=m.value[t+1])||e.focus()})})(e,t),onPaste:y,type:"text",inputmode:"numeric",pattern:"[0-9]*"},null,40,D)),[[f,w.value[e]]])),128))])]))}},[["__scopeId","data-v-d1422850"]]);export{_ as V,k as a,A as b,$ as c,z as d};

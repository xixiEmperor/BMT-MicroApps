import{r as e,f as a,w as l,g as r,ak as s,ah as o,ae as t,h as i,af as n,j as d,a$ as u,m as p,A as c,x as m,a_ as f,b0 as g,E as w,a as _,aj as y,J as b}from"./index-RXELqIC3.js";/* empty css               *//* empty css                     */import{V,a as v,d as x}from"./VerificationCodeInput-BEoZipuI.js";import{_ as h}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                 */const j={class:"verify-code-section"},C={name:"ForgetPasswordView"},P=h(Object.assign(C,{setup(h){const C=_(),P=e({email:"",verificationCode:"",newPassword:"",confirmPassword:""}),k={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"请输入6位验证码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{pattern:/^\S{6,15}$/,message:"请输入6-15位非空密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(e,a,l)=>{a!==P.value.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},I=e(),q=e(!1),U=e(!1),$=e(0);let E=null;const S=async()=>{try{await I.value.validateField(["email"]),U.value=!0;const e=await v({email:P.value.email,type:"reset"});0===e.data.code?(w.success("验证码已发送至您的邮箱"),$.value=60,E=setInterval(()=>{$.value--,$.value<=0&&(clearInterval(E),E=null,U.value=!1)},1e3)):(w.error(e.data.msg||"发送验证码失败"),U.value=!1)}catch(e){w.error("发送验证码失败，请检查邮箱格式"),U.value=!1}},z=async()=>{try{await I.value.validate(),q.value=!0;const e=await x({email:P.value.email,verificationCode:P.value.verificationCode,newPassword:P.value.newPassword});0===e.data.code?(w.success("密码重置成功"),C.push("/login")):w.error(e.data.msg||"密码重置失败")}catch(e){w.error("密码重置失败")}finally{q.value=!1}},A=()=>{E&&(clearInterval(E),E=null),C.push("/login")};return(e,w)=>{const _=s,v=t,x=n,h=p,C=g,E=o,F=y;return b(),a(F,{class:"login-page"},{default:l(()=>[r(_,{span:12,class:"bg"}),r(_,{span:6,offset:3,class:"form"},{default:l(()=>[r(E,{model:P.value,rules:k,ref_key:"form",ref:I,size:"large",autocomplete:"off"},{default:l(()=>[r(v,null,{default:l(()=>[...w[4]||(w[4]=[i("h1",null,"找回密码",-1)])]),l:1}),r(v,{prop:"email"},{default:l(()=>[r(x,{modelValue:P.value.email,"onUpdate:modelValue":w[0]||(w[0]=e=>P.value.email=e),"prefix-icon":d(u),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue","prefix-icon"])]),l:1}),r(v,{prop:"verificationCode"},{default:l(()=>[i("div",j,[r(V,{modelValue:P.value.verificationCode,"onUpdate:modelValue":w[1]||(w[1]=e=>P.value.verificationCode=e),length:6},null,8,["modelValue"]),r(h,{type:"primary",disabled:U.value||$.value>0,onClick:S,class:"verify-code-btn"},{default:l(()=>[c(m($.value>0?`${$.value}秒后重新获取`:"获取验证码"),1)]),l:1},8,["disabled"])])]),l:1}),r(v,{prop:"newPassword"},{default:l(()=>[r(x,{modelValue:P.value.newPassword,"onUpdate:modelValue":w[2]||(w[2]=e=>P.value.newPassword=e),"prefix-icon":d(f),type:"password",placeholder:"请输入新密码"},null,8,["modelValue","prefix-icon"])]),l:1}),r(v,{prop:"confirmPassword"},{default:l(()=>[r(x,{modelValue:P.value.confirmPassword,"onUpdate:modelValue":w[3]||(w[3]=e=>P.value.confirmPassword=e),"prefix-icon":d(f),type:"password",placeholder:"请确认新密码"},null,8,["modelValue","prefix-icon"])]),l:1}),r(v,null,{default:l(()=>[r(h,{onClick:z,class:"button",type:"primary","auto-insert-space":"",loading:q.value},{default:l(()=>[...w[5]||(w[5]=[c(" 保存 ",-1)])]),l:1},8,["loading"])]),l:1}),r(v,{class:"flex"},{default:l(()=>[r(C,{type:"info",underline:!1,onClick:A},{default:l(()=>[...w[6]||(w[6]=[c(" ← 返回登录 ",-1)])]),l:1})]),l:1})]),l:1},8,["model"])]),l:1})]),l:1})}}}),[["__scopeId","data-v-a4c8c7b3"]]);export{P as default};

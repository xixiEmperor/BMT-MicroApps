import{a as e}from"./index-BuScbc3L.js";/* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                         */import{_ as t}from"./_plugin-vue_export-helper-CTKw_zaB.js";import{r as a,q as l,N as s,K as o,B as r,y as c,M as i,A as n,u as d,aq as u,O as p,ax as m,ah as y,aG as w,V as g,z as h,Y as f,aH as v,aI as k,L as _,aJ as j,aK as b,aL as C,J as q}from"./element-plus-D8DMz00a.js";import{u as x}from"./cart-Dkt6AmB0.js";/* empty css                       *//* empty css                 *//* empty css                   */const A={class:"cart-container"},I={class:"cart-header"},S={class:"cart-actions"},V={key:0},P={key:1,class:"empty-cart"},z={key:2,class:"cart-content"},N={class:"product-info"},B={class:"product-details"},L={key:0,class:"product-name"},O={key:1,class:"product-name"},J={class:"product-price"},T={class:"price"},F={class:"quantity-control"},U={class:"quantity"},$={class:"subtotal"},K={class:"action-buttons"},Q={class:"cart-footer"},E={class:"total-amount"},G={class:"total-price"},H=t({__name:"CartView",setup(t){const H=e(),M=x(),Y=a(!1),toggleEditMode=()=>{Y.value=!Y.value},toggleSelectAll=async()=>{await M.toggleSelectAll()},clearCartItems=()=>{q.confirm("确定要清空购物车吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await M.clearCart()}).catch(()=>{})},checkoutFromCart=()=>{const e=M.getSelectedItems();if(0===e.length)return void q.alert("请至少选择一件商品进行结算！","提示");let t=0;const a={products:e.map(e=>{const a=e.productPrice+(e.priceAdjustment||0),l=a*e.quantity;return t+=l,{...e,actualPrice:a}}),totalAmount:t};localStorage.setItem("checkout_order",JSON.stringify(a)),H.push("/checkout")};return l(async()=>{M.resetLoadingState();try{await M.fetchCartList()}catch(e){}}),(e,t)=>{const a=p,l=m,x=y,D=k,R=v,W=_,X=w;return h(),s("div",A,[o("div",I,[t[3]||(t[3]=o("h2",null,"我的购物车",-1)),o("div",S,[r(a,{type:"primary",icon:d(u),onClick:toggleEditMode},{default:n(()=>[f(g(Y.value?"完成":"编辑"),1)]),_:1},8,["icon"]),d(M).cartItems.length>0?(h(),c(a,{key:0,type:"danger",onClick:clearCartItems},{default:n(()=>[...t[2]||(t[2]=[f(" 清空购物车 ",-1)])]),_:1})):i("",!0)])]),d(M).loading?(h(),s("div",V,[r(l,{rows:5,animated:""})])):0===d(M).cartItems.length?(h(),s("div",P,[r(x,{description:"购物车是空的，快去添加喜欢的商品吧！"},{default:n(()=>[r(a,{type:"primary",onClick:t[0]||(t[0]=t=>e.$router.push("/shop"))},{default:n(()=>[...t[4]||(t[4]=[f("去购物",-1)])]),_:1})]),_:1})])):(h(),s("div",z,[r(X,{data:d(M).cartItems,style:{width:"100%"}},{default:n(()=>[r(R,{width:"55",align:"center"},{header:n(()=>[r(D,{modelValue:d(M).isAllSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>d(M).isAllSelected=e),onChange:toggleSelectAll},null,8,["modelValue"])]),default:n(e=>[r(D,{modelValue:e.row.selected,"onUpdate:modelValue":t=>e.row.selected=t,onChange:()=>(async e=>{await M.toggleSelectItem(e)})(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),r(R,{label:"商品","min-width":"300"},{default:n(e=>[o("div",N,[r(W,{src:e.row.productImage,fit:"cover",class:"product-image"},null,8,["src"]),o("div",B,[Object.keys(e.row.specs||{}).length>0?(h(),s("div",L,g(e.row.productName)+" ("+g(Object.entries(e.row.specs).map(([e,t])=>`${t}`).join("、"))+") ",1)):(h(),s("div",O,g(e.row.productName),1)),o("div",J,"¥"+g(e.row.productPrice+e.row.priceAdjustment),1)])])]),_:1}),r(R,{label:"单价",width:"120",align:"center"},{default:n(e=>[o("span",T,"¥"+g(e.row.productPrice+e.row.priceAdjustment),1)]),_:1}),r(R,{label:"数量",width:"180",align:"center"},{default:n(e=>[o("div",F,[r(a,{icon:d(j),circle:"",size:"small",onClick:t=>(async e=>{await M.decreaseQuantity(e)})(e.row),disabled:e.row.quantity<=1},null,8,["icon","onClick","disabled"]),o("span",U,g(e.row.quantity),1),r(a,{icon:d(b),circle:"",size:"small",onClick:t=>(async e=>{await M.increaseQuantity(e)})(e.row),disabled:e.row.quantity>=e.row.stock},null,8,["icon","onClick","disabled"])])]),_:1}),r(R,{label:"小计",width:"150",align:"center"},{default:n(e=>[o("span",$,"¥"+g(((e.row.productPrice+e.row.priceAdjustment)*e.row.quantity).toFixed(2)),1)]),_:1}),r(R,{label:"操作",width:"180",align:"center"},{default:n(e=>[o("div",K,[Y.value?(h(),c(a,{key:0,type:"danger",icon:d(C),size:"small",onClick:t=>{return a=e.row,void q.confirm(`确定要从购物车中移除 ${a.productName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await M.removeFromCart(a)}).catch(()=>{});var a}},{default:n(()=>[...t[5]||(t[5]=[f(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):i("",!0),Y.value?i("",!0):(h(),c(a,{key:1,type:"primary",size:"small",onClick:t=>(e=>{const t=e.productPrice+(e.priceAdjustment||0),a=t*e.quantity,l={product:{...e,actualPrice:t},totalAmount:a};localStorage.setItem("checkout_order",JSON.stringify(l)),H.push("/checkout")})(e.row)},{default:n(()=>[...t[6]||(t[6]=[f(" 立即购买 ",-1)])]),_:1},8,["onClick"]))])]),_:1})]),_:1},8,["data"]),o("div",Q,[o("div",E,[t[7]||(t[7]=o("span",null,"总计:",-1)),o("span",G,"¥"+g(d(M).totalPrice.toFixed(2)),1)]),r(a,{type:"primary",size:"large",onClick:checkoutFromCart,disabled:Y.value},{default:n(()=>[...t[8]||(t[8]=[f(" 结算 ",-1)])]),_:1},8,["disabled"])])]))])}}},[["__scopeId","data-v-92b21634"]]);export{H as default};

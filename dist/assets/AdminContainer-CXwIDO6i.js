import{u as a,r as e,d as s,Z as n,o,aW as t,c as i,E as r,b as l,l as u,k as c,M as d,g as m,h as p,w as v,j as f,aX as g,p as w,S as y,x as h,A as _,m as x,aY as $,aZ as k,J as j}from"./index-BtPdgGUc.js";import{_ as b}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                       *//* empty css                 *//* empty css                   */const C={class:"admin-container"},z={key:0,class:"loading-container"},A={key:1,class:"error-container"},I={class:"error-message"},T=b({__name:"AdminContainer",setup(b){const T=a(),B=e(!0),E=e(!1),S=e(""),Z=e(null),D=s(()=>({userInfo:T.userinfo,token:T.token,theme:"light",language:"zh-CN",timestamp:Date.now(),useRealtime:n()})),startSubApp=async()=>{try{if(!Z.value)throw new Error("子应用容器元素不存在");await k(Z.value,D.value),B.value=!1,E.value=!1}catch(a){handleError(a)}},handleError=a=>{B.value=!1,E.value=!0;const e=(null==a?void 0:a.message)||(null==a?void 0:a.toString())||"未知错误";S.value=e,e.includes("Failed to fetch")?S.value="网络连接失败，请检查网络状态或稍后重试":e.includes("404")?S.value="管理后台服务未启动，请联系管理员":S.value=`加载失败: ${e}`,r.error("管理后台加载失败，请刷新重试")},retryLoad=async()=>{E.value=!1,B.value=!0,await startSubApp()};return o(()=>{setTimeout(async()=>{await startSubApp()},100),t.$on("admin-logout",()=>{i.confirm("您确定要退出登录吗？","确认退出",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{T.logout(),r.success("已退出登录"),window.location.href="/login"}).catch(()=>{})}),t.$on("admin-navigate",a=>{}),t.$on("admin-user-updated",a=>{T.updateUserInfo(a)}),t.$on("admin-message",({type:a,message:e})=>{"success"===a?r.success(e):"error"===a?r.error(e):"warning"===a?r.warning(e):r.info(e)})}),l(()=>{t.$off("admin-logout"),t.$off("admin-navigate"),t.$off("admin-user-updated"),t.$off("admin-message")}),(a,e)=>{const s=w,n=x;return j(),u("div",C,[B.value?(j(),u("div",z,[m(s,{class:"loading-icon",size:40},{default:v(()=>[m(f(g))]),_:1}),e[0]||(e[0]=p("p",{class:"loading-text"},"正在加载管理后台...",-1)),e[1]||(e[1]=p("p",{class:"loading-tip"},"首次加载可能需要几秒钟，请耐心等待",-1))])):c("",!0),E.value?(j(),u("div",A,[m(s,{class:"error-icon",size:40},{default:v(()=>[m(f(y))]),_:1}),e[3]||(e[3]=p("p",{class:"error-text"},"管理后台加载失败",-1)),p("p",I,h(S.value),1),m(n,{type:"primary",onClick:retryLoad},{default:v(()=>[...e[2]||(e[2]=[_("重新加载",-1)])]),_:1})])):c("",!0),d(p("div",{ref_key:"subAppContainer",ref:Z,id:"react-admin-container",class:"sub-app-container"},null,512),[[$,!B.value&&!E.value]])])}}},[["__scopeId","data-v-47418b67"]]);export{T as default};

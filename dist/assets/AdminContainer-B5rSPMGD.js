import{u as a,b as e,h as s,s as n}from"./index-BuScbc3L.js";import{_ as t}from"./_plugin-vue_export-helper-CTKw_zaB.js";import{r as o,d as i,q as r,J as l,E as u,I as c,N as d,M as m,a3 as p,B as v,K as f,A as g,u as y,b1 as h,Q as w,a9 as _,V as $,Y as x,O as b,b2 as j,z as k}from"./element-plus-D8DMz00a.js";/* empty css                       *//* empty css                 *//* empty css                   */const z={class:"admin-container"},C={key:0,class:"loading-container"},I={key:1,class:"error-container"},A={class:"error-message"},B=t({__name:"AdminContainer",setup(t){const B=a(),T=o(!0),E=o(!1),N=o(""),q=o(null),D=i(()=>({userInfo:B.userinfo,token:B.token,theme:"light",language:"zh-CN",timestamp:Date.now(),useRealtime:e()})),startSubApp=async()=>{try{if(!q.value)throw new Error("子应用容器元素不存在");await n(q.value,D.value),T.value=!1,E.value=!1}catch(a){handleError(a)}},handleError=a=>{T.value=!1,E.value=!0;const e=(null==a?void 0:a.message)||(null==a?void 0:a.toString())||"未知错误";N.value=e,e.includes("Failed to fetch")?N.value="网络连接失败，请检查网络状态或稍后重试":e.includes("404")?N.value="管理后台服务未启动，请联系管理员":N.value=`加载失败: ${e}`,u.error("管理后台加载失败，请刷新重试")},retryLoad=async()=>{E.value=!1,T.value=!0,await startSubApp()};return r(()=>{setTimeout(async()=>{await startSubApp()},100),s.$on("admin-logout",()=>{l.confirm("您确定要退出登录吗？","确认退出",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{B.logout(),u.success("已退出登录"),window.location.href="/login"}).catch(()=>{})}),s.$on("admin-navigate",a=>{}),s.$on("admin-user-updated",a=>{B.updateUserInfo(a)}),s.$on("admin-message",({type:a,message:e})=>{"success"===a?u.success(e):"error"===a?u.error(e):"warning"===a?u.warning(e):u.info(e)})}),c(()=>{s.$off("admin-logout"),s.$off("admin-navigate"),s.$off("admin-user-updated"),s.$off("admin-message")}),(a,e)=>{const s=w,n=b;return k(),d("div",z,[T.value?(k(),d("div",C,[v(s,{class:"loading-icon",size:40},{default:g(()=>[v(y(h))]),_:1}),e[0]||(e[0]=f("p",{class:"loading-text"},"正在加载管理后台...",-1)),e[1]||(e[1]=f("p",{class:"loading-tip"},"首次加载可能需要几秒钟，请耐心等待",-1))])):m("",!0),E.value?(k(),d("div",I,[v(s,{class:"error-icon",size:40},{default:g(()=>[v(y(_))]),_:1}),e[3]||(e[3]=f("p",{class:"error-text"},"管理后台加载失败",-1)),f("p",A,$(N.value),1),v(n,{type:"primary",onClick:retryLoad},{default:g(()=>[...e[2]||(e[2]=[x("重新加载",-1)])]),_:1})])):m("",!0),p(f("div",{ref_key:"subAppContainer",ref:q,id:"react-admin-container",class:"sub-app-container"},null,512),[[j,!T.value&&!E.value]])])}}},[["__scopeId","data-v-47418b67"]]);export{B as default};

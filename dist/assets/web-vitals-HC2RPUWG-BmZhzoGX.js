function b(t={}){const{enabled:r=!0,onMetric:e}=t;if(r){if(typeof window>"u"||typeof performance>"u"){console.warn("Web Vitals: 当前环境不支持Performance API");return}try{i(e),c(e),f(e),v(e),l(e)}catch(o){console.warn("Web Vitals 初始化失败:",o)}}}function i(t){if(!("PerformanceObserver"in window)){console.warn("LCP: 浏览器不支持PerformanceObserver");return}try{new PerformanceObserver(e=>{const o=e.getEntries(),u=o[o.length-1];if(u){const n=u.startTime;t==null||t({type:"vitals",name:"LCP",value:Math.round(n),unit:"ms",rating:n>4e3?"poor":n>2500?"needs-improvement":"good",ts:Date.now(),source:"web-vitals"})}}).observe({type:"largest-contentful-paint",buffered:!0})}catch(r){console.warn("LCP监控初始化失败:",r)}}function c(t){if(!("PerformanceObserver"in window)){console.warn("CLS: 浏览器不支持PerformanceObserver");return}let r=new Set;try{let e=0;new PerformanceObserver(u=>{for(const n of u.getEntries()){const s=n;s.hadRecentInput||(e+=s.value)}r.has(e)||(t==null||t({type:"vitals",name:"CLS",value:Math.round(e*1e3)/1e3,unit:"score",rating:e>.25?"poor":e>.1?"needs-improvement":"good",ts:Date.now(),source:"web-vitals"}),r.add(e))}).observe({type:"layout-shift",buffered:!0})}catch(e){console.warn("CLS监控初始化失败:",e)}}function f(t){if(!("PerformanceObserver"in window)){console.warn("FID: 浏览器不支持PerformanceObserver");return}try{let r=!1;const e=new PerformanceObserver(o=>{var n;if(r)return;const u=o.getEntries();if(u.length>0){const s=u[0],a=s.processingStart-s.startTime;t==null||t({type:"vitals",name:"FID",value:Math.round(a),unit:"ms",rating:a>300?"poor":a>100?"needs-improvement":"good",ts:Date.now(),source:"web-vitals",attrs:{processingStart:s.processingStart,startTime:s.startTime,target:(n=s.target)==null?void 0:n.tagName}}),r=!0,e.disconnect()}});e.observe({type:"first-input",buffered:!0})}catch(r){console.warn("FID监控初始化失败:",r)}}function v(t){if(!("PerformanceObserver"in window)){console.warn("FCP: 浏览器不支持PerformanceObserver");return}try{const r=new PerformanceObserver(e=>{const o=e.getEntries();if(console.log("FCP entries",o),o.length>0){const u=o.find(s=>s.name==="first-contentful-paint"),n=(u==null?void 0:u.startTime)??0;t==null||t({type:"vitals",name:"FCP",value:Math.round(n),unit:"ms",rating:n>3e3?"poor":n>1800?"needs-improvement":"good",ts:Date.now(),source:"web-vitals"}),r.disconnect()}});r.observe({type:"paint",buffered:!0})}catch(r){console.warn("FCP监控初始化失败:",r)}}function l(t){if(!("PerformanceObserver"in window)){console.warn("TTFB: 浏览器不支持PerformanceObserver API");return}try{const r=new PerformanceObserver(e=>{const o=e.getEntriesByType("navigation");if(o.length>0){const u=o[0],n=u.responseStart-u.fetchStart;t==null||t({type:"vitals",name:"TTFB",value:Math.round(n),unit:"ms",rating:n>1800?"poor":n>800?"needs-improvement":"good",ts:Date.now(),source:"web-vitals"}),r.disconnect()}});r.observe({type:"navigation",buffered:!0})}catch(r){console.warn("TTFB监控初始化失败:",r)}}export{b as initWebVitals};

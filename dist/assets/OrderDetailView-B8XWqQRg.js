import{r as a,o as s,l as e,g as t,ai as l,h as i,k as c,f as r,j as n,w as u,x as o,a4 as d,P as p,Q as v,m,a2 as y,an as f,E as k,a as g,p as h,J as P,aE as C,aF as _,aG as A,A as D,i as w,c as N}from"./index-BMm2wflY.js";/* empty css                 */import{_ as I}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                        *//* empty css               *//* empty css                         */import{O as E,b,g as x,P as j,q as T,d as L}from"./pay-CLrLKGCg.js";/* empty css                       *//* empty css                 *//* empty css                   */const S={class:"order-detail-container"},U={key:0,class:"loading-container"},O={key:1,class:"order-detail"},q={class:"order-status-section"},z={class:"status-icon"},F={class:"status-info"},B={key:0},H={key:1},J={key:2},R={class:"order-info-section"},W={class:"info-grid"},G={class:"info-item"},Q={class:"value"},V={class:"info-item"},Y={class:"value"},$={key:0,class:"info-item"},K={class:"value"},M={class:"info-item"},X={key:1,class:"info-item"},Z={class:"value"},aa={class:"info-item pickup-code-item"},sa={key:0,class:"pickup-code"},ea={key:1,class:"pickup-code-pending"},ta={class:"products-section"},la={class:"product-list"},ia={class:"product-details"},ca={class:"product-name"},ra={key:0,class:"product-specs"},na={class:"product-price"},ua={class:"product-quantity"},oa={class:"product-subtotal"},da={key:0,class:"payment-section"},pa={class:"info-grid"},va={class:"info-item"},ma={class:"value"},ya={key:0,class:"info-item"},fa={class:"value"},ka={class:"info-item"},ga={class:"amount-section"},ha={class:"amount-details"},Pa={class:"amount-item"},Ca={class:"amount-item total"},_a={class:"total-price"},Aa={class:"action-section"},Da={key:2,class:"error-container"},wa=I({__name:"OrderDetailView",setup(I){const wa=g(),Na=f(),Ia=a(null),Ea=a(null),ba=a(!1),fetchOrderDetail=async()=>{try{ba.value=!0;const a=Na.params.orderNo;if(!a)return k.error("订单号不存在"),void wa.push("/orders");const s=await x(a);0===s.data.code?(Ia.value=s.data.data,Ia.value.status===E.PAID&&await fetchPaymentDetail(a)):k.error(s.message||"获取订单详情失败")}catch(a){k.error("获取订单详情失败")}finally{ba.value=!1}},fetchPaymentDetail=async a=>{try{const s=await T(a);0===s.data.code&&(Ea.value=s.data.data)}catch(s){}},payOrder=()=>{const a={orderNo:Ia.value.orderNo,amount:Ia.value.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(a)),wa.push("/payment")},cancelOrder$1=()=>{N.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await L(Ia.value.orderNo);0===a.data.code?(k.success("订单取消成功"),await fetchOrderDetail()):k.error(a.message||"取消订单失败")}catch(a){k.error("取消订单失败")}}).catch(()=>{})},confirmReceipt=()=>{N.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(()=>{k.success("确认收货成功"),fetchOrderDetail()}).catch(()=>{})},goBack=()=>{wa.go(-1)},getStatusType=a=>{switch(a){case E.UNPAID:return"warning";case E.PAID:return"success";case E.CANCELLED:return"danger";default:return"info"}},getStatusText=a=>{switch(a){case E.UNPAID:return"待支付";case E.PAID:return"已支付";case E.CANCELLED:return"已取消";default:return"未知状态"}},getPaymentMethodText=a=>{switch(a){case j.ALIPAY:return"支付宝";case j.WECHAT:return"微信支付";default:return"未知"}},formatTime=a=>{if(!a)return"";return new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})};return s(()=>{fetchOrderDetail()}),(a,s)=>{const f=l,k=h,g=d,N=w,I=m,x=y;return P(),e("div",S,[ba.value?(P(),e("div",U,[t(f,{rows:8,animated:""})])):Ia.value?(P(),e("div",O,[i("div",q,[i("div",z,[Ia.value.status===n(E).PAID?(P(),r(k,{key:0,class:"success-icon",size:"60"},{default:u(()=>[t(n(C))]),_:1})):Ia.value.status===n(E).CANCELLED?(P(),r(k,{key:1,class:"error-icon",size:"60"},{default:u(()=>[t(n(_))]),_:1})):(P(),r(k,{key:2,class:"warning-icon",size:"60"},{default:u(()=>[t(n(A))]),_:1}))]),i("div",F,[i("h2",null,o(getStatusText(Ia.value.status)),1),Ia.value.status===n(E).PAID?(P(),e("p",B,"您的订单已支付成功")):Ia.value.status===n(E).CANCELLED?(P(),e("p",H,"订单已取消")):(P(),e("p",J,"请尽快完成支付"))])]),i("div",R,[s[6]||(s[6]=i("h3",null,"订单信息",-1)),i("div",W,[i("div",G,[s[0]||(s[0]=i("span",{class:"label"},"订单号：",-1)),i("span",Q,o(Ia.value.orderNo),1)]),i("div",V,[s[1]||(s[1]=i("span",{class:"label"},"下单时间：",-1)),i("span",Y,o(formatTime(Ia.value.createTime)),1)]),Ia.value.payTime?(P(),e("div",$,[s[2]||(s[2]=i("span",{class:"label"},"支付时间：",-1)),i("span",K,o(formatTime(Ia.value.payTime)),1)])):c("",!0),i("div",M,[s[3]||(s[3]=i("span",{class:"label"},"订单状态：",-1)),t(g,{type:getStatusType(Ia.value.status)},{default:u(()=>[D(o(getStatusText(Ia.value.status)),1)]),_:1},8,["type"])]),Ia.value.remarks?(P(),e("div",X,[s[4]||(s[4]=i("span",{class:"label"},"订单备注：",-1)),i("span",Z,o(Ia.value.remarks),1)])):c("",!0),i("div",aa,[s[5]||(s[5]=i("span",{class:"label"},"取件码：",-1)),Ia.value.status===n(E).PAID?(P(),e("span",sa,o(Ia.value.pickupCode||"WHUT2024"),1)):(P(),e("span",ea," 支付成功后显示取件码 "))])])]),i("div",ta,[s[7]||(s[7]=i("h3",null,"商品信息",-1)),i("div",la,[(P(!0),e(p,null,v(Ia.value.orderItems,(a,s)=>(P(),e("div",{key:s,class:"product-item"},[t(N,{src:a.productImage,class:"product-image",fit:"cover"},null,8,["src"]),i("div",ia,[i("div",ca,o(a.productName),1),a.specs?(P(),e("div",ra," 规格："+o(Object.entries(a.specs).map(([a,s])=>`${s}`).join("、")),1)):c("",!0),i("div",na,"¥"+o(a.productPrice.toFixed(2)),1)]),i("div",ua,"x"+o(a.quantity),1),i("div",oa," ¥"+o((a.productPrice*a.quantity).toFixed(2)),1)]))),128))])]),Ea.value?(P(),e("div",da,[s[11]||(s[11]=i("h3",null,"支付信息",-1)),i("div",pa,[i("div",va,[s[8]||(s[8]=i("span",{class:"label"},"支付方式：",-1)),i("span",ma,o(getPaymentMethodText(Ea.value.payPlatform)),1)]),Ea.value.payTime?(P(),e("div",ya,[s[9]||(s[9]=i("span",{class:"label"},"支付时间：",-1)),i("span",fa,o(formatTime(Ea.value.payTime)),1)])):c("",!0),i("div",ka,[s[10]||(s[10]=i("span",{class:"label"},"支付状态：",-1)),t(g,{type:Ea.value.status===n(b).SUCCESS?"success":"warning"},{default:u(()=>[D(o(Ea.value.status===n(b).SUCCESS?"已支付":"未支付"),1)]),_:1},8,["type"])])])])):c("",!0),i("div",ga,[s[14]||(s[14]=i("h3",null,"金额明细",-1)),i("div",ha,[i("div",Pa,[s[12]||(s[12]=i("span",null,"商品总价：",-1)),i("span",null,"¥"+o(Ia.value.totalPrice.toFixed(2)),1)]),i("div",Ca,[s[13]||(s[13]=i("span",null,"实付金额：",-1)),i("span",_a,"¥"+o(Ia.value.totalPrice.toFixed(2)),1)])])]),i("div",Aa,[t(I,{onClick:goBack},{default:u(()=>[...s[15]||(s[15]=[D("返回",-1)])]),_:1}),Ia.value.status===n(E).UNPAID?(P(),r(I,{key:0,type:"primary",onClick:payOrder},{default:u(()=>[...s[16]||(s[16]=[D(" 立即支付 ",-1)])]),_:1})):c("",!0),Ia.value.status===n(E).UNPAID?(P(),r(I,{key:1,type:"danger",onClick:cancelOrder$1},{default:u(()=>[...s[17]||(s[17]=[D(" 取消订单 ",-1)])]),_:1})):c("",!0),Ia.value.status===n(E).PAID?(P(),r(I,{key:2,type:"success",onClick:confirmReceipt},{default:u(()=>[...s[18]||(s[18]=[D(" 确认收货 ",-1)])]),_:1})):c("",!0)])])):(P(),e("div",Da,[t(x,{description:"订单不存在或已被删除"},{default:u(()=>[t(I,{type:"primary",onClick:goBack},{default:u(()=>[...s[19]||(s[19]=[D("返回",-1)])]),_:1})]),_:1})]))])}}},[["__scopeId","data-v-69822995"]]);export{wa as default};

import{al as t,a as e,u as n,E as a,Y as r,r as o,L as i,l as s,J as l,h as u,P as c,Q as p,M as d,N as f,T as h}from"./index-BtPdgGUc.js";import{_ as g}from"./_plugin-vue_export-helper-CTKw_zaB.js";function sleep(t){return new Promise(e=>setTimeout(e,t))}async function withRetry(t,e={}){const n=function(t={}){const{retries:e=3,baseMs:n=1e3,capMs:a=3e4,strategy:r="exponential",jitter:o=!0,shouldRetry:i}=t,computeDelay=t=>{let e;e="fixed"===r?n:"linear"===r?n*(t+1):n*Math.pow(2,t);const i=Math.min(e,a);return o?Math.floor(Math.random()*i):i},defaultShouldRetry=(t,n)=>n<e;return async function(t){const n=e+1;let a;for(let o=0;o<n;o++)try{return await t()}catch(r){if(a=r,!(i??defaultShouldRetry)(r,o)||o>=e)throw r;const t=computeDelay(o);await sleep(t)}throw a}}(e);return n(t)}var w=null,m=[],y=!0,v=new Map;function stableStringify(t){if(null===t||"object"!=typeof t)return JSON.stringify(t);if(Array.isArray(t))return`[${t.map(stableStringify).join(",")}]`;return`{${Object.entries(t).sort(([t],[e])=>t<e?-1:t>e?1:0).map(([t,e])=>`${JSON.stringify(t)}:${stableStringify(e)}`).join(",")}}`}var T={get:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},post:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},put:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},delete:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},patch:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},head:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")},options:()=>{throw new Error("HTTP client not initialized. Call initHttp() first.")}};const E=e();let b=!1;!function(e){const{baseURL:n,plugins:a=[],retry:r={retries:1},requestDedup:o=!0,timeout:i=1e4}=e;(w=t.create({baseURL:n,timeout:i})).interceptors.request.use(t=>(t.__startTime=Date.now(),t)),w.interceptors.response.use(t=>{const e=t.config.__startTime;return t.duration="number"==typeof e?Date.now()-e:0,t},t=>{if(t&&t.config){const e=t.config.__startTime;t.response&&(t.response.duration="number"==typeof e?Date.now()-e:0)}return Promise.reject(t)}),m=a,y=o;const makeRequest=async(t,e,n,a)=>{if(!w)throw new Error("Axios instance not initialized");const o={...a??{},method:t,url:e,data:n},i=await async function(t){let e=t;for(const n of m)n.onRequest&&(e=await n.onRequest(e));return e}(o),exec=async()=>{try{const t=await w.request(i);return await async function(t){let e=t;for(const n of m)n.onResponse&&(e=await n.onResponse(e));return e&&"data"in e?e.data:e}(t)}catch(t){let e=t;try{await async function(t){for(const e of m)e.onError&&await e.onError(t);throw t}(e)}catch{}throw e}},execWithRetry=()=>withRetry(exec,{...r??{},...(null==a?void 0:a.retryConfig)??{}});if(((null==a?void 0:a.enableDedup)??!0)&&y&&i.method&&i.url){const t=function(t,e,n,a){const r=(null==n?void 0:n.params)?stableStringify(n.params):"",o=void 0!==a?stableStringify(a):"";return`${t.toUpperCase()} ${e}?${r} body:${o}`}(i.method,i.url,i,i.data);if(v.has(t))return v.get(t);const e=execWithRetry().finally(()=>v.delete(t));return v.set(t,e),e}return execWithRetry()},s={get:(t,e)=>makeRequest("GET",t,void 0,e),delete:(t,e)=>makeRequest("DELETE",t,void 0,e),head:(t,e)=>makeRequest("HEAD",t,void 0,e),options:(t,e)=>makeRequest("OPTIONS",t,void 0,e),post:(t,e,n)=>makeRequest("POST",t,e,n),put:(t,e,n)=>makeRequest("PUT",t,e,n),patch:(t,e,n)=>makeRequest("PATCH",t,e,n)};T.get=s.get,T.post=s.post,T.put=s.put,T.delete=s.delete,T.patch=s.patch,T.head=s.head,T.options=s.options}({baseURL:"http://localhost:8080",timeout:1e4,plugins:[function(t={}){const{getToken:e=()=>null,refreshToken:n,onTokenExpired:a,tokenHeader:r="Authorization",tokenPrefix:o="Bearer "}=t;return{name:"auth",async onRequest(t){const n=await e();return n&&(t.headers=t.headers??{},t.headers[r]=`${o}${n}`),t},async onError(t){if(t&&401===t.status)try{await(null==a?void 0:a())}catch{}throw t}}}({getToken:()=>localStorage.getItem("token"),onTokenExpired:()=>{if(b)return;b=!0;if(n().userinfo.token){a.warning("登录已过期，请重新登录");n().logout()}else a.warning("请先登录");const t=E.currentRoute.value.fullPath;"/login"!==t&&E.push({path:"/login",query:{redirect:t}}),setTimeout(()=>{b=!1},1e3)}})]});const authSendCodeService=t=>r({url:"/api/auth/send-code",method:"post",data:t}),authRegisterService=t=>r({url:"/api/auth/register",method:"post",data:t}),authLoginService=t=>T.post("/api/auth/login",t),authResetPasswordService=t=>r({url:"/api/auth/reset-password",method:"post",data:t}),H={class:"verification-code-input"},P={class:"code-inputs"},k=["onUpdate:modelValue","onInput","onKeydown"],_=g({__name:"VerificationCodeInput",props:{modelValue:{type:String,default:""},length:{type:Number,default:6}},emits:["update:modelValue"],setup(t,{expose:e,emit:n}){const a=t,r=n,g=o(Array(a.length).fill("")),w=o([]);i(()=>a.modelValue,t=>{t!==g.value.join("")&&(g.value=t.split("").concat(Array(a.length).fill("")).slice(0,a.length))},{immediate:!0}),i(g,t=>{const e=t.join("");r("update:modelValue",e)},{deep:!0});const handlePaste=t=>{t.preventDefault();const e=t.clipboardData.getData("text").replace(/\D/g,"").split("").slice(0,a.length);e.forEach((t,e)=>{e<a.length&&(g.value[e]=t)});const n=Math.min(e.length-1,a.length-1);h(()=>{var t;null==(t=w.value[n])||t.focus()})};return e({focus:()=>{var t;null==(t=w.value[0])||t.focus()},clear:()=>{var t;g.value=Array(a.length).fill(""),null==(t=w.value[0])||t.focus()}}),(t,e)=>(l(),s("div",H,[u("div",P,[(l(!0),s(c,null,p(g.value,(t,e)=>d((l(),s("input",{key:e,"onUpdate:modelValue":t=>g.value[e]=t,ref_for:!0,ref:t=>((t,e)=>{t&&(w.value[e]=t)})(t,e),maxlength:"1",class:"code-digit",onInput:t=>((t,e)=>{const n=e.replace(/\D/g,"");g.value[t]=n,n&&t<a.length-1&&h(()=>{var e;null==(e=w.value[t+1])||e.focus()})})(e,t.target.value),onKeydown:t=>((t,e)=>{"Backspace"===e.key&&!g.value[t]&&t>0||"ArrowLeft"===e.key&&t>0?h(()=>{var e;null==(e=w.value[t-1])||e.focus()}):"ArrowRight"===e.key&&t<a.length-1&&h(()=>{var e;null==(e=w.value[t+1])||e.focus()})})(e,t),onPaste:handlePaste,type:"text",inputmode:"numeric",pattern:"[0-9]*"},null,40,k)),[[f,g.value[e]]])),128))])]))}},[["__scopeId","data-v-d1422850"]]);export{_ as V,authSendCodeService as a,authRegisterService as b,authLoginService as c,authResetPasswordService as d};

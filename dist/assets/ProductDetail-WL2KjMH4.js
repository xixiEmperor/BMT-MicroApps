import{r as a,K as s,d as e,L as t,o as l,l as c,k as i,J as o,P as r,Q as n,h as d,x as p,O as u,g as m,ag as f,E as y,an as b,M as v,a1 as k,f as _,w as h,ao as g,aj as j,ap as w,aq as C,a as I,ar as S,A as x,ak as q,a6 as N,a7 as P,i as z,j as V,m as O,af as A,as as J}from"./index-RXELqIC3.js";/* empty css                   *//* empty css                    *//* empty css               *//* empty css                 */import{_ as L}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                         *//* empty css                        */import{c as M,d as B,e as H}from"./shop-DNOL2iz9.js";import{u as K}from"./cart-CpOPODuf.js";/* empty css                 */const T={key:0,class:"spec-selector"},U={class:"spec-title"},D={class:"spec-values"},E=["onClick"],F={key:0,class:"spec-info"},Q={class:"price-info"},G={class:"price"},R={key:0,class:"adjustment"},W={class:"stock-info"},X={key:1,class:"spec-hint"},Y=L({t:"SpecificationSelector",props:{productId:{type:[String,Number],required:!0},basePrice:{type:Number,required:!0},hasSpecification:{type:Boolean,default:!1},specifications:{type:Array,default:()=>[]}},emits:["specification-selected","specification-change"],setup(b,{emit:v}){const k=b,_=v,h=a([]),g=s({}),j=a(null),w=a(!1),C=e(()=>{if(!j.value)return k.basePrice.toFixed(2);return(k.basePrice+j.value.priceAdjustment).toFixed(2)}),I=(a,s)=>!k.specifications.some(e=>e.specifications[a]===s&&e.stock>0),S=()=>{const a=Object.keys(g),s=[];for(const t of h.value)s.push(t.specKey);if(a.length!==s.length)return j.value=null,void _("specification-change",null);const e=k.specifications.find(a=>s.every(s=>a.specifications[s]===g[s]));e?(j.value=e,_("specification-selected",e)):x()},x=async()=>{w.value=!0;try{const a=await B(k.productId,g);0===a.data.code?j.value=a.data.data:y.warning("获取规格信息失败，请重新选择")}catch(a){y.error(a.msg)}finally{w.value=!1}},q=()=>{k.hasSpecification&&k.productId&&(w.value=!0,M(k.productId).then(a=>{0===a.data.code&&(h.value=a.data.data)}).catch(a=>{y.error(a.msg)}).finally(()=>{w.value=!1}))};return t(()=>k.productId,()=>{k.productId&&k.hasSpecification&&q()},{immediate:!0}),t(()=>k.hasSpecification,a=>{a&&k.productId?q():(h.value={},Object.keys(g).forEach(a=>delete g[a]),j.value=null)},{immediate:!0}),t(()=>g,()=>{g&&x()},{deep:!0}),l(()=>{k.productId&&k.hasSpecification&&q()}),(a,s)=>{const e=f;return b.hasSpecification?(o(),c("div",T,[(o(!0),c(r,null,n(h.value,a=>{return o(),c("div",{key:a.id,class:"spec-group"},[d("div",U,p((s=a.specKey,{color:"颜色",size:"尺码",material:"材质",style:"款式"}[s]||s))+":",1),d("div",D,[(o(!0),c(r,null,n(a.specValues,s=>(o(),c("span",{key:s,class:u(["spec-value",g[a.specKey]===s?"selected":"",I(a.specKey,s)?"disabled":""]),onClick:e=>{return!I(a.specKey,s)&&(t=a.specKey,l=s,g[t]=l,void S());var t,l}},p(s),11,E))),128))])]);var s}),128)),j.value?(o(),c("div",F,[d("div",Q,[s[0]||(s[0]=d("span",{class:"label"},"现价:",-1)),d("span",G,"¥"+p(C.value),1),0!==j.value.priceAdjustment?(o(),c("span",R," ("+p(j.value.priceAdjustment>0?"+":"")+p(j.value.priceAdjustment)+") ",1)):i("",!0)]),d("div",W,[s[1]||(s[1]=d("span",{class:"label"},"库存:",-1)),d("span",{class:u(["stock",{"low-stock":j.value.stock<10}])},p(j.value.stock>0?j.value.stock:"无货"),3)])])):i("",!0),!j.value&&Object.keys(g).length>0?(o(),c("div",X,[m(e,{title:"请选择完整的规格组合",type:"warning",closable:!1,"show-icon":""})])):i("",!0)])):i("",!0)}}},[["__scopeId","data-v-828efb6c"]]),Z={class:"product-detail"},$={key:0},aa={class:"product-gallery"},sa={key:1,class:"thumbnail-list"},ea=["onClick"],ta={class:"product-info"},la={class:"product-name"},ca={class:"product-subtitle"},ia={class:"product-meta"},oa={class:"price-row"},ra={class:"price"},na={class:"stock-row"},da={class:"sales-row"},pa={class:"sales"},ua={key:0,class:"spec-selection"},ma={class:"quantity-selection"},fa={class:"quantity-control"},ya={class:"total-price-section"},ba={class:"total-price"},va={class:"action-buttons"},ka={class:"product-detail-content"},_a=["innerHTML"],ha=L({t:"ProductDetail",setup(s){const t=b(),f=I(),L=K(),M=a(!0),B=a(null),T=a([]),U=a("detail"),D=a(null),E=a(!1),F=a(1),Q=e(()=>{if(!B.value)return 0;let a=B.value.price;return 1===B.value.hasSpecification&&D.value&&(a=Number(a)+Number(D.value.priceAdjustment)),(a*F.value).toFixed(2)}),G=()=>{if(B.value&&(T.value=[],B.value.mainImage&&T.value.push(B.value.mainImage),B.value.subImages)){let a=B.value.subImages;"string"==typeof a?a=a.split(",").map(a=>a.trim()):Array.isArray(a)&&(a=[...a]),T.value.push(...a)}},R=a=>{D.value=a,E.value=a&&a.stock>0,F.value=1},W=()=>{E.value=!1},X=()=>{const a=1===B.value.hasSpecification&&D.value?D.value.stock:B.value.stock;F.value<a?F.value++:y.warning("已达到最大库存数量")},ha=()=>{F.value>1&&F.value--},ga=async()=>{if(!E.value)return void y.warning("请先选择有效的商品规格");const a={productId:B.value.id,productName:B.value.name,productImage:B.value.mainImage,productPrice:B.value.price,quantity:F.value,stock:1===B.value.hasSpecification&&D.value?D.value.stock:B.value.stock,selected:!0};1===B.value.hasSpecification&&D.value?(a.specificationId=D.value.id,a.specs=D.value.specifications,a.priceAdjustment=D.value.priceAdjustment):a.priceAdjustment=0;await L.addToCart(a)&&y.success("已添加到购物车")},ja=async()=>{if(!E.value)return void y.warning("请先选择有效的商品规格");const a={productId:B.value.id,productName:B.value.name,productImage:B.value.mainImage,productPrice:B.value.price,quantity:F.value,stock:1===B.value.hasSpecification&&D.value?D.value.stock:B.value.stock,selected:!0};1===B.value.hasSpecification&&D.value?(a.specificationId=D.value.id,a.specs=D.value.specifications,a.priceAdjustment=D.value.priceAdjustment):a.priceAdjustment=0;const s=a.productPrice+(a.priceAdjustment||0),e=s*a.quantity;a.actualPrice=s;const t={products:[a],totalAmount:e,isBuyNow:!0};localStorage.setItem("checkout_order",JSON.stringify(t)),f.push("/checkout")},wa=()=>{f.push("/shop")};return l(()=>{const a=t.params.id;a?(async a=>{M.value=!0;try{const s=await H(a);0===s.data.code&&(B.value=s.data.data,0===B.value.hasSpecification&&B.value.stock&&(E.value=!0),G())}catch(s){y.error("获取商品详情失败")}finally{M.value=!1}})(a):M.value=!1}),(a,s)=>{const e=S,l=g,f=z,y=P,b=N,I=q,L=O,H=A,K=j,G=J,Ca=w,Ia=C,Sa=k;return v((o(),c("div",Z,[B.value?(o(),c("div",$,[m(l,{separator:"/"},{default:h(()=>[m(e,{to:{path:"/"}},{default:h(()=>[...s[2]||(s[2]=[x("首页",-1)])]),l:1}),m(e,{to:{path:"/shop",query:{categoryId:B.value.categoryId}}},{default:h(()=>[x(p(B.value.categoryName),1)]),l:1},8,["to"]),m(e,null,{default:h(()=>[x(p(B.value.name),1)]),l:1})]),l:1}),m(K,{gutter:30,class:"product-info-container"},{default:h(()=>[m(I,{span:12},{default:h(()=>[d("div",aa,[T.value.length>0?(o(),_(b,{key:0,interval:4e3,type:"card",height:"400px",ref:"carousel"},{default:h(()=>[(o(!0),c(r,null,n(T.value,(a,s)=>(o(),_(y,{key:s},{default:h(()=>[m(f,{src:a,fit:"contain",class:"carousel-image"},null,8,["src"])]),l:2},1024))),128))]),l:1},512)):i("",!0),T.value.length>1?(o(),c("div",sa,[(o(!0),c(r,null,n(T.value,(s,e)=>(o(),c("div",{key:e,class:"thumbnail-item",onClick:s=>a.$refs.carousel.setActiveItem(e)},[m(f,{src:s,fit:"cover"},null,8,["src"])],8,ea))),128))])):i("",!0)])]),l:1}),m(I,{span:12},{default:h(()=>[d("div",ta,[d("h1",la,p(B.value.name),1),d("p",ca,p(B.value.subtitle),1),d("div",ia,[d("div",oa,[s[3]||(s[3]=d("span",{class:"label"},"原价:",-1)),d("span",ra,"¥"+p(B.value.price.toFixed(2)),1)]),d("div",na,[s[4]||(s[4]=d("span",{class:"label"},"库存:",-1)),d("span",{class:u(["stock",{"low-stock":B.value.stock<10}])},p(B.value.stock>0?B.value.stock:"无货"),3)]),d("div",da,[s[5]||(s[5]=d("span",{class:"label"},"销量:",-1)),d("span",pa,p(B.value.sales),1)])]),1===B.value.hasSpecification?(o(),c("div",ua,[m(Y,{productId:Number(V(t).params.id),basePrice:B.value.price,hasSpecification:1===B.value.hasSpecification,specifications:B.value.specifications,onSpecificationSelected:R,onSpecificationChange:W},null,8,["productId","basePrice","hasSpecification","specifications"])])):i("",!0),d("div",ma,[s[8]||(s[8]=d("span",{class:"label"},"数量:",-1)),d("div",fa,[m(L,{type:"primary",circle:"",size:"small",onClick:ha,disabled:F.value<=1},{default:h(()=>[...s[6]||(s[6]=[x("-",-1)])]),l:1},8,["disabled"]),m(H,{modelValue:F.value,"onUpdate:modelValue":s[0]||(s[0]=a=>F.value=a),min:1,max:1===B.value.hasSpecification&&D.value?D.value.stock:B.value.stock,size:"small",style:{width:"120px"},disabled:!E.value},null,8,["modelValue","max","disabled"]),m(L,{type:"primary",circle:"",size:"small",onClick:X,disabled:!E.value},{default:h(()=>[...s[7]||(s[7]=[x("+",-1)])]),l:1},8,["disabled"])])]),d("div",ya,[s[9]||(s[9]=d("span",{class:"label"},"总价:",-1)),d("span",ba,"¥"+p(Q.value),1)]),d("div",va,[m(L,{type:"primary",size:"large",disabled:!E.value,onClick:ga},{default:h(()=>[...s[10]||(s[10]=[x(" 加入购物车 ",-1)])]),l:1},8,["disabled"]),m(L,{type:"danger",size:"large",disabled:!E.value,onClick:ja},{default:h(()=>[...s[11]||(s[11]=[x(" 立即购买 ",-1)])]),l:1},8,["disabled"])])])]),l:1})]),l:1}),d("div",ka,[m(Ca,{modelValue:U.value,"onUpdate:modelValue":s[1]||(s[1]=a=>U.value=a)},{default:h(()=>[m(G,{label:"商品详情",name:"detail"},{default:h(()=>[d("div",{class:"detail-content",innerHTML:B.value.detail},null,8,_a)]),l:1})]),l:1},8,["modelValue"])])])):i("",!0),M.value||B.value?i("",!0):(o(),_(Ia,{key:1,icon:"error",title:"商品加载失败","sub-title":"未找到商品信息或者商品已下架"},{extra:h(()=>[m(L,{type:"primary",onClick:wa},{default:h(()=>[...s[12]||(s[12]=[x("返回商城",-1)])]),l:1})]),l:1}))])),[[Sa,M.value]])}}},[["__scopeId","data-v-a652f22b"]]);export{ha as default};

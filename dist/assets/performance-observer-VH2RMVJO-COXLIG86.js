var s=!1;function E(e){if(typeof PerformanceObserver>"u")return null;const{entryTypes:t,onMetric:o,enableDetailedMonitoring:a=!0,memoryMonitorInterval:r=3e4}=e;s=!1;const n=new PerformanceObserver(i=>{const m=i.getEntries();for(const p of m)f(p,o,a)});try{return n.observe({entryTypes:t,buffered:e.buffered??!0}),a&&t.includes("navigation")&&v(o),n}catch(i){return console.warn("Failed to create PerformanceObserver:",i),null}}function f(e,t,o=!0){var r;const a={ts:Date.now(),source:"performance-observer",attrs:{entryType:e.entryType,startTime:e.startTime}};switch(e.entryType){case"navigation":o&&(s=!0,c(e,a,t));break;case"resource":o&&g(e,a,t);break;case"longtask":l(e,a,t);break;case"measure":t==null||t({...a,type:"measure",name:e.name,value:Math.round(e.duration||0),unit:"ms",attrs:{...a.attrs,duration:e.duration,detail:e.detail}});break;case"mark":t==null||t({...a,type:"mark",name:e.name,value:Math.round(e.startTime),unit:"ms",attrs:{...a.attrs,detail:e.detail}});break;case"event":const n=e;t==null||t({...a,type:"event",name:n.name,value:Math.round(n.duration||0),unit:"ms",rating:d(n.duration||0,{good:16,poor:50}),attrs:{...a.attrs,duration:n.duration,processingStart:n.processingStart,processingEnd:n.processingEnd,cancelable:n.cancelable,target:(r=n.target)==null?void 0:r.tagName}});break;default:t==null||t({...a,type:"custom",name:e.name||e.entryType,value:Math.round(e.duration||e.startTime||0),unit:"ms",attrs:{...a.attrs,duration:e.duration,...b(e)}})}}function c(e,t,o){const a={dnsLookup:e.domainLookupEnd-e.domainLookupStart,tcpConnect:e.connectEnd-e.connectStart,sslHandshake:e.secureConnectionStart>0?e.connectEnd-e.secureConnectionStart:void 0,request:e.responseStart-e.requestStart,response:e.responseEnd-e.responseStart,domProcessing:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,resourceLoading:e.loadEventStart-e.domContentLoadedEventEnd,pageLoad:e.loadEventEnd-e.fetchStart};Object.entries(a).forEach(([r,n])=>{n!==void 0&&n>=0&&(o==null||o({...t,type:"navigation",name:r,value:Math.round(n),unit:"ms",rating:h(r,Math.round(n)),attrs:{...t.attrs,navigationType:T(typeof e.type=="number"?e.type:0),redirectCount:e.redirectCount}}))})}function g(e,t,o){const a={name:e.name,type:k(e.name,e.initiatorType),size:e.decodedBodySize||0,transferSize:e.transferSize||0,duration:e.responseEnd-e.startTime,startTime:e.startTime,cached:e.transferSize===0&&e.decodedBodySize>0};o==null||o({...t,type:"resource",name:a.type,value:Math.round(a.duration),unit:"ms",rating:d(a.duration,{good:500,poor:1e3}),attrs:{...t.attrs,url:a.name,size:a.size,transferSize:a.transferSize,cached:a.cached,initiatorType:e.initiatorType}})}function l(e,t,o){const a={duration:e.duration,startTime:e.startTime,name:e.name||"unknown",blockingTime:Math.max(0,e.duration-50)};o==null||o({...t,type:"longtask",name:"long-task",value:Math.round(a.duration),unit:"ms",rating:"poor",attrs:{...t.attrs,blockingTime:a.blockingTime,taskName:a.name,attribution:e.attribution}})}function v(e){if(s){console.debug("Navigation timing already processed by PerformanceObserver, skipping fallback");return}document.readyState==="complete"?u(e):window.addEventListener("load",()=>{setTimeout(()=>u(e),100)})}function u(e){try{const t=performance.getEntriesByType("navigation")[0];t&&(s=!0,c(t,{ts:Date.now(),source:"performance-api",attrs:{entryType:"navigation"}},e))}catch(t){console.warn("Navigation timing collection failed:",t)}}function d(e,t){return e<=t.good?"good":e<=t.poor?"needs-improvement":"poor"}function h(e,t){const a={dnsLookup:{good:20,poor:100},tcpConnect:{good:20,poor:100},sslHandshake:{good:50,poor:200},request:{good:200,poor:500},response:{good:200,poor:500},domProcessing:{good:500,poor:1500},resourceLoading:{good:1e3,poor:3e3},pageLoad:{good:2e3,poor:5e3}}[e];return a?d(t,a):void 0}function T(e){switch(e){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward";case 255:return"prerender";default:return"unknown"}}function k(e,t){switch(t){case"script":return"script";case"link":return e.includes(".css")?"stylesheet":e.includes(".woff")||e.includes(".ttf")||e.includes(".otf")?"font":"other";case"img":return"image";case"fetch":return"fetch";case"xmlhttprequest":return"xmlhttprequest";default:return e.match(/\.(js|mjs)$/)?"script":e.match(/\.css$/)?"stylesheet":e.match(/\.(png|jpg|jpeg|gif|svg|webp)$/)?"image":e.match(/\.(woff|woff2|ttf|otf|eot)$/)?"font":"other"}}function b(e){const t={};return["duration","transferSize","decodedBodySize","encodedBodySize","initiatorType","nextHopProtocol","renderBlockingStatus","responseStatus","deliveryType"].forEach(a=>{a in e&&e[a]!==void 0&&(t[a]=e[a])}),t}export{E as createPerformanceObserver};

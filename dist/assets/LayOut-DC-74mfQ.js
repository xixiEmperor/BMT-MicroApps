import{u as e,a as t,r as a,o as s,b as l,E as n,c as o,d as r,e as i,f as c,w as u,g as d,h as f,i as p,j as k,k as _,l as m,m as h,n as v,p as g,s as y,q as x,t as w,v as C,x as b,y as T,z as j,A as I,B as A,C as B,D as q,F as z,G as M,H as F,I as G,J as L}from"./index-RXELqIC3.js";/* empty css                     */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     */import{_ as O}from"./_plugin-vue_export-helper-CRLhVpGU.js";/* empty css                        *//* empty css                       *//* empty css                 *//* empty css                   */import{u as S}from"./cart-CpOPODuf.js";const D={class:"header__content"},E={class:"container"},H={class:"header__logo"},J={class:"user-area"},P={key:4,class:"user-info"},R={class:"user-info-wrapper"},U={class:"user-avatar"},$=["src"],K={key:1,src:"https://tse1-mm.cn.bing.net/th/id/OIP-C.gaAkkFf8LStn-oc4l8iM0wAAAA?w=160&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7",alt:"默认头像"},N={class:"username"},Q={class:"nav"},V={class:"container"},W=O({t:"LayOut",setup(O){const W=e(),X=S(),Y=t(),{startTokenCheck:Z,stopTokenCheck:ee}=function(r={}){const{warningTime:i=18e5,checkInterval:c=3e5}=r,u=e(),d=t(),f=a(null),p=a(!1),k=()=>{if(!u.token)return;const e=u.getTokenRemainingTime();e<=0?_():e<=i&&!p.value&&(m(e),p.value=!0)},_=()=>{g(),u.logout(),n.warning("登录已过期，请重新登录");const e=d.currentRoute.value.fullPath;"/login"!==e&&d.push({path:"/login",query:{redirect:e}})},m=e=>{const t=Math.floor(e/6e4);o.confirm(`您的登录状态将在 ${t} 分钟后过期，是否需要延长登录时间？`,"登录即将过期",{confirmButtonText:"延长登录",cancelButtonText:"稍后处理",type:"warning"}).then(()=>{h()}).catch(()=>{n.info("请注意登录状态，避免操作中断")})},h=()=>{const e=d.currentRoute.value.fullPath;d.push({path:"/login",query:{redirect:e,refresh:"true"}})},v=()=>{f.value&&clearInterval(f.value),k(),f.value=setInterval(k,c)},g=()=>{f.value&&(clearInterval(f.value),f.value=null),p.value=!1};return s(()=>{u.token&&v()}),l(()=>{g()}),{startTokenCheck:v,stopTokenCheck:g,checkTokenStatus:k}}({warningTime:18e5,checkInterval:3e5}),te=r(()=>X.totalCount),ae=a(!1),se=a({});se.value=W.userinfo;const le=e=>{const{avatarUrl:t}=e.detail;se.value&&(se.value={...se.value,avatar:t})},ne=()=>{Y.push("/user-center")},oe=()=>{Y.push("/my-history-post")},re=()=>{Y.push("/login")},ie=()=>{Y.push("/cart")},ce=()=>{Y.push("/booking-history")},ue=()=>{Y.push("/orders")},de=()=>{o.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{W.logout(),ae.value=!1,se.value={username:"",avatar:""},"/user-center"===Y.currentRoute.value.path&&Y.push("/")})};return s(()=>{(()=>{if(W.token&&!W.isTokenExpired())try{ae.value=!0,Z()}catch(e){ae.value=!1}else ae.value=!1,ee()})(),window.addEventListener("user-avatar-updated",le)}),i(()=>{window.removeEventListener("user-avatar-updated",le)}),(e,t)=>{const a=p,s=g,l=v,n=h,o=j,r=T,i=C,O=q("router-link"),S=B,W=A,X=z,Y=q("router-view"),Z=M,ee=F,le=G;return L(),c(le,{class:"layout-container"},{default:u(()=>[d(X,{class:"header"},{default:u(()=>[f("div",D,[f("div",E,[f("div",H,[d(a,{src:k("/BMT-MicroApps/assets/whlg_logo-Ckl8GxR1.png"),alt:"",fit:"contain",style:{width:"300px",height:"100px"}},null,8,["src"]),t[0]||(t[0]=f("p",{style:{"font-size":"22px"}},"南湖校区羽毛球场地预定",-1))]),f("div",J,[ae.value?(L(),c(n,{key:0,type:"text",class:"cart-btn",onClick:ie},{default:u(()=>[d(l,{value:te.value,hidden:0===te.value},{default:u(()=>[d(s,null,{default:u(()=>[d(k(y))]),l:1})]),l:1},8,["value","hidden"]),t[1]||(t[1]=f("span",null,"购物车",-1))]),l:1})):_("",!0),ae.value?(L(),c(n,{key:1,type:"text",class:"booking-history-btn",onClick:ue},{default:u(()=>[d(s,null,{default:u(()=>[d(k(x))]),l:1}),t[2]||(t[2]=f("span",null,"商品订单",-1))]),l:1})):_("",!0),ae.value?(L(),c(n,{key:2,type:"text",class:"booking-history-btn",onClick:ce},{default:u(()=>[d(s,null,{default:u(()=>[d(k(x))]),l:1}),t[3]||(t[3]=f("span",null,"场地预订",-1))]),l:1})):_("",!0),ae.value?(L(),c(n,{key:3,type:"text",class:"user-center-btn",onClick:oe},{default:u(()=>[d(s,null,{default:u(()=>[d(k(w))]),l:1}),t[4]||(t[4]=f("span",null,"我的发帖",-1))]),l:1})):_("",!0),ae.value?(L(),m("div",P,[d(i,{trigger:"click"},{dropdown:u(()=>[d(r,null,{default:u(()=>[d(o,{onClick:ne},{default:u(()=>[...t[5]||(t[5]=[I("个人中心",-1)])]),l:1}),d(o,{onClick:oe},{default:u(()=>[...t[6]||(t[6]=[I("我的发帖",-1)])]),l:1}),d(o,{onClick:ce},{default:u(()=>[...t[7]||(t[7]=[I("场地预订",-1)])]),l:1}),d(o,{onClick:ue},{default:u(()=>[...t[8]||(t[8]=[I("商品订单",-1)])]),l:1}),d(o,{onClick:de},{default:u(()=>[...t[9]||(t[9]=[I("退出登录",-1)])]),l:1})]),l:1})]),default:u(()=>[f("div",R,[f("div",U,[se.value.avatar?(L(),m("img",{key:0,src:se.value.avatar,alt:"头像"},null,8,$)):(L(),m("img",K))]),f("span",N,b(se.value.username),1)])]),l:1})])):(L(),c(n,{key:5,type:"primary",size:"large",class:"login",onClick:re},{default:u(()=>[...t[10]||(t[10]=[I(" 登录 / 注册 ",-1)])]),l:1}))])]),f("div",Q,[f("div",V,[d(W,{"default-active":e.$route.path,class:"el-menu-demo",mode:"horizontal","background-color":"rgb(41, 108, 182)","text-color":"#fff","active-text-color":"#ffd04b"},{default:u(()=>[d(S,{index:"/home"},{default:u(()=>[d(O,{to:"/home"},{default:u(()=>[...t[11]||(t[11]=[I("首页",-1)])]),l:1})]),l:1}),d(S,{index:"/booking"},{default:u(()=>[d(O,{to:"/booking"},{default:u(()=>[...t[12]||(t[12]=[I("场地预定",-1)])]),l:1})]),l:1}),d(S,{index:"/shop"},{default:u(()=>[d(O,{to:"/shop"},{default:u(()=>[...t[13]||(t[13]=[I("羽体商城",-1)])]),l:1})]),l:1}),d(S,{index:"/forum"},{default:u(()=>[d(O,{to:"/forum"},{default:u(()=>[...t[14]||(t[14]=[I("羽你同行论坛",-1)])]),l:1})]),l:1})]),l:1},8,["default-active"])])])])]),l:1}),d(Z,{class:"main-content"},{default:u(()=>[d(Y)]),l:1}),d(ee,{class:"footer-container"},{default:u(()=>[...t[15]||(t[15]=[f("div",{class:"footer"},[f("div",{class:"container"},[f("p",null,"版权所有 © 2025 南湖校区羽毛球场预定系统"),f("p",null,"联系电话: 12345678901 | 地址: 南湖校区体育中心一楼")])],-1)])]),l:1})]),l:1})}}},[["__scopeId","data-v-2611dc03"]]);export{W as default};

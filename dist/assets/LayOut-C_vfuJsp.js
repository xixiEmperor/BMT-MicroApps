import{u as e,a,r as t,o as l,b as s,E as n,c as o,d as u,e as r,f as i,w as c,g as d,h as v,i as p,j as f,k as h,l as k,m,n as _,p as g,s as y,q as x,t as w,v as C,x as b,y as T,z as j,A as I,B as A,C as B,D as R,F as q,G as z,H as E,I as L,J as M}from"./index-BMm2wflY.js";/* empty css                     */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     */import{_ as P}from"./_plugin-vue_export-helper-CTKw_zaB.js";/* empty css                        *//* empty css                       *//* empty css                 *//* empty css                   */import{u as F}from"./cart-M_M03IGN.js";const G={class:"header__content"},O={class:"container"},S={class:"header__logo"},$={class:"user-area"},D={key:4,class:"user-info"},H={class:"user-info-wrapper"},J={class:"user-avatar"},U=["src"],K={key:1,src:"https://tse1-mm.cn.bing.net/th/id/OIP-C.gaAkkFf8LStn-oc4l8iM0wAAAA?w=160&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7",alt:"默认头像"},N={class:"username"},Q={class:"nav"},V={class:"container"},W=P({__name:"LayOut",setup(P){const W=e(),X=F(),Y=a(),{startTokenCheck:Z,stopTokenCheck:ee}=function(u={}){const{warningTime:r=18e5,checkInterval:i=3e5}=u,c=e(),d=a(),v=t(null),p=t(!1),checkTokenStatus=()=>{if(!c.token)return;const e=c.getTokenRemainingTime();e<=0?handleTokenExpired():e<=r&&!p.value&&(showExpirationWarning(e),p.value=!0)},handleTokenExpired=()=>{stopTokenCheck(),c.logout(),n.warning("登录已过期，请重新登录");const e=d.currentRoute.value.fullPath;"/login"!==e&&d.push({path:"/login",query:{redirect:e}})},showExpirationWarning=e=>{const a=Math.floor(e/6e4);o.confirm(`您的登录状态将在 ${a} 分钟后过期，是否需要延长登录时间？`,"登录即将过期",{confirmButtonText:"延长登录",cancelButtonText:"稍后处理",type:"warning"}).then(()=>{refreshLogin()}).catch(()=>{n.info("请注意登录状态，避免操作中断")})},refreshLogin=()=>{const e=d.currentRoute.value.fullPath;d.push({path:"/login",query:{redirect:e,refresh:"true"}})},startTokenCheck=()=>{v.value&&clearInterval(v.value),checkTokenStatus(),v.value=setInterval(checkTokenStatus,i)},stopTokenCheck=()=>{v.value&&(clearInterval(v.value),v.value=null),p.value=!1};return l(()=>{c.token&&startTokenCheck()}),s(()=>{stopTokenCheck()}),{startTokenCheck:startTokenCheck,stopTokenCheck:stopTokenCheck,checkTokenStatus:checkTokenStatus}}({warningTime:18e5,checkInterval:3e5}),ae=u(()=>X.totalCount),te=t(!1),le=t({});le.value=W.userinfo;const handleUserAvatarUpdated=e=>{const{avatarUrl:a}=e.detail;le.value&&(le.value={...le.value,avatar:a})},goToUserCenter=()=>{Y.push("/user-center")},goToMyPost=()=>{Y.push("/my-history-post")},goToLogin=()=>{Y.push("/login")},goToCart=()=>{Y.push("/cart")},goToBookingHistory=()=>{Y.push("/booking-history")},goToOrders=()=>{Y.push("/orders")},logout=()=>{o.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{W.logout(),te.value=!1,le.value={username:"",avatar:""},"/user-center"===Y.currentRoute.value.path&&Y.push("/")})};return l(()=>{(()=>{if(W.token&&!W.isTokenExpired())try{te.value=!0,Z()}catch(e){te.value=!1}else te.value=!1,ee()})(),window.addEventListener("user-avatar-updated",handleUserAvatarUpdated)}),r(()=>{window.removeEventListener("user-avatar-updated",handleUserAvatarUpdated)}),(e,a)=>{const t=p,l=g,s=_,n=m,o=j,u=T,r=C,P=R("router-link"),F=B,W=A,X=q,Y=R("router-view"),Z=z,ee=E,se=L;return M(),i(se,{class:"layout-container"},{default:c(()=>[d(X,{class:"header"},{default:c(()=>[v("div",G,[v("div",O,[v("div",S,[d(t,{src:f("/BMT-MicroApps/assets/whlg_logo-Ckl8GxR1.png"),alt:"",fit:"contain",style:{width:"300px",height:"100px"}},null,8,["src"]),a[0]||(a[0]=v("p",{style:{"font-size":"22px"}},"南湖校区羽毛球场地预定",-1))]),v("div",$,[te.value?(M(),i(n,{key:0,type:"text",class:"cart-btn",onClick:goToCart},{default:c(()=>[d(s,{value:ae.value,hidden:0===ae.value},{default:c(()=>[d(l,null,{default:c(()=>[d(f(y))]),_:1})]),_:1},8,["value","hidden"]),a[1]||(a[1]=v("span",null,"购物车",-1))]),_:1})):h("",!0),te.value?(M(),i(n,{key:1,type:"text",class:"booking-history-btn",onClick:goToOrders},{default:c(()=>[d(l,null,{default:c(()=>[d(f(x))]),_:1}),a[2]||(a[2]=v("span",null,"商品订单",-1))]),_:1})):h("",!0),te.value?(M(),i(n,{key:2,type:"text",class:"booking-history-btn",onClick:goToBookingHistory},{default:c(()=>[d(l,null,{default:c(()=>[d(f(x))]),_:1}),a[3]||(a[3]=v("span",null,"场地预订",-1))]),_:1})):h("",!0),te.value?(M(),i(n,{key:3,type:"text",class:"user-center-btn",onClick:goToMyPost},{default:c(()=>[d(l,null,{default:c(()=>[d(f(w))]),_:1}),a[4]||(a[4]=v("span",null,"我的发帖",-1))]),_:1})):h("",!0),te.value?(M(),k("div",D,[d(r,{trigger:"click"},{dropdown:c(()=>[d(u,null,{default:c(()=>[d(o,{onClick:goToUserCenter},{default:c(()=>[...a[5]||(a[5]=[I("个人中心",-1)])]),_:1}),d(o,{onClick:goToMyPost},{default:c(()=>[...a[6]||(a[6]=[I("我的发帖",-1)])]),_:1}),d(o,{onClick:goToBookingHistory},{default:c(()=>[...a[7]||(a[7]=[I("场地预订",-1)])]),_:1}),d(o,{onClick:goToOrders},{default:c(()=>[...a[8]||(a[8]=[I("商品订单",-1)])]),_:1}),d(o,{onClick:logout},{default:c(()=>[...a[9]||(a[9]=[I("退出登录",-1)])]),_:1})]),_:1})]),default:c(()=>[v("div",H,[v("div",J,[le.value.avatar?(M(),k("img",{key:0,src:le.value.avatar,alt:"头像"},null,8,U)):(M(),k("img",K))]),v("span",N,b(le.value.username),1)])]),_:1})])):(M(),i(n,{key:5,type:"primary",size:"large",class:"login",onClick:goToLogin},{default:c(()=>[...a[10]||(a[10]=[I(" 登录 / 注册 ",-1)])]),_:1}))])]),v("div",Q,[v("div",V,[d(W,{"default-active":e.$route.path,class:"el-menu-demo",mode:"horizontal","background-color":"rgb(41, 108, 182)","text-color":"#fff","active-text-color":"#ffd04b"},{default:c(()=>[d(F,{index:"/home"},{default:c(()=>[d(P,{to:"/home"},{default:c(()=>[...a[11]||(a[11]=[I("首页",-1)])]),_:1})]),_:1}),d(F,{index:"/booking"},{default:c(()=>[d(P,{to:"/booking"},{default:c(()=>[...a[12]||(a[12]=[I("场地预定",-1)])]),_:1})]),_:1}),d(F,{index:"/shop"},{default:c(()=>[d(P,{to:"/shop"},{default:c(()=>[...a[13]||(a[13]=[I("羽体商城",-1)])]),_:1})]),_:1}),d(F,{index:"/forum"},{default:c(()=>[d(P,{to:"/forum"},{default:c(()=>[...a[14]||(a[14]=[I("羽你同行论坛",-1)])]),_:1})]),_:1})]),_:1},8,["default-active"])])])])]),_:1}),d(Z,{class:"main-content"},{default:c(()=>[d(Y)]),_:1}),d(ee,{class:"footer-container"},{default:c(()=>[...a[15]||(a[15]=[v("div",{class:"footer"},[v("div",{class:"container"},[v("p",null,"版权所有 © 2025 南湖校区羽毛球场预定系统"),v("p",null,"联系电话: 12345678901 | 地址: 南湖校区体育中心一楼")])],-1)])]),_:1})]),_:1})}}},[["__scopeId","data-v-2611dc03"]]);export{W as default};
